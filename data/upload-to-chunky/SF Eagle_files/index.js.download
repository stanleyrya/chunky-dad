(function(Fe){typeof define=="function"&&define.amd?define(Fe):Fe()})(function(){"use strict";var Lk=Object.defineProperty;var Uk=(Fe,F,fn)=>F in Fe?Lk(Fe,F,{enumerable:!0,configurable:!0,writable:!0,value:fn}):Fe[F]=fn;var Wt=(Fe,F,fn)=>Uk(Fe,typeof F!="symbol"?F+"":F,fn);var Fe,F,fn,La,pn,Ua,Fa,Ba,ja,Qr,Zr,es,Va,oi={},$a=[],qf=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ai=Array.isArray;function ut(t,e){for(var n in e)t[n]=e[n];return t}function ts(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function pe(t,e,n){var i,r,s,o={};for(s in e)s=="key"?i=e[s]:s=="ref"?r=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?Fe.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]===void 0&&(o[s]=t.defaultProps[s]);return ci(t,o,i,r,null)}function ci(t,e,n,i,r){var s={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++fn,__i:-1,__u:0};return r==null&&F.vnode!=null&&F.vnode(s),s}function qa(){return{current:null}}function Ee(t){return t.children}function Qe(t,e){this.props=t,this.context=e}function xn(t,e){if(e==null)return t.__?xn(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?xn(t):null}function Wa(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Wa(t)}}function ns(t){(!t.__d&&(t.__d=!0)&&pn.push(t)&&!Fi.__r++||Ua!==F.debounceRendering)&&((Ua=F.debounceRendering)||Fa)(Fi)}function Fi(){for(var t,e,n,i,r,s,o,a=1;pn.length;)pn.length>a&&pn.sort(Ba),t=pn.shift(),a=pn.length,t.__d&&(n=void 0,r=(i=(e=t).__v).__e,s=[],o=[],e.__P&&((n=ut({},i)).__v=i.__v+1,F.vnode&&F.vnode(n),is(e.__P,n,i,e.__n,e.__P.namespaceURI,32&i.__u?[r]:null,s,r??xn(i),!!(32&i.__u),o),n.__v=i.__v,n.__.__k[n.__i]=n,Ja(s,n,o),n.__e!=r&&Wa(n)));Fi.__r=0}function Ha(t,e,n,i,r,s,o,a,c,l,d){var u,h,f,m,p,g,v=i&&i.__k||$a,_=e.length;for(c=Wf(n,e,v,c,_),u=0;u<_;u++)(f=n.__k[u])!=null&&(h=f.__i===-1?oi:v[f.__i]||oi,f.__i=u,g=is(t,f,h,r,s,o,a,c,l,d),m=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&rs(h.ref,null,f),d.push(f.ref,f.__c||m,f)),p==null&&m!=null&&(p=m),4&f.__u||h.__k===f.__k?c=za(f,c,t):typeof f.type=="function"&&g!==void 0?c=g:m&&(c=m.nextSibling),f.__u&=-7);return n.__e=p,c}function Wf(t,e,n,i,r){var s,o,a,c,l,d=n.length,u=d,h=0;for(t.__k=new Array(r),s=0;s<r;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(c=s+h,(o=t.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?ci(null,o,null,null,null):ai(o)?ci(Ee,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?ci(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,a=null,(l=o.__i=Hf(o,n,c,u))!==-1&&(u--,(a=n[l])&&(a.__u|=2)),a==null||a.__v===null?(l==-1&&(r>d?h--:r<d&&h++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,o.__u|=4))):t.__k[s]=null;if(u)for(s=0;s<d;s++)(a=n[s])!=null&&!(2&a.__u)&&(a.__e==i&&(i=xn(a)),Xa(a,a));return i}function za(t,e,n){var i,r;if(typeof t.type=="function"){for(i=t.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=t,e=za(i[r],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=xn(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Pt(t,e){return e=e||[],t==null||typeof t=="boolean"||(ai(t)?t.some(function(n){Pt(n,e)}):e.push(t)),e}function Hf(t,e,n,i){var r,s,o=t.key,a=t.type,c=e[n];if(c===null&&t.key==null||c&&o==c.key&&a===c.type&&!(2&c.__u))return n;if(i>(c!=null&&!(2&c.__u)?1:0))for(r=n-1,s=n+1;r>=0||s<e.length;){if(r>=0){if((c=e[r])&&!(2&c.__u)&&o==c.key&&a===c.type)return r;r--}if(s<e.length){if((c=e[s])&&!(2&c.__u)&&o==c.key&&a===c.type)return s;s++}}return-1}function Ga(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||qf.test(e)?n:n+"px"}function Bi(t,e,n,i,r){var s;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||Ga(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||Ga(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(ja,"$1")),e=e.toLowerCase()in t||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?i?n.t=i.t:(n.t=Qr,t.addEventListener(e,s?es:Zr,s)):t.removeEventListener(e,s?es:Zr,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Ka(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.u==null)e.u=Qr++;else if(e.u<n.t)return;return n(F.event?F.event(e):e)}}}function is(t,e,n,i,r,s,o,a,c,l){var d,u,h,f,m,p,g,v,_,C,y,k,w,E,I,R,D,A=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),s=[a=e.__e=n.__e]),(d=F.__b)&&d(e);e:if(typeof A=="function")try{if(v=e.props,_="prototype"in A&&A.prototype.render,C=(d=A.contextType)&&i[d.__c],y=d?C?C.props.value:d.__:i,n.__c?g=(u=e.__c=n.__c).__=u.__E:(_?e.__c=u=new A(v,y):(e.__c=u=new Qe(v,y),u.constructor=A,u.render=Gf),C&&C.sub(u),u.props=v,u.state||(u.state={}),u.context=y,u.__n=i,h=u.__d=!0,u.__h=[],u._sb=[]),_&&u.__s==null&&(u.__s=u.state),_&&A.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=ut({},u.__s)),ut(u.__s,A.getDerivedStateFromProps(v,u.__s))),f=u.props,m=u.state,u.__v=e,h)_&&A.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),_&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(_&&A.getDerivedStateFromProps==null&&v!==f&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(v,y),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(v,u.__s,y)===!1||e.__v==n.__v)){for(e.__v!=n.__v&&(u.props=v,u.state=u.__s,u.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(U){U&&(U.__=e)}),k=0;k<u._sb.length;k++)u.__h.push(u._sb[k]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(v,u.__s,y),_&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(f,m,p)})}if(u.context=y,u.props=v,u.__P=t,u.__e=!1,w=F.__r,E=0,_){for(u.state=u.__s,u.__d=!1,w&&w(e),d=u.render(u.props,u.state,u.context),I=0;I<u._sb.length;I++)u.__h.push(u._sb[I]);u._sb=[]}else do u.__d=!1,w&&w(e),d=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++E<25);u.state=u.__s,u.getChildContext!=null&&(i=ut(ut({},i),u.getChildContext())),_&&!h&&u.getSnapshotBeforeUpdate!=null&&(p=u.getSnapshotBeforeUpdate(f,m)),R=d,d!=null&&d.type===Ee&&d.key==null&&(R=Ya(d.props.children)),a=Ha(t,ai(R)?R:[R],e,n,i,r,s,o,a,c,l),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),g&&(u.__E=u.__=null)}catch(U){if(e.__v=null,c||s!=null)if(U.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else for(D=s.length;D--;)ts(s[D]);else e.__e=n.__e,e.__k=n.__k;F.__e(U,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=zf(n.__e,e,n,i,r,s,o,c,l);return(d=F.diffed)&&d(e),128&e.__u?void 0:a}function Ja(t,e,n){for(var i=0;i<n.length;i++)rs(n[i],n[++i],n[++i]);F.__c&&F.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(s){s.call(r)})}catch(s){F.__e(s,r.__v)}})}function Ya(t){return typeof t!="object"||t==null?t:ai(t)?t.map(Ya):ut({},t)}function zf(t,e,n,i,r,s,o,a,c){var l,d,u,h,f,m,p,g=n.props,v=e.props,_=e.type;if(_=="svg"?r="http://www.w3.org/2000/svg":_=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(l=0;l<s.length;l++)if((f=s[l])&&"setAttribute"in f==!!_&&(_?f.localName==_:f.nodeType==3)){t=f,s[l]=null;break}}if(t==null){if(_==null)return document.createTextNode(v);t=document.createElementNS(r,_,v.is&&v),a&&(F.__m&&F.__m(e,s),a=!1),s=null}if(_===null)g===v||a&&t.data===v||(t.data=v);else{if(s=s&&Fe.call(t.childNodes),g=n.props||oi,!a&&s!=null)for(g={},l=0;l<t.attributes.length;l++)g[(f=t.attributes[l]).name]=f.value;for(l in g)if(f=g[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=f;else if(!(l in v)){if(l=="value"&&"defaultValue"in v||l=="checked"&&"defaultChecked"in v)continue;Bi(t,l,null,f,r)}}for(l in v)f=v[l],l=="children"?h=f:l=="dangerouslySetInnerHTML"?d=f:l=="value"?m=f:l=="checked"?p=f:a&&typeof f!="function"||g[l]===f||Bi(t,l,f,g[l],r);if(d)a||u&&(d.__html===u.__html||d.__html===t.innerHTML)||(t.innerHTML=d.__html),e.__k=[];else if(u&&(t.innerHTML=""),Ha(e.type==="template"?t.content:t,ai(h)?h:[h],e,n,i,_=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,o,s?s[0]:n.__k&&xn(n,0),a,c),s!=null)for(l=s.length;l--;)ts(s[l]);a||(l="value",_=="progress"&&m==null?t.removeAttribute("value"):m!==void 0&&(m!==t[l]||_=="progress"&&!m||_=="option"&&m!==g[l])&&Bi(t,l,m,g[l],r),l="checked",p!==void 0&&p!==t[l]&&Bi(t,l,p,g[l],r))}return t}function rs(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(r){F.__e(r,n)}}function Xa(t,e,n){var i,r;if(F.unmount&&F.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||rs(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){F.__e(s,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&Xa(i[r],e,n||typeof t.type!="function");n||ts(t.__e),t.__c=t.__=t.__e=void 0}function Gf(t,e,n){return this.constructor(t,n)}function Ht(t,e,n){var i,r,s,o;e==document&&(e=document.documentElement),F.__&&F.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,s=[],o=[],is(e,t=(!i&&n||e).__k=pe(Ee,null,[t]),r||oi,oi,e.namespaceURI,!i&&n?[n]:r?null:e.firstChild?Fe.call(e.childNodes):null,s,!i&&n?n:r?r.__e:e.firstChild,i,o),Ja(s,t,o)}function ss(t,e){Ht(t,e,ss)}function os(t,e,n){var i,r,s,o,a=ut({},t.props);for(s in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)s=="key"?i=e[s]:s=="ref"?r=e[s]:a[s]=e[s]===void 0&&o!==void 0?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?Fe.call(arguments,2):n),ci(t.type,a,i||t.key,r||t.ref,null)}function xe(t){function e(n){var i,r;return this.getChildContext||(i=new Set,(r={})[e.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){i=null},this.shouldComponentUpdate=function(s){this.props.value!==s.value&&i.forEach(function(o){o.__e=!0,ns(o)})},this.sub=function(s){i.add(s);var o=s.componentWillUnmount;s.componentWillUnmount=function(){i&&i.delete(s),o&&o.call(s)}}),n.children}return e.__c="__cC"+Va++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,i){return n.children(i)}).contextType=e,e}Fe=$a.slice,F={__e:function(t,e,n,i){for(var r,s,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(t)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,i||{}),o=r.__d),o)return r.__E=r}catch(a){t=a}throw t}},fn=0,La=function(t){return t!=null&&t.constructor==null},Qe.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ut({},this.state),typeof t=="function"&&(t=t(ut({},n),this.props)),t&&ut(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),ns(this))},Qe.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ns(this))},Qe.prototype.render=Ee,pn=[],Fa=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ba=function(t,e){return t.__v.__b-e.__v.__b},Fi.__r=0,ja=/(PointerCapture)$|Capture$/i,Qr=0,Zr=Ka(!1),es=Ka(!0),Va=0;function as(){return(as=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var Kf=["context","children"];function Jf(t){this.getChildContext=function(){return t.context};var e=t.children,n=function(i,r){if(i==null)return{};var s,o,a={},c=Object.keys(i);for(o=0;o<c.length;o++)r.indexOf(s=c[o])>=0||(a[s]=i[s]);return a}(t,Kf);return os(e,n)}function Yf(){var t=new CustomEvent("_preact",{detail:{},bubbles:!0,cancelable:!0});this.dispatchEvent(t),this._vdom=pe(Jf,as({},this._props,{context:t.detail.context}),function e(n,i){if(n.nodeType===3)return n.data;if(n.nodeType!==1)return null;var r=[],s={},o=0,a=n.attributes,c=n.childNodes;for(o=a.length;o--;)a[o].name!=="slot"&&(s[a[o].name]=a[o].value,s[Qa(a[o].name)]=a[o].value);for(o=c.length;o--;){var l=e(c[o],null),d=c[o].slot;d?s[d]=pe(Za,{name:d},l):r[o]=l}var u=i?pe(Za,null,r):r;return pe(i||n.nodeName.toLowerCase(),s,u)}(this,this._vdomComponent)),(this.hasAttribute("hydrate")?ss:Ht)(this._vdom,this._root)}function Qa(t){return t.replace(/-(\w)/g,function(e,n){return n?n.toUpperCase():""})}function Xf(t,e,n){if(this._vdom){var i={};i[t]=n=n??void 0,i[Qa(t)]=n,this._vdom=os(this._vdom,i),Ht(this._vdom,this._root)}}function Qf(){Ht(this._vdom=null,this._root)}function Za(t,e){var n=this;return pe("slot",as({},t,{ref:function(i){i?(n.ref=i,n._listener||(n._listener=function(r){r.stopPropagation(),r.detail.context=e},i.addEventListener("_preact",n._listener))):n.ref.removeEventListener("_preact",n._listener)}}))}function Zf(t,e,n,i){function r(){var s=Reflect.construct(HTMLElement,[],r);return s._vdomComponent=t,s._root=i&&i.shadow?s.attachShadow({mode:i.mode||"open"}):s,s}return(r.prototype=Object.create(HTMLElement.prototype)).constructor=r,r.prototype.connectedCallback=Yf,r.prototype.attributeChangedCallback=Xf,r.prototype.disconnectedCallback=Qf,n=n||t.observedAttributes||Object.keys(t.propTypes||{}),r.observedAttributes=n,n.forEach(function(s){Object.defineProperty(r.prototype,s,{get:function(){return this._vdom.props[s]},set:function(o){this._vdom?this.attributeChangedCallback(s,null,o):(this._props||(this._props={}),this._props[s]=o,this.connectedCallback());var a=typeof o;o!=null&&a!=="string"&&a!=="boolean"&&a!=="number"||this.setAttribute(s,o)}})}),customElements.define(e,r)}const ec=["full","compact"],ep=["expandable"];function tp(t){return ep.includes(t)?(console.warn(`[ConversationalAI] The variant "${t}" is deprecated. Please use "full" or "compact" instead and choose how the widget should expand.`),"full"):ec.includes(t)?t:ec[0]}const tc=["never","mobile","desktop","always"];function np(t,e){return e==="expandable"?"always":tc.includes(t)?t:tc[0]}function ip(t){return t.replace(/_/g,"-")}const rp=["variant","expandable","override-config","avatar-image-url","avatar-orb-color-1","avatar-orb-color-2","agent-id","signed-url","terms-key","server-location","language","dynamic-variables","show-avatar-when-collapsed","override-prompt","override-first-message","override-language","override-voice-id"],nc={start_call_text:"Start a call",end_call_text:"End",action_text:"Need help?",expand_text:"Chat with AI",listening_text:"Listening",speaking_text:"Talk to interrupt"},ic=Object.keys(nc),rc=ic.map(ip),cs=[...rp,...rc];var sp=0;function S(t,e,n,i,r,s){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var l={type:t,props:c,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--sp,__i:-1,__u:0,__source:r,__self:s};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return F.vnode&&F.vnode(l),l}var xt,ce,ls,sc,Rn=0,oc=[],ge=F,ac=ge.__b,cc=ge.__r,lc=ge.diffed,dc=ge.__c,uc=ge.unmount,hc=ge.__;function mn(t,e){ge.__h&&ge.__h(ce,t,Rn||e),Rn=0;var n=ce.__H||(ce.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function B(t){return Rn=1,ji(pc,t)}function ji(t,e,n){var i=mn(xt++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):pc(void 0,e),function(a){var c=i.__N?i.__N[0]:i.__[0],l=i.t(c,a);c!==l&&(i.__N=[l,i.__[1]],i.__c.setState({}))}],i.__c=ce,!ce.__f)){var r=function(a,c,l){if(!i.__c.__H)return!0;var d=i.__c.__H.__.filter(function(h){return!!h.__c});if(d.every(function(h){return!h.__N}))return!s||s.call(this,a,c,l);var u=i.__c.props!==a;return d.forEach(function(h){if(h.__N){var f=h.__[0];h.__=h.__N,h.__N=void 0,f!==h.__[0]&&(u=!0)}}),s&&s.call(this,a,c,l)||u};ce.__f=!0;var s=ce.shouldComponentUpdate,o=ce.componentWillUpdate;ce.componentWillUpdate=function(a,c,l){if(this.__e){var d=s;s=void 0,r(a,c,l),s=d}o&&o.call(this,a,c,l)},ce.shouldComponentUpdate=r}return i.__N||i.__}function K(t,e){var n=mn(xt++,3);!ge.__s&&ps(n.__H,e)&&(n.__=t,n.u=e,ce.__H.__h.push(n))}function Rt(t,e){var n=mn(xt++,4);!ge.__s&&ps(n.__H,e)&&(n.__=t,n.u=e,ce.__h.push(n))}function W(t){return Rn=5,ie(function(){return{current:t}},[])}function ds(t,e,n){Rn=6,Rt(function(){if(typeof t=="function"){var i=t(e());return function(){t(null),i&&typeof i=="function"&&i()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function ie(t,e){var n=mn(xt++,7);return ps(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function re(t,e){return Rn=8,ie(function(){return t},e)}function It(t){var e=ce.context[t.__c],n=mn(xt++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(ce)),e.props.value):t.__}function us(t,e){ge.useDebugValue&&ge.useDebugValue(e?e(t):t)}function op(t){var e=mn(xt++,10),n=B();return e.__=t,ce.componentDidCatch||(ce.componentDidCatch=function(i,r){e.__&&e.__(i,r),n[1](i)}),[n[0],function(){n[1](void 0)}]}function hs(){var t=mn(xt++,11);if(!t.__){for(var e=ce.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function ap(){for(var t;t=oc.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Vi),t.__H.__h.forEach(fs),t.__H.__h=[]}catch(e){t.__H.__h=[],ge.__e(e,t.__v)}}ge.__b=function(t){ce=null,ac&&ac(t)},ge.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),hc&&hc(t,e)},ge.__r=function(t){cc&&cc(t),xt=0;var e=(ce=t.__c).__H;e&&(ls===ce?(e.__h=[],ce.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(Vi),e.__h.forEach(fs),e.__h=[],xt=0)),ls=ce},ge.diffed=function(t){lc&&lc(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(oc.push(e)!==1&&sc===ge.requestAnimationFrame||((sc=ge.requestAnimationFrame)||cp)(ap)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),ls=ce=null},ge.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Vi),n.__h=n.__h.filter(function(i){return!i.__||fs(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],ge.__e(i,n.__v)}}),dc&&dc(t,e)},ge.unmount=function(t){uc&&uc(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{Vi(i)}catch(r){e=r}}),n.__H=void 0,e&&ge.__e(e,n.__v))};var fc=typeof requestAnimationFrame=="function";function cp(t){var e,n=function(){clearTimeout(i),fc&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,100);fc&&(e=requestAnimationFrame(n))}function Vi(t){var e=ce,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),ce=e}function fs(t){var e=ce;t.__c=t.__(),ce=e}function ps(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function pc(t,e){return typeof e=="function"?e(t):e}var lp=Symbol.for("preact-signals");function $i(){if(zt>1)zt--;else{for(var t,e=!1;li!==void 0;){var n=li;for(li=void 0,ms++;n!==void 0;){var i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&vc(n))try{n.c()}catch(r){e||(t=r,e=!0)}n=i}}if(ms=0,zt--,e)throw t}}function mc(t){if(zt>0)return t();zt++;try{return t()}finally{$i()}}var le=void 0,li=void 0,zt=0,ms=0,qi=0;function gc(t){if(le!==void 0){var e=t.n;if(e===void 0||e.t!==le)return e={i:0,S:t,p:le.s,n:void 0,t:le,e:void 0,x:void 0,r:e},le.s!==void 0&&(le.s.n=e),le.s=e,t.n=e,32&le.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=le.s,e.n=void 0,le.s.n=e,le.s=e),e}}function Oe(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}Oe.prototype.brand=lp,Oe.prototype.h=function(){return!0},Oe.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)},Oe.prototype.U=function(t){if(this.t!==void 0){var e=t.e,n=t.x;e!==void 0&&(e.x=n,t.e=void 0),n!==void 0&&(n.e=e,t.x=void 0),t===this.t&&(this.t=n)}},Oe.prototype.subscribe=function(t){var e=this;return On(function(){var n=e.value,i=le;le=void 0;try{t(n)}finally{le=i}})},Oe.prototype.valueOf=function(){return this.value},Oe.prototype.toString=function(){return this.value+""},Oe.prototype.toJSON=function(){return this.value},Oe.prototype.peek=function(){var t=le;le=void 0;try{return this.value}finally{le=t}},Object.defineProperty(Oe.prototype,"value",{get:function(){var t=gc(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(ms>100)throw new Error("Cycle detected");this.v=t,this.i++,qi++,zt++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{$i()}}}});function Gt(t){return new Oe(t)}function vc(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function yc(t){for(var e=t.s;e!==void 0;e=e.n){var n=e.S.n;if(n!==void 0&&(e.r=n),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function bc(t){for(var e=t.s,n=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):n=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}t.s=n}function In(t){Oe.call(this,void 0),this.x=t,this.s=void 0,this.g=qi-1,this.f=4}(In.prototype=new Oe).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===qi))return!0;if(this.g=qi,this.f|=1,this.i>0&&!vc(this))return this.f&=-2,!0;var t=le;try{yc(this),le=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return le=t,bc(this),this.f&=-2,!0},In.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}Oe.prototype.S.call(this,t)},In.prototype.U=function(t){if(this.t!==void 0&&(Oe.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},In.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}},Object.defineProperty(In.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=gc(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Ze(t){return new In(t)}function _c(t){var e=t.u;if(t.u=void 0,typeof e=="function"){zt++;var n=le;le=void 0;try{e()}catch(i){throw t.f&=-2,t.f|=8,gs(t),i}finally{le=n,$i()}}}function gs(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,_c(t)}function dp(t){if(le!==this)throw new Error("Out-of-order effect");bc(this),le=t,this.f&=-2,8&this.f&&gs(this),$i()}function di(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}di.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}},di.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,_c(this),yc(this),zt++;var t=le;return le=this,dp.bind(this,t)},di.prototype.N=function(){2&this.f||(this.f|=2,this.o=li,li=this)},di.prototype.d=function(){this.f|=8,1&this.f||gs(this)};function On(t){var e=new di(t);try{e.c()}catch(n){throw e.d(),n}return e.d.bind(e)}var vs,Wi,ys,kc=[],Cc=[];On(function(){vs=this.N})();function An(t,e){F[t]=e.bind(null,F[t]||function(){})}function Hi(t){ys&&ys(),ys=t&&t.S()}function Sc(t){var e=this,n=t.data,i=Ot(n);i.value=n;var r=ie(function(){for(var a=e,c=e.__v;c=c.__;)if(c.__c){c.__c.__$f|=4;break}var l=Ze(function(){var f=i.value.value;return f===0?0:f===!0?"":f||""}),d=Ze(function(){return!La(l.value)}),u=On(function(){if(this.N=Tc,d.value){var f=l.value;a.base&&a.base.nodeType===3&&(a.base.data=f)}}),h=e.__$u.d;return e.__$u.d=function(){u(),h.call(this)},[d,l]},[]),s=r[0],o=r[1];return s.value?o.peek():o.value}Sc.displayName="_st",Object.defineProperties(Oe.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Sc},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),An("__b",function(t,e){if(typeof e.type=="string"){var n,i=e.props;for(var r in i)if(r!=="children"){var s=i[r];s instanceof Oe&&(n||(e.__np=n={}),n[r]=s,i[r]=s.peek())}}t(e)}),An("__r",function(t,e){Hi();var n,i=e.__c;i&&(i.__$f&=-2,(n=i.__$u)===void 0&&(i.__$u=n=function(r){var s;return On(function(){s=this}),s.c=function(){i.__$f|=1,i.setState({})},s}())),Wi=i,Hi(n),t(e)}),An("__e",function(t,e,n,i){Hi(),Wi=void 0,t(e,n,i)}),An("diffed",function(t,e){Hi(),Wi=void 0;var n;if(typeof e.type=="string"&&(n=e.__e)){var i=e.__np,r=e.props;if(i){var s=n.U;if(s)for(var o in s){var a=s[o];a!==void 0&&!(o in i)&&(a.d(),s[o]=void 0)}else s={},n.U=s;for(var c in i){var l=s[c],d=i[c];l===void 0?(l=up(n,c,d,r),s[c]=l):l.o(d,r)}}}t(e)});function up(t,e,n,i){var r=e in t&&t.ownerSVGElement===void 0,s=Gt(n);return{o:function(o,a){s.value=o,i=a},d:On(function(){this.N=Tc;var o=s.value.value;i[e]!==o&&(i[e]=o,r?t[e]=o:o?t.setAttribute(e,o):t.removeAttribute(e))})}}An("unmount",function(t,e){if(typeof e.type=="string"){var n=e.__e;if(n){var i=n.U;if(i){n.U=void 0;for(var r in i){var s=i[r];s&&s.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}t(e)}),An("__h",function(t,e,n,i){(i<3||i===9)&&(e.__$f|=2),t(e,n,i)}),Qe.prototype.shouldComponentUpdate=function(t,e){var n=this.__$u,i=n&&n.s!==void 0;for(var r in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var s=2&this.__$f;if(!(i||s||4&this.__$f)||1&this.__$f)return!0}else if(!(i||4&this.__$f)||3&this.__$f)return!0;for(var o in t)if(o!=="__source"&&t[o]!==this.props[o])return!0;for(var a in this.props)if(!(a in t))return!0;return!1};function Ot(t){return ie(function(){return Gt(t)},[])}function qe(t){var e=W(t);return e.current=t,Wi.__$f|=4,ie(function(){return Ze(function(){return e.current()})},[])}var hp=typeof requestAnimationFrame>"u"?setTimeout:requestAnimationFrame,fp=function(t){queueMicrotask(function(){queueMicrotask(t)})};function pp(){mc(function(){for(var t;t=kc.shift();)vs.call(t)})}function mp(){kc.push(this)===1&&(F.requestAnimationFrame||hp)(pp)}function gp(){mc(function(){for(var t;t=Cc.shift();)vs.call(t)})}function Tc(){Cc.push(this)===1&&(F.requestAnimationFrame||fp)(gp)}function gn(t){var e=W(t);e.current=t,K(function(){return On(function(){return this.N=mp,e.current()})},[])}function wc(t,e){for(var n in e)t[n]=e[n];return t}function bs(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var i in e)if(i!=="__source"&&t[i]!==e[i])return!0;return!1}function _s(t,e){var n=e(),i=B({t:{__:n,u:e}}),r=i[0].t,s=i[1];return Rt(function(){r.__=n,r.u=e,ks(r)&&s({t:r})},[t,n,e]),K(function(){return ks(r)&&s({t:r}),t(function(){ks(r)&&s({t:r})})},[t]),n}function ks(t){var e,n,i=t.u,r=t.__;try{var s=i();return!((e=r)===(n=s)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Cs(t){t()}function Ss(t){return t}function Ts(){return[!1,Cs]}var ws=Rt;function zi(t,e){this.props=t,this.context=e}function Gi(t,e){function n(r){var s=this.props.ref,o=s==r.ref;return!o&&s&&(s.call?s(null):s.current=null),e?!e(this.props,r)||!o:bs(this.props,r)}function i(r){return this.shouldComponentUpdate=n,pe(t,r)}return i.displayName="Memo("+(t.displayName||t.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(zi.prototype=new Qe).isPureReactComponent=!0,zi.prototype.shouldComponentUpdate=function(t,e){return bs(this.props,t)||bs(this.state,e)};var Ec=F.__b;F.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Ec&&Ec(t)};var vp=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Y(t){function e(n){var i=wc({},n);return delete i.ref,t(i,n.ref||null)}return e.$$typeof=vp,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Pc=function(t,e){return t==null?null:Pt(Pt(t).map(e))},Kt={map:Pc,forEach:Pc,count:function(t){return t?Pt(t).length:0},only:function(t){var e=Pt(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:Pt},yp=F.__e;F.__e=function(t,e,n,i){if(t.then){for(var r,s=e;s=s.__;)if((r=s.__c)&&r.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),r.__c(t,e)}yp(t,e,n,i)};var xc=F.unmount;function Rc(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),t.__c.__H=null),(t=wc({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(i){return Rc(i,e,n)})),t}function Ic(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(i){return Ic(i,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function ui(){this.__u=0,this.o=null,this.__b=null}function Oc(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Ac(t){var e,n,i;function r(s){if(e||(e=t()).then(function(o){n=o.default||o},function(o){i=o}),i)throw i;if(!n)throw e;return pe(n,s)}return r.displayName="Lazy",r.__f=!0,r}function Dn(){this.i=null,this.l=null}F.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),xc&&xc(t)},(ui.prototype=new Qe).__c=function(t,e){var n=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(n);var r=Oc(i.__v),s=!1,o=function(){s||(s=!0,n.__R=null,r?r(a):a())};n.__R=o;var a=function(){if(!--i.__u){if(i.state.__a){var c=i.state.__a;i.__v.__k[0]=Ic(c,c.__c.__P,c.__c.__O)}var l;for(i.setState({__a:i.__b=null});l=i.o.pop();)l.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),t.then(o,o)},ui.prototype.componentWillUnmount=function(){this.o=[]},ui.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=Rc(this.__b,n,i.__O=i.__P)}this.__b=null}var r=e.__a&&pe(Ee,null,t.fallback);return r&&(r.__u&=-33),[pe(Ee,null,e.__a?null:t.children),r]};var Dc=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function bp(t){return this.getChildContext=function(){return t.context},t.children}function _p(t){var e=this,n=t.h;e.componentWillUnmount=function(){Ht(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),e.v||(e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],contains:function(){return!0},appendChild:function(i){this.childNodes.push(i),e.h.appendChild(i)},insertBefore:function(i,r){this.childNodes.push(i),e.h.insertBefore(i,r)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),e.h.removeChild(i)}}),Ht(pe(bp,{context:e.context},t.__v),e.v)}function Ki(t,e){var n=pe(_p,{__v:t,h:e});return n.containerInfo=e,n}(Dn.prototype=new Qe).__a=function(t){var e=this,n=Oc(e.__v),i=e.l.get(t);return i[0]++,function(r){var s=function(){e.props.revealOrder?(i.push(r),Dc(e,t,i)):r()};n?n(s):s()}},Dn.prototype.render=function(t){this.i=null,this.l=new Map;var e=Pt(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},Dn.prototype.componentDidUpdate=Dn.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){Dc(t,n,e)})};var Mc=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,kp=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Cp=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Sp=/[A-Z0-9]/g,Tp=typeof document<"u",wp=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function Nc(t,e,n){return e.__k==null&&(e.textContent=""),Ht(t,e),typeof n=="function"&&n(),t?t.__c:null}function Lc(t,e,n){return ss(t,e),typeof n=="function"&&n(),t?t.__c:null}Qe.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(Qe.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Uc=F.event;function Ep(){}function Pp(){return this.cancelBubble}function xp(){return this.defaultPrevented}F.event=function(t){return Uc&&(t=Uc(t)),t.persist=Ep,t.isPropagationStopped=Pp,t.isDefaultPrevented=xp,t.nativeEvent=t};var Es,Rp={enumerable:!1,configurable:!0,get:function(){return this.class}},Fc=F.vnode;F.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,i=e.type,r={},s=i.indexOf("-")===-1;for(var o in n){var a=n[o];if(!(o==="value"&&"defaultValue"in n&&a==null||Tp&&o==="children"&&i==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||i!=="input"&&i!=="textarea"||wp(n.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":Cp.test(o)&&(o=c):c=o="oninput":s&&kp.test(o)?o=o.replace(Sp,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&r[o=c]&&(o="oninputCapture"),r[o]=a}}i=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Pt(n.children).forEach(function(l){l.props.selected=r.value.indexOf(l.props.value)!=-1})),i=="select"&&r.defaultValue!=null&&(r.value=Pt(n.children).forEach(function(l){l.props.selected=r.multiple?r.defaultValue.indexOf(l.props.value)!=-1:r.defaultValue==l.props.value})),n.class&&!n.className?(r.class=n.class,Object.defineProperty(r,"className",Rp)):(n.className&&!n.class||n.class&&n.className)&&(r.class=r.className=n.className),e.props=r}(t),t.$$typeof=Mc,Fc&&Fc(t)};var Bc=F.__r;F.__r=function(t){Bc&&Bc(t),Es=t.__c};var jc=F.diffed;F.diffed=function(t){jc&&jc(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),Es=null};var Vc={ReactCurrentDispatcher:{current:{readContext:function(t){return Es.__n[t.__c].props.value},useCallback:re,useContext:It,useDebugValue:us,useDeferredValue:Ss,useEffect:K,useId:hs,useImperativeHandle:ds,useInsertionEffect:ws,useLayoutEffect:Rt,useMemo:ie,useReducer:ji,useRef:W,useState:B,useSyncExternalStore:_s,useTransition:Ts}}},Ip="18.3.1";function $c(t){return pe.bind(null,t)}function At(t){return!!t&&t.$$typeof===Mc}function qc(t){return At(t)&&t.type===Ee}function Wc(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function hi(t){return At(t)?os.apply(null,arguments):t}function Hc(t){return!!t.__k&&(Ht(null,t),!0)}function zc(t){return t&&(t.base||t.nodeType===1&&t)||null}var Gc=function(t,e){return t(e)},Ji=function(t,e){return t(e)},Kc=Ee,Jc=At,Dt={useState:B,useId:hs,useReducer:ji,useEffect:K,useLayoutEffect:Rt,useInsertionEffect:ws,useTransition:Ts,useDeferredValue:Ss,useSyncExternalStore:_s,startTransition:Cs,useRef:W,useImperativeHandle:ds,useMemo:ie,useCallback:re,useContext:It,useDebugValue:us,version:"18.3.1",Children:Kt,render:Nc,hydrate:Lc,unmountComponentAtNode:Hc,createPortal:Ki,createElement:pe,createContext:xe,createFactory:$c,cloneElement:hi,createRef:qa,Fragment:Ee,isValidElement:At,isElement:Jc,isFragment:qc,isMemo:Wc,findDOMNode:zc,Component:Qe,PureComponent:zi,memo:Gi,forwardRef:Y,flushSync:Ji,unstable_batchedUpdates:Gc,StrictMode:Kc,Suspense:ui,SuspenseList:Dn,lazy:Ac,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Vc};const Op=Object.freeze(Object.defineProperty({__proto__:null,Children:Kt,Component:Qe,Fragment:Ee,PureComponent:zi,StrictMode:Kc,Suspense:ui,SuspenseList:Dn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Vc,cloneElement:hi,createContext:xe,createElement:pe,createFactory:$c,createPortal:Ki,createRef:qa,default:Dt,findDOMNode:zc,flushSync:Ji,forwardRef:Y,hydrate:Lc,isElement:Jc,isFragment:qc,isMemo:Wc,isValidElement:At,lazy:Ac,memo:Gi,render:Nc,startTransition:Cs,unmountComponentAtNode:Hc,unstable_batchedUpdates:Gc,useCallback:re,useContext:It,useDebugValue:us,useDeferredValue:Ss,useEffect:K,useErrorBoundary:op,useId:hs,useImperativeHandle:ds,useInsertionEffect:ws,useLayoutEffect:Rt,useMemo:ie,useReducer:ji,useRef:W,useState:B,useSyncExternalStore:_s,useTransition:Ts,version:Ip},Symbol.toStringTag,{value:"Module"}));function ht(t){const e=It(t);if(e==null)throw new Error(`${t.displayName} cannot be used outside of provider`);return e}const Yc=xe(null);function Ap({value:t,children:e}){const n=ie(()=>Object.fromEntries(cs.map(i=>[i,Gt(t[i])])),[]);return cs.forEach(i=>{n[i].value=t[i]}),S(Yc.Provider,{value:n,children:e})}function Xc(){return ht(Yc)}function Ae(t){return Xc()[t]}const Dp="https://api.elevenlabs.io",Mp="https://api.us.elevenlabs.io",Np="wss://api.elevenlabs.io",Lp="wss://api.us.elevenlabs.io",Qc=xe(null);function Up({children:t}){const e=Ae("server-location"),n=ie(()=>{const i=Ze(()=>Fp(e.value));return{location:i,serverUrl:Ze(()=>i.value==="us"?Mp:Dp),webSocketUrl:Ze(()=>i.value==="us"?Lp:Np)}},[]);return S(Qc.Provider,{value:n,children:t})}function Ps(){return ht(Qc)}function Fp(t="us"){switch(t){case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}const Zc=xe(null);function Bp({children:t}){const{serverUrl:e}=Ps(),n=Ae("agent-id"),i=Ae("override-config"),r=Ot(null);gn(()=>{if(i.value)try{const d=JSON.parse(i.value);if(d){r.value=d;return}}catch(d){console.error(`[ConversationalAI] Cannot parse override-config: ${d==null?void 0:d.message}`)}if(!n.value){r.value=null;return}const l=new AbortController;return jp(n.value,e.value,l.signal).then(d=>{l.signal.aborted||(r.value=d)}).catch(d=>{console.error(`[ConversationalAI] Cannot fetch config for agent ${n.value}: ${d==null?void 0:d.message}`),l.signal.aborted||(r.value=null)}),()=>{l.abort()}});const s=Ae("variant"),o=Ae("expandable"),a=Ae("terms-key"),c=qe(()=>{if(!r.value)return null;const l=s.value??r.value.variant,d=o.value??r.value.expandable;return{...r.value,variant:tp(l),expandable:np(d,l),termsKey:a.value??r.value.terms_key}});return c.value?S(Zc.Provider,{value:c,children:t}):null}function vn(){return ht(Zc)}async function jp(t,e,n){const r=await(await fetch(`${e}/v1/convai/agents/${t}/widget`,{signal:n})).json();if(!r.widget_config)throw new Error("Response does not contain widget_config");return r.widget_config}const el=xe(null);function Vp({children:t}){const e=vn(),n=Ae("avatar-image-url"),i=Ae("avatar-orb-color-1"),r=Ae("avatar-orb-color-2"),s=qe(()=>n.value?{type:"image",url:n.value}:i.value&&r.value?{type:"orb",color_1:i.value,color_2:r.value}:e.value.avatar);return S(el.Provider,{value:s,children:t})}function $p(){return ht(el)}function qp(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var Wp=Object.defineProperty,Hp=(t,e,n)=>e in t?Wp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tl=(t,e,n)=>Hp(t,typeof e!="symbol"?e+"":e,n);let Ue=class{constructor(){tl(this,"_locking"),tl(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function ve(t,e){if(!t)throw new Error(e)}const zp=34028234663852886e22,Gp=-34028234663852886e22,Kp=4294967295,Jp=2147483647,Yp=-2147483648;function Yi(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>Jp||t<Yp)throw new Error("invalid int 32: "+t)}function xs(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Kp||t<0)throw new Error("invalid uint 32: "+t)}function nl(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>zp||t<Gp))throw new Error("invalid float 32: "+t)}const il=Symbol("@bufbuild/protobuf/enum-type");function Xp(t){const e=t[il];return ve(e,"missing enum type on enum object"),e}function rl(t,e,n,i){t[il]=sl(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function sl(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=ol(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function Qp(t,e,n){const i={};for(const r of e){const s=ol(r);i[s.localName]=s.no,i[s.no]=s.localName}return rl(i,t,e),i}function ol(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Rs{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Zp(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Rs),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function em(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Is(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const Xi=4294967296;function al(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=Xi&&(r=r+(i/Xi|0),i=i%Xi)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?ll(i,r):Os(i,r)}function tm(t,e){let n=Os(t,e);const i=n.hi&2147483648;i&&(n=ll(n.lo,n.hi));const r=cl(n.lo,n.hi);return i?"-"+r:r}function cl(t,e){if({lo:t,hi:e}=nm(t,e),e<=2097151)return String(Xi*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+dl(o)+dl(s)}function nm(t,e){return{lo:t>>>0,hi:e>>>0}}function Os(t,e){return{lo:t|0,hi:e|0}}function ll(t,e){return e=~e,t?t=~t+1:e+=1,Os(t,e)}const dl=t=>{const e=String(t);return"0000000".slice(e.length)+e};function ul(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function im(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function rm(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||process.env.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>ve(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>ve(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),al(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),al(r)},dec(r,s){return tm(r,s)},uDec(r,s){return cl(r,s)}}}const me=rm();var P;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(P||(P={}));var Jt;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Jt||(Jt={}));function Yt(t,e,n){if(e===n)return!0;if(t==P.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case P.UINT64:case P.FIXED64:case P.INT64:case P.SFIXED64:case P.SINT64:return e==n}return!1}function Mn(t,e){switch(t){case P.BOOL:return!1;case P.UINT64:case P.FIXED64:case P.INT64:case P.SFIXED64:case P.SINT64:return e==0?me.zero:"0";case P.DOUBLE:case P.FLOAT:return 0;case P.BYTES:return new Uint8Array(0);case P.STRING:return"";default:return 0}}function hl(t,e){switch(t){case P.BOOL:return e===!1;case P.STRING:return e==="";case P.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var _e;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(_e||(_e={}));class sm{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(xs(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Yi(e),ul(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){nl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){xs(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Yi(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Yi(e),e=(e<<1^e>>31)>>>0,ul(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=me.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=me.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=me.enc(e);return Is(n.lo,n.hi,this.buf),this}sint64(e){let n=me.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Is(r,s,this.buf),this}uint64(e){let n=me.uEnc(e);return Is(n.lo,n.hi,this.buf),this}}class om{constructor(e,n){this.varint64=em,this.uint32=im,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case _e.Varint:for(;this.buf[this.pos++]&128;);break;case _e.Bit64:this.pos+=4;case _e.Bit32:this.pos+=4;break;case _e.LengthDelimited:let r=this.uint32();this.pos+=r;break;case _e.StartGroup:for(;;){const[s,o]=this.tag();if(o===_e.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return me.dec(...this.varint64())}uint64(){return me.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,me.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return me.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return me.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function am(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function fl(t){const e=t.field.localName,n=Object.create(null);return n[e]=cm(t),[n,()=>n[e]]}function cm(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Mn(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function lm(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Qi=[];for(let t=0;t<Mt.length;t++)Qi[Mt[t].charCodeAt(0)]=t;Qi[45]=Mt.indexOf("+"),Qi[95]=Mt.indexOf("/");const pl={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=Qi[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=Mt[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Mt[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Mt[r|i>>6],e+=Mt[i&63],n=0;break}return n&&(e+=Mt[r],e+="=",n==1&&(e+="=")),e}};function dm(t,e,n){gl(e,t);const i=e.runtime.bin.makeReadOptions(n),r=lm(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=fl(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function um(t,e,n,i){gl(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(ml(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(d=>d.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const d of l)t.getType().runtime.bin.onUnknownField(t,d.no,d.wireType,d.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,d]=c.tag(),u=c.skip(d,l);t.getType().runtime.bin.onUnknownField(t,l,d,u)}}function ml(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function gl(t,e){ve(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function vl(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!hl(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function yl(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Mn(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Nt(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Rs.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function bl(t,e){return Nt(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}P.DOUBLE,P.FLOAT,P.INT64,P.UINT64,P.INT32,P.UINT32,P.BOOL,P.STRING,P.BYTES;const _l={ignoreUnknownFields:!1},kl={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function hm(t){return t?Object.assign(Object.assign({},_l),t):_l}function fm(t){return t?Object.assign(Object.assign({},kl),t):kl}const Zi=Symbol(),er=Symbol();function pm(){return{makeReadOptions:hm,makeWriteOptions:fm,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(ft(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}Cl(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const d=s.findExtension(o.substring(1,o.length-1));if(d&&d.extendee.typeName==t.typeName){l=!0;const[u,h]=fl(d);Cl(u,a,d.field,n,d),um(i,d,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!vl(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!gm(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Sl(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&ml(t,a)){const c=dm(t,a,e),l=Sl(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return fi(t,e,n??Jt.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||hl(t,e)))return tr(t,e)},debug:ft}}function ft(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Cl(t,e,n,i,r){let s=n.localName;if(n.repeated){if(ve(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ft(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ft(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=As(n.T,a,i.ignoreUnknownFields,!0);c!==er&&o.push(c);break;case"scalar":try{o.push(fi(n.T,a,n.L,!0))}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ft(a));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ft(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=mm(n.K,a)}catch(d){let u="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ft(e));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const d=As(n.V.T,c,i.ignoreUnknownFields,!0);d!==er&&(o[l]=d);break;case"scalar":try{o[l]=fi(n.V.T,c,Jt.BIGINT,!0)}catch(u){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ft(e));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];Nt(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=As(n.T,e,i.ignoreUnknownFields,!1);switch(c){case Zi:yl(n,t);break;case er:break;default:t[s]=c;break}break;case"scalar":try{const l=fi(n.T,e,n.L,!1);switch(l){case Zi:yl(n,t);break;default:t[s]=l;break}}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ft(e));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}function mm(t,e){if(t===P.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return fi(t,e,Jt.BIGINT,!0).toString()}function fi(t,e,n,i){if(e===null)return i?Mn(t,n):Zi;switch(t){case P.DOUBLE:case P.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==P.FLOAT&&nl(r),r;case P.INT32:case P.FIXED32:case P.SFIXED32:case P.SINT32:case P.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==P.UINT32||t==P.FIXED32?xs(s):Yi(s),s;case P.INT64:case P.SFIXED64:case P.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=me.parse(e);return n?o.toString():o;case P.FIXED64:case P.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=me.uParse(e);return n?a.toString():a;case P.BOOL:if(typeof e!="boolean")break;return e;case P.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case P.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return pl.dec(e)}throw new Error}function As(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Zi;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return er;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(ft(e)))}function gm(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Sl(t,e,n){if(t.kind=="map"){ve(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=tr(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Ds(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){ve(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(tr(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Ds(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return tr(t.T,e);case"enum":return Ds(t.T,e,n.enumAsInteger);case"message":return bl(t.T,e).toJson(n)}}function Ds(t,e,n){var i;if(ve(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function tr(t,e){switch(t){case P.INT32:case P.SFIXED32:case P.SINT32:case P.FIXED32:case P.UINT32:return ve(typeof e=="number"),e;case P.FLOAT:case P.DOUBLE:return ve(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case P.STRING:return ve(typeof e=="string"),e;case P.BOOL:return ve(typeof e=="boolean"),e;case P.UINT64:case P.FIXED64:case P.INT64:case P.SFIXED64:case P.SINT64:return ve(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case P.BYTES:return ve(e instanceof Uint8Array),pl.enc(e)}}const Nn=Symbol("@bufbuild/protobuf/unknown-fields"),Tl={readUnknownFields:!0,readerFactory:t=>new om(t)},wl={writeUnknownFields:!0,writerFactory:()=>new sm};function vm(t){return t?Object.assign(Object.assign({},Tl),t):Tl}function ym(t){return t?Object.assign(Object.assign({},wl),t):wl}function bm(){return{makeReadOptions:vm,makeWriteOptions:ym,listUnknownFields(t){var e;return(e=t[Nn])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Nn]},writeUnknownFields(t,e){const i=t[Nn];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Nn])||(r[Nn]=[]),r[Nn].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==_e.EndGroup));){const l=s.fields.find(a);if(!l){const d=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,d);continue}El(t,e,l,c,i)}if(r&&(c!=_e.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:El,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!vl(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Pl(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Pl(t,e,n,i)}}}function El(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?P.INT32:n.T;let c=ir;if(n.kind=="scalar"&&n.L>0&&(c=km),s){let h=t[o];if(i==_e.LengthDelimited&&a!=P.STRING&&a!=P.BYTES){let m=e.uint32()+e.pos;for(;e.pos<m;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(nr(e,new l,r,n)):Nt(t[o])?nr(e,t[o],r,n):(t[o]=nr(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[d,u]=_m(n,e,r);t[o][d]=u;break}}function nr(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function _m(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=ir(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=ir(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=nr(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Mn(t.K,Jt.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Mn(t.V.T,Jt.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function km(t,e){const n=ir(t,e);return typeof n=="bigint"?n.toString():n}function ir(t,e){switch(e){case P.STRING:return t.string();case P.BOOL:return t.bool();case P.DOUBLE:return t.double();case P.FLOAT:return t.float();case P.INT32:return t.int32();case P.INT64:return t.int64();case P.UINT64:return t.uint64();case P.FIXED64:return t.fixed64();case P.BYTES:return t.bytes();case P.FIXED32:return t.fixed32();case P.SFIXED32:return t.sfixed32();case P.SFIXED64:return t.sfixed64();case P.SINT64:return t.sint64();case P.UINT32:return t.uint32();case P.SINT32:return t.sint32()}}function Pl(t,e,n,i){ve(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?P.INT32:t.T;if(r)if(ve(Array.isArray(e)),t.packed)Sm(n,s,t.no,e);else for(const o of e)pi(n,s,t.no,o);else pi(n,s,t.no,e);break;case"message":if(r){ve(Array.isArray(e));for(const o of e)xl(n,i,t,o)}else xl(n,i,t,e);break;case"map":ve(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))Cm(n,i,t,o,a);break}}function Cm(t,e,n,i,r){t.tag(n.no,_e.LengthDelimited),t.fork();let s=i;switch(n.K){case P.INT32:case P.FIXED32:case P.UINT32:case P.SFIXED32:case P.SINT32:s=Number.parseInt(i);break;case P.BOOL:ve(i=="true"||i=="false"),s=i=="true";break}switch(pi(t,n.K,1,s),n.V.kind){case"scalar":pi(t,n.V.T,2,r);break;case"enum":pi(t,P.INT32,2,r);break;case"message":ve(r!==void 0),t.tag(2,_e.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function xl(t,e,n,i){const r=bl(n.T,i);n.delimited?t.tag(n.no,_e.StartGroup).raw(r.toBinary(e)).tag(n.no,_e.EndGroup):t.tag(n.no,_e.LengthDelimited).bytes(r.toBinary(e))}function pi(t,e,n,i){ve(i!==void 0);let[r,s]=Rl(e);t.tag(n,r)[s](i)}function Sm(t,e,n,i){if(!i.length)return;t.tag(n,_e.LengthDelimited).fork();let[,r]=Rl(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function Rl(t){let e=_e.Varint;switch(t){case P.BYTES:case P.STRING:e=_e.LengthDelimited;break;case P.DOUBLE:case P.FIXED64:case P.SFIXED64:e=_e.Bit64;break;case P.FIXED32:case P.SFIXED32:case P.FLOAT:e=_e.Bit32;break}const n=P[t].toLowerCase();return[e,n]}function Tm(){return{setEnumType:rl,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!Nt(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===P.BYTES&&(l=mi(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let d=o[r];i.T===P.BYTES&&(d=i.repeated?d.map(mi):mi(d)),s[r]=d;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===P.BYTES)for(const[f,m]of Object.entries(o[r]))s[r][f]=mi(m);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const f of Object.keys(o[r])){let m=o[r][f];h.fieldWrapper||(m=new h(m)),s[r][f]=m}break}break;case"message":const u=i.T;if(i.repeated)s[r]=o[r].map(h=>Nt(h,u)?h:new u(h));else{const h=o[r];u.fieldWrapper?u.typeName==="google.protobuf.BytesValue"?s[r]=mi(h):s[r]=h:s[r]=Nt(h,u)?h:new u(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>Yt(i.T,o,s[a]));case"enum":return r.every((o,a)=>Yt(P.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!Nt(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!Nt(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return Yt(P.INT32,r,s);case"scalar":return Yt(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return Yt(P.INT32,r.value,s.value);case"scalar":return Yt(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const d=i.V.T;return l.every(h=>d.equals(r[h],s[h]));case"enum":return l.every(h=>Yt(P.INT32,r[h],s[h]));case"scalar":const u=i.V.T;return l.every(h=>Yt(u,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(rr);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=rr(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:rr(s.value)}:{case:void 0}:o=rr(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function rr(t){if(t===void 0)return t;if(Nt(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function mi(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function wm(t,e,n){return{syntax:t,json:pm(),bin:bm(),util:Object.assign(Object.assign({},Tm()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return Zp(this,i,r,s)},makeEnum:Qp,makeEnumType:sl,getEnumType:Xp,makeExtension(i,r,s){return am(this,i,r,s)}}}class Em{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Il(t,e){const n=Ol(t);return e?n:Am(Om(n))}function Pm(t){return Il(t,!1)}const xm=Ol;function Ol(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const Rm=new Set(["constructor","toString","toJSON","valueOf"]),Im=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Al=t=>"".concat(t,"$"),Om=t=>Im.has(t)?Al(t):t,Am=t=>Rm.has(t)?Al(t):t;class Dm{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Pm(e)}addField(e){ve(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function Mm(t,e){var n,i,r,s,o,a;const c=[];let l;for(const d of typeof t=="function"?t():t){const u=d;if(u.localName=Il(d.name,d.oneof!==void 0),u.jsonName=(n=d.jsonName)!==null&&n!==void 0?n:xm(d.name),u.repeated=(i=d.repeated)!==null&&i!==void 0?i:!1,d.kind=="scalar"&&(u.L=(r=d.L)!==null&&r!==void 0?r:Jt.BIGINT),u.delimited=(s=d.delimited)!==null&&s!==void 0?s:!1,u.req=(o=d.req)!==null&&o!==void 0?o:!1,u.opt=(a=d.opt)!==null&&a!==void 0?a:!1,d.packed===void 0&&(u.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=P.BYTES&&d.T!=P.STRING),d.oneof!==void 0){const h=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!l||l.name!=h)&&(l=new Dm(h)),u.oneof=l,l.addField(u)}c.push(u)}return c}const T=wm("proto3",t=>new Em(t,e=>Mm(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Mn(e.T,e.L);break}}});class Be extends Rs{constructor(e){super(),this.seconds=me.zero,this.nanos=0,T.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(T.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=me.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Be.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Be({seconds:me.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Be().fromBinary(e,n)}static fromJson(e,n){return new Be().fromJson(e,n)}static fromJsonString(e,n){return new Be().fromJsonString(e,n)}static equals(e,n){return T.util.equals(Be,e,n)}}Be.runtime=T,Be.typeName="google.protobuf.Timestamp",Be.fields=T.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const Nm=T.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Be},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Lm,repeated:!0},{no:5,name:"events",kind:"message",T:Fm,repeated:!0}]),Lm=T.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Um,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Um=T.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Be},{no:3,name:"value",kind:"scalar",T:2}]),Fm=T.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Be},{no:7,name:"normalized_end_timestamp",kind:"message",T:Be,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Dl=T.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),tt=T.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ke=T.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ms=T.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),gi=T.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),vi=T.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),nt=T.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Ln=T.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Bm=T.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Re=T.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),sr=T.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:or,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Gl}]),or=T.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),jm=T.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:T.getEnumType(ke),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),yn=T.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:T.getEnumType(Un)},{no:4,name:"tracks",kind:"message",T:Fn,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:jm},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:T.getEnumType(yi)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:T.getEnumType(nt)},{no:18,name:"kind_details",kind:"enum",T:T.getEnumType(Vm),repeated:!0}]),Un=T.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),yi=T.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Vm=T.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),We=T.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),$m=T.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:bn,repeated:!0}]),Fn=T.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:T.getEnumType(tt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:T.getEnumType(ke)},{no:10,name:"layers",kind:"message",T:bn,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:$m,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:T.getEnumType(We)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Gl},{no:19,name:"audio_features",kind:"enum",T:T.getEnumType(Re),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:T.getEnumType(Dl)}]),bn=T.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:T.getEnumType(Ms)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),je=T.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:T.getEnumType(G)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Nl,oneof:"value"},{no:3,name:"speaker",kind:"message",T:qm,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Ll,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Wm,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Nm,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Ns,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Ul,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Fl,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Bl,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Us,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Fs,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Bs,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),G=T.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),qm=T.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Ml,repeated:!0}]),Ml=T.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Nl=T.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Ll=T.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Wm=T.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Hm,repeated:!0}]),Hm=T.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Ns=T.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Ul=T.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Fl=T.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Bl=T.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:jl,oneof:"value"}]),jl=T.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Vl=T.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),$l=T.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:T.getEnumType(ql)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ql=T.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),zm=T.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:T.getEnumType(Wl)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Wl=T.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"}]),Hl=T.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:zl},{no:2,name:"screen",kind:"message",T:zl},{no:3,name:"resume_connection",kind:"enum",T:T.getEnumType(vi)},{no:4,name:"disabled_codecs",kind:"message",T:Gm},{no:5,name:"force_relay",kind:"enum",T:T.getEnumType(vi)}]),zl=T.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:T.getEnumType(vi)}]),Gm=T.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:or,repeated:!0},{no:2,name:"publish",kind:"message",T:or,repeated:!0}]),Gl=T.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Ls=T.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Kl=T.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:T.getEnumType(Ls)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Jl=T.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Us=T.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:T.getEnumType(We)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Kl,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Jl,oneof:"content_header"}],{localName:"DataStream_Header"}),Fs=T.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Bs=T.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),it=T.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),js=T.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Km=T.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Jm=T.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:_n,oneof:"message"},{no:2,name:"answer",kind:"message",T:_n,oneof:"message"},{no:3,name:"trickle",kind:"message",T:qs,oneof:"message"},{no:4,name:"add_track",kind:"message",T:$s,oneof:"message"},{no:5,name:"mute",kind:"message",T:Ws,oneof:"message"},{no:6,name:"subscription",kind:"message",T:ar,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Xl,oneof:"message"},{no:8,name:"leave",kind:"message",T:cr,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Zl,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:id,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:rd,oneof:"message"},{no:13,name:"simulate",kind:"message",T:pt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:ed,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:ad,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Ql,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:eg,oneof:"message"}]),Yl=T.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:Ym,oneof:"message"},{no:2,name:"answer",kind:"message",T:_n,oneof:"message"},{no:3,name:"offer",kind:"message",T:_n,oneof:"message"},{no:4,name:"trickle",kind:"message",T:qs,oneof:"message"},{no:5,name:"update",kind:"message",T:Zm,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Hs,oneof:"message"},{no:8,name:"leave",kind:"message",T:cr,oneof:"message"},{no:9,name:"mute",kind:"message",T:Ws,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:tg,oneof:"message"},{no:11,name:"room_update",kind:"message",T:ng,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:rg,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:og,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:cg,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:lg,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Qm,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Xm,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:ug,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:pg,oneof:"message"},{no:22,name:"request_response",kind:"message",T:mg,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:gg,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:dg,oneof:"message"}]),Vs=T.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),$s=T.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:T.getEnumType(tt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:T.getEnumType(ke)},{no:9,name:"layers",kind:"message",T:bn,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Vs,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:T.getEnumType(We)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:T.getEnumType(Dl)},{no:17,name:"audio_features",kind:"enum",T:T.getEnumType(Re),repeated:!0}]),qs=T.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:T.getEnumType(it)},{no:3,name:"final",kind:"scalar",T:8}]),Ws=T.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),Ym=T.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:sr},{no:2,name:"participant",kind:"message",T:yn},{no:3,name:"other_participants",kind:"message",T:yn,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:td,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Hl},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:$l},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:or,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Xm=T.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:td,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Hl},{no:3,name:"server_info",kind:"message",T:$l},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Hs=T.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Fn}]),Qm=T.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),_n=T.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),Zm=T.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:yn,repeated:!0}]),ar=T.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Vl,repeated:!0}]),Xl=T.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:T.getEnumType(Ms)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Ql=T.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:T.getEnumType(Re),repeated:!0}]),eg=T.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),cr=T.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:T.getEnumType(nt)},{no:3,name:"action",kind:"enum",T:T.getEnumType(Bn)},{no:4,name:"regions",kind:"message",T:hg}]),Bn=T.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Zl=T.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:bn,repeated:!0}]),ed=T.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),td=T.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),tg=T.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Ml,repeated:!0}]),ng=T.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:sr}]),ig=T.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:T.getEnumType(gi)},{no:3,name:"score",kind:"scalar",T:2}]),rg=T.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ig,repeated:!0}]),sg=T.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:T.getEnumType(js)}]),og=T.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:sg,repeated:!0}]),zs=T.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:T.getEnumType(Ms)},{no:2,name:"enabled",kind:"scalar",T:8}]),ag=T.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:zs,repeated:!0}]),cg=T.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:zs,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:ag,repeated:!0}]),nd=T.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),id=T.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:nd,repeated:!0}]),lg=T.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),dg=T.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:sr},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:yn},{no:4,name:"other_participants",kind:"message",T:yn,repeated:!0}]),rd=T.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:_n},{no:2,name:"subscription",kind:"message",T:ar},{no:3,name:"publish_tracks",kind:"message",T:Hs,repeated:!0},{no:4,name:"data_channels",kind:"message",T:od,repeated:!0},{no:5,name:"offer",kind:"message",T:_n},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:sd,repeated:!0}]),sd=T.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),od=T.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:T.getEnumType(it)}]),pt=T.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:T.getEnumType(Km),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),ad=T.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),ug=T.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),hg=T.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:fg,repeated:!0}]),fg=T.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),pg=T.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:T.getEnumType(Bm)}]),mg=T.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:T.getEnumType(Gs)},{no:3,name:"message",kind:"scalar",T:9}]),Gs=T.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),gg=T.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function vg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lr={exports:{}},yg=lr.exports,cd;function bg(){return cd||(cd=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(yg,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(p,g){var v=p[g];if(typeof v.bind=="function")return v.bind(p);try{return Function.prototype.bind.call(v,p)}catch{return function(){return Function.prototype.apply.apply(v,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===n?!1:p==="trace"&&i?c:console[p]!==void 0?a(console,p):console.log!==void 0?a(console,"log"):e}function d(){for(var p=this.getLevel(),g=0;g<r.length;g++){var v=r[g];this[v]=g<p?e:this.methodFactory(v,p,this.name)}if(this.log=this.debug,typeof console===n&&p<this.levels.SILENT)return"No console available for logging"}function u(p){return function(){typeof console!==n&&(d.call(this),this[p].apply(this,arguments))}}function h(p,g,v){return l(p)||u.apply(this,arguments)}function f(p,g){var v=this,_,C,y,k="loglevel";typeof p=="string"?k+=":"+p:typeof p=="symbol"&&(k=void 0);function w(A){var U=(r[A]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=U;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+U+";"}catch{}}}function E(){var A;if(!(typeof window===n||!k)){try{A=window.localStorage[k]}catch{}if(typeof A===n)try{var U=window.document.cookie,$=encodeURIComponent(k),H=U.indexOf($+"=");H!==-1&&(A=/^([^;]+)/.exec(U.slice(H+$.length+1))[1])}catch{}return v.levels[A]===void 0&&(A=void 0),A}}function I(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function R(A){var U=A;if(typeof U=="string"&&v.levels[U.toUpperCase()]!==void 0&&(U=v.levels[U.toUpperCase()]),typeof U=="number"&&U>=0&&U<=v.levels.SILENT)return U;throw new TypeError("log.setLevel() called with invalid level: "+A)}v.name=p,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=g||h,v.getLevel=function(){return y??C??_},v.setLevel=function(A,U){return y=R(A),U!==!1&&w(y),d.call(v)},v.setDefaultLevel=function(A){C=R(A),E()||v.setLevel(A,!1)},v.resetLevel=function(){y=null,I(),d.call(v)},v.enableAll=function(A){v.setLevel(v.levels.TRACE,A)},v.disableAll=function(A){v.setLevel(v.levels.SILENT,A)},v.rebuild=function(){if(o!==v&&(_=R(o.getLevel())),d.call(v),o===v)for(var A in s)s[A].rebuild()},_=R(o?o.getLevel():"WARN");var D=E();D!=null&&(y=R(D)),d.call(v)}o=new f,o.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var v=s[g];return v||(v=s[g]=new f(g,o.methodFactory)),v};var m=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=m),o},o.getLoggers=function(){return s},o.default=o,o})}(lr)),lr.exports}var dr=bg(),Ks;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Ks||(Ks={}));var rt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(rt||(rt={}));let X=dr.getLogger("livekit");Object.values(rt).map(t=>dr.getLogger(t)),X.setDefaultLevel(Ks.info);function Lt(t){const e=dr.getLogger(t);return e.setDefaultLevel(X.getLevel()),e}const _g=dr.getLogger("lk-e2ee"),bi=7e3,kg=[0,300,2*2*300,3*3*300,4*4*300,bi,bi,bi,bi,bi];class Cg{constructor(e){this._retryDelays=e!==void 0?[...e]:kg}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function Sg(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function b(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(i.next(d))}catch(u){o(u)}}function c(d){try{l(i.throw(d))}catch(u){o(u)}}function l(d){d.done?s(d.value):r(d.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function ld(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ut(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ld=="function"?ld(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}typeof SuppressedError=="function"&&SuppressedError;var ur={exports:{}},dd;function Tg(){if(dd)return ur.exports;dd=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,w,E){return Function.prototype.apply.call(k,w,E)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function i(y){console&&console.warn&&console.warn(y)}var r=Number.isNaN||function(k){return k!==k};function s(){s.init.call(this)}ur.exports=s,ur.exports.once=v,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");o=y}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(y){return y._maxListeners===void 0?s.defaultMaxListeners:y._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(k){for(var w=[],E=1;E<arguments.length;E++)w.push(arguments[E]);var I=k==="error",R=this._events;if(R!==void 0)I=I&&R.error===void 0;else if(!I)return!1;if(I){var D;if(w.length>0&&(D=w[0]),D instanceof Error)throw D;var A=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw A.context=D,A}var U=R[k];if(U===void 0)return!1;if(typeof U=="function")e(U,this,w);else for(var $=U.length,H=m(U,$),E=0;E<$;++E)e(H[E],this,w);return!0};function l(y,k,w,E){var I,R,D;if(a(w),R=y._events,R===void 0?(R=y._events=Object.create(null),y._eventsCount=0):(R.newListener!==void 0&&(y.emit("newListener",k,w.listener?w.listener:w),R=y._events),D=R[k]),D===void 0)D=R[k]=w,++y._eventsCount;else if(typeof D=="function"?D=R[k]=E?[w,D]:[D,w]:E?D.unshift(w):D.push(w),I=c(y),I>0&&D.length>I&&!D.warned){D.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.emitter=y,A.type=k,A.count=D.length,i(A)}return y}s.prototype.addListener=function(k,w){return l(this,k,w,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(k,w){return l(this,k,w,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(y,k,w){var E={fired:!1,wrapFn:void 0,target:y,type:k,listener:w},I=d.bind(E);return I.listener=w,E.wrapFn=I,I}s.prototype.once=function(k,w){return a(w),this.on(k,u(this,k,w)),this},s.prototype.prependOnceListener=function(k,w){return a(w),this.prependListener(k,u(this,k,w)),this},s.prototype.removeListener=function(k,w){var E,I,R,D,A;if(a(w),I=this._events,I===void 0)return this;if(E=I[k],E===void 0)return this;if(E===w||E.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete I[k],I.removeListener&&this.emit("removeListener",k,E.listener||w));else if(typeof E!="function"){for(R=-1,D=E.length-1;D>=0;D--)if(E[D]===w||E[D].listener===w){A=E[D].listener,R=D;break}if(R<0)return this;R===0?E.shift():p(E,R),E.length===1&&(I[k]=E[0]),I.removeListener!==void 0&&this.emit("removeListener",k,A||w)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(k){var w,E,I;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[k]),this;if(arguments.length===0){var R=Object.keys(E),D;for(I=0;I<R.length;++I)D=R[I],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=E[k],typeof w=="function")this.removeListener(k,w);else if(w!==void 0)for(I=w.length-1;I>=0;I--)this.removeListener(k,w[I]);return this};function h(y,k,w){var E=y._events;if(E===void 0)return[];var I=E[k];return I===void 0?[]:typeof I=="function"?w?[I.listener||I]:[I]:w?g(I):m(I,I.length)}s.prototype.listeners=function(k){return h(this,k,!0)},s.prototype.rawListeners=function(k){return h(this,k,!1)},s.listenerCount=function(y,k){return typeof y.listenerCount=="function"?y.listenerCount(k):f.call(y,k)},s.prototype.listenerCount=f;function f(y){var k=this._events;if(k!==void 0){var w=k[y];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function m(y,k){for(var w=new Array(k),E=0;E<k;++E)w[E]=y[E];return w}function p(y,k){for(;k+1<y.length;k++)y[k]=y[k+1];y.pop()}function g(y){for(var k=new Array(y.length),w=0;w<k.length;++w)k[w]=y[w].listener||y[w];return k}function v(y,k){return new Promise(function(w,E){function I(D){y.removeListener(k,R),E(D)}function R(){typeof y.removeListener=="function"&&y.removeListener("error",I),w([].slice.call(arguments))}C(y,k,R,{once:!0}),k!=="error"&&_(y,I,{once:!0})})}function _(y,k,w){typeof y.on=="function"&&C(y,"error",k,w)}function C(y,k,w,E){if(typeof y.on=="function")E.once?y.once(k,w):y.on(k,w);else if(typeof y.addEventListener=="function")y.addEventListener(k,function I(R){E.once&&y.removeEventListener(k,I),w(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}return ur.exports}var mt=Tg();let ud=!0,hd=!0;function _i(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function kn(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function wg(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(ud=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Eg(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(hd=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function fd(){if(typeof window=="object"){if(ud)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Js(t,e){hd&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Pg(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(_i(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(_i(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(_i(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=_i(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function pd(t){return Object.prototype.toString.call(t)==="[object Object]"}function md(t){return pd(t)?Object.keys(t).reduce(function(e,n){const i=pd(t[n]),r=i?md(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function Ys(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Ys(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Ys(t,t.get(r),n)})}))}function gd(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&Ys(t,a,r)})}),r}const vd=fd;function yd(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const d=typeof a[l]=="object"?a[l]:{ideal:a[l]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const u=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(d.ideal!==void 0){c.optional=c.optional||[];let h={};typeof d.ideal=="number"?(h[u("min",l)]=d.ideal,c.optional.push(h),h={},h[u("max",l)]=d.ideal,c.optional.push(h)):(h[u("",l)]=d.ideal,c.optional.push(h))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[u("",l)]=d.exact):["min","max"].forEach(h=>{d[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[u(h,l)]=d[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(d,u,h){u in d&&!(h in d)&&(d[h]=d[u],delete d[u])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const d=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let u;if(l.exact==="environment"||l.ideal==="environment"?u=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(u=["front"]),u)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(m=>m.kind==="videoinput");let f=h.find(m=>u.some(p=>m.label.toLowerCase().includes(p)));return!f&&h.length&&u.includes("back")&&(f=h[h.length-1]),f&&(a.video.deviceId=l.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),vd("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return vd("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,d=>{n.webkitGetUserMedia(d,c,u=>{l&&l(s(u))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(d=>{if(l.audio&&!d.getAudioTracks().length||l.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(s(d))))}}}function bd(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function _d(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else kn(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function kd(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Cd(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>gd(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),kn(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>gd(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Sd(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function Td(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Sd(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(u=>this._reverseStreams[u.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const u=new t.MediaStream(d.getTracks());this._streams[d.id]=u,this._reverseStreams[u.id]=d,d=u}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(p=>p===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[u.id];if(m)m.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([d]);this._streams[u.id]=p,this._reverseStreams[p.id]=u,this.addStream(p)}return this.getSenders().find(p=>p.track===d)};function s(l,d){let u=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],m=l._streams[f.id];u=u.replace(new RegExp(m.id,"g"),f.id)}),new RTCSessionDescription({type:d.type,sdp:u})}function o(l,d){let u=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],m=l._streams[f.id];u=u.replace(new RegExp(f.id,"g"),m.id)}),new RTCSessionDescription({type:d.type,sdp:u})}["createOffer","createAnswer"].forEach(function(l){const d=t.RTCPeerConnection.prototype[l],u={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[m=>{const p=s(this,m);h[0].apply(null,[p])},m=>{h[1]&&h[1].apply(null,m)},arguments[2]]):d.apply(this,arguments).then(m=>s(this,m))}};t.RTCPeerConnection.prototype[l]=u[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(p=>d.track===p)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Xs(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function wd(t,e){kn(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Ed=Object.freeze({__proto__:null,fixNegotiationNeeded:wd,shimAddTrackRemoveTrack:Td,shimAddTrackRemoveTrackWithNative:Sd,shimGetSendersWithDtmf:kd,shimGetUserMedia:yd,shimMediaStream:bd,shimOnTrack:_d,shimPeerConnection:Xs,shimSenderReceiverGetStats:Cd});function Pd(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){Js("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function xg(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function xd(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qs(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((d,u)=>{c.set(u,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,a)}}function Rd(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Id(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),kn(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Od(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Js("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Ad(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Dd(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Md(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Nd(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Ld(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Ud=Object.freeze({__proto__:null,shimAddTransceiver:Dd,shimCreateAnswer:Ld,shimCreateOffer:Nd,shimGetDisplayMedia:xg,shimGetParameters:Md,shimGetUserMedia:Pd,shimOnTrack:xd,shimPeerConnection:Qs,shimRTCDataChannel:Ad,shimReceiverGetStats:Id,shimRemoveStream:Od,shimSenderGetStats:Rd});function Fd(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function Bd(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function jd(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,d){const u=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[u]);return d?(h.then(l,d),Promise.resolve()):h},e.createAnswer=function(l,d){const u=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[u]);return d?(h.then(l,d),Promise.resolve()):h};let a=function(c,l,d){const u=r.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u};e.setLocalDescription=a,a=function(c,l,d){const u=s.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u},e.setRemoteDescription=a,a=function(c,l,d){const u=o.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u},e.addIceCandidate=a}function Vd(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i($d(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function $d(t){return t&&t.video!==void 0?Object.assign({},t,{video:md(t.video)}):t}function qd(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Js("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Wd(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Hd(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function zd(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Gd=Object.freeze({__proto__:null,shimAudioContext:zd,shimCallbacksAPI:jd,shimConstraints:$d,shimCreateOfferLegacy:Hd,shimGetUserMedia:Vd,shimLocalStreamsAPI:Fd,shimRTCIceServerUrls:qd,shimRemoteStreamsAPI:Bd,shimTrackEventTransceiver:Wd}),Zs={exports:{}},Kd;function Rg(){return Kd||(Kd=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const d=e.parseRtpMap(l),u=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=u.length?e.parseFmtp(u[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(m=>parseInt(m,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(f.rtx={ssrc:l}),i.push(f),s&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&c&&i.push({ssrc:c});let u=e.matchPrefix(n,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substring(5),10)*1e3*.95-50*40*8:u=void 0,i.forEach(h=>{h.maxBitrate=u})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Zs)),Zs.exports}var Jd=Rg(),jn=vg(Jd),Ig=qp({__proto__:null,default:jn},[Jd]);function hr(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=jn.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,kn(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function eo(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||kn(t,"icecandidate",e=>{if(e.candidate){const n=jn.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function fr(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=jn.splitSections(a.sdp);return c.shift(),c.some(l=>{const d=jn.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const d=jn.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),d=s(arguments[0],c);let u;l===0&&d===0?u=Number.POSITIVE_INFINITY:l===0||d===0?u=Math.max(l,d):u=Math.min(l,d);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return u}}),this._sctp=h}return o.apply(this,arguments)}}function pr(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},kn(t,"datachannel",i=>(e(i.channel,i.target),i))}function to(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function no(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function mr(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function gr(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var Og=Object.freeze({__proto__:null,removeExtmapAllowMixed:no,shimAddIceCandidateNullOrEmpty:mr,shimConnectionState:to,shimMaxMessageSize:fr,shimParameterlessSetLocalDescription:gr,shimRTCIceCandidate:hr,shimRTCIceCandidateRelayProtocol:eo,shimSendThrowTypeError:pr});function Ag(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=fd,i=Pg(t),r={browserDetails:i,commonShim:Og,extractVersion:_i,disableLog:wg,disableWarnings:Eg,sdp:Ig};switch(i.browser){case"chrome":if(!Ed||!Xs||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Ed,mr(t,i),gr(t),yd(t,i),bd(t),Xs(t,i),_d(t),Td(t,i),kd(t),Cd(t),wd(t,i),hr(t),eo(t),to(t),fr(t,i),pr(t),no(t,i);break;case"firefox":if(!Ud||!Qs||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Ud,mr(t,i),gr(t),Pd(t,i),Qs(t,i),xd(t),Od(t),Rd(t),Id(t),Ad(t),Dd(t),Md(t),Nd(t),Ld(t),hr(t),to(t),fr(t,i),pr(t);break;case"safari":if(!Gd||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Gd,mr(t,i),gr(t),qd(t),Hd(t),jd(t),Fd(t),Bd(t),Wd(t),Vd(t),zd(t),hr(t),eo(t),fr(t,i),pr(t),no(t,i);break;default:n("Unsupported browser!");break}return r}Ag({window:typeof window>"u"?void 0:window});const Dg=10,ki="lk_e2ee",Mg={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:Dg,keyringSize:16};var Xt;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Xt||(Xt={}));var Yd;(function(t){t.KeyRatcheted="keyRatcheted"})(Yd||(Yd={}));var Qt;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Qt||(Qt={}));var Xd;(function(t){t.Error="cryptorError"})(Xd||(Xd={}));function Ng(){return Lg()||io()}function io(){return typeof window.RTCRtpScriptTransform<"u"}function Lg(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class Bk extends mt.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{X.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Mg),e),this.on(Xt.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Xt.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Xt.RatchetRequest,e,n)}}class Zt extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Z;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(Z||(Z={}));class de extends Zt{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=Z[n]}}class ro extends Zt{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ft extends Zt{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class Ug extends Zt{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Pe extends Zt{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class so extends Zt{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Qd extends Zt{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Zd extends Zt{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Gs[n]}}var vr;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(vr||(vr={})),function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e}(vr||(vr={}));var eu;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(eu||(eu={}));var O;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(O||(O={}));var L;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(L||(L={}));var N;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(N||(N={}));var M;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(M||(M={}));function Fg(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const Bg=/version\/(\d+(\.?_?\d+)+)/i;let oo;function He(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(oo===void 0||e){const i=jg.find(r=>{let{test:s}=r;return s.test(n)});oo=i==null?void 0:i.describe(n)}return oo}const jg=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:yr(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:ao(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:yr(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:ao(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:yr(Bg,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:ao(t)}}}];function yr(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function ao(t){return t.includes("mac os")?yr(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var Vg="2.14.0";const $g=Vg,qg=16;class De{}De.setTimeout=function(){return setTimeout(...arguments)},De.setInterval=function(){return setInterval(...arguments)},De.clearTimeout=function(){return clearTimeout(...arguments)},De.clearInterval=function(){return clearInterval(...arguments)};const Wg=5e3,Ci=[];var et;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(et||(et={}));class x extends mt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=x.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=X,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),Wg):this.handleAppVisibilityChanged()},this.log=Lt((r=i.loggerName)!==null&&r!==void 0?r:rt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=x.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),J(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===x.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===x.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Ci.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Ci.splice(Ci.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Vn(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?M.AudioPlaybackStarted:M.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?M.AudioPlaybackFailed:M.VideoPlaybackFailed,s):s.name==="AbortError"?X.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):X.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(M.ElementAttached,e),e}detach(e){try{if(e){$n(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(M.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{$n(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(M.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Lt(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Ci.forEach(i=>{i.parentElement||(n=!1)}),n&&Ci.push(e)}}handleAppVisibilityChanged(){return b(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===x.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){$e()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){$e()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Vn(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Wn()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Wn()||qn())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function $n(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return tt.AUDIO;case e.Video:return tt.VIDEO;default:return tt.DATA}}t.kindToProto=r;function s(l){switch(l){case tt.AUDIO:return e.Audio;case tt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return ke.CAMERA;case n.Microphone:return ke.MICROPHONE;case n.ScreenShare:return ke.SCREEN_SHARE;case n.ScreenShareAudio:return ke.SCREEN_SHARE_AUDIO;default:return ke.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case ke.CAMERA:return n.Camera;case ke.MICROPHONE:return n.Microphone;case ke.SCREEN_SHARE:return n.ScreenShare;case ke.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case js.ACTIVE:return i.Active;case js.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(x||(x={}));class se{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Hg=["vp8","h264"],zg=["vp8","h264","vp9","av1"];function Gg(t){return!!Hg.find(e=>e===t)}var tu;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(tu||(tu={}));var co;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(co||(co={}));const Si={h90:new se(160,90,9e4,20),h180:new se(320,180,16e4,20),h216:new se(384,216,18e4,20),h360:new se(640,360,45e4,20),h540:new se(960,540,8e5,25),h720:new se(1280,720,17e5,30),h1080:new se(1920,1080,3e6,30),h1440:new se(2560,1440,5e6,30),h2160:new se(3840,2160,8e6,30)},lo={h120:new se(160,120,7e4,20),h180:new se(240,180,125e3,20),h240:new se(320,240,14e4,20),h360:new se(480,360,33e4,20),h480:new se(640,480,5e5,20),h540:new se(720,540,6e5,25),h720:new se(960,720,13e5,30),h1080:new se(1440,1080,23e5,30),h1440:new se(1920,1440,38e5,30)},uo={h360fps3:new se(640,360,2e5,3,"medium"),h360fps15:new se(640,360,4e5,15,"medium"),h720fps5:new se(1280,720,8e5,5,"medium"),h720fps15:new se(1280,720,15e5,15,"medium"),h720fps30:new se(1280,720,2e6,30,"medium"),h1080fps15:new se(1920,1080,25e5,15,"medium"),h1080fps30:new se(1920,1080,5e6,30,"medium"),original:new se(0,0,7e6,30,"medium")},Kg="|",nu="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Jg(t){const e=t.split(Kg);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ve(t){return b(this,void 0,void 0,function*(){return new Promise(e=>De.setTimeout(e,t))})}function ho(){return"addTransceiver"in RTCPeerConnection.prototype}function fo(){return"addTrack"in RTCPeerConnection.prototype}function Yg(){if(!("getCapabilities"in RTCRtpSender)||Wn())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function Xg(){if(!("getCapabilities"in RTCRtpSender)||qn())return!1;if(Wn()){const n=He();if(n!=null&&n.version&&yt(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&yt(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function gt(t){return t==="av1"||t==="vp9"}function po(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function Qg(){return typeof RTCPeerConnection>"u"?!1:ho()||fo()}function qn(){var t;return((t=He())===null||t===void 0?void 0:t.name)==="Firefox"}function Wn(){var t;return((t=He())===null||t===void 0?void 0:t.name)==="Safari"}function mo(){const t=He();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function Zg(){const t=He();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&yt(t.osVersion,"17")>=0}function ev(t){return t||(t=He()),(t==null?void 0:t.name)==="Safari"&&yt(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&yt(t.osVersion,"18.3")>0}function iu(){var t,e;return $e()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function tv(){const t=He(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&yt(e,t.osVersion)>=0?!0:t.name==="Safari"&&yt(e,t.version)>=0}function $e(){return typeof document<"u"}function vt(){return navigator.product=="ReactNative"}function go(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function ru(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function su(){if(!vt())return;let t=ru();if(t)return t.platform}function ou(){if($e())return window.devicePixelRatio;if(vt()){let t=ru();if(t)return t.devicePixelRatio}return 1}function yt(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function nv(t){for(const e of t)e.target.handleResize(e)}function iv(t){for(const e of t)e.target.handleVisibilityChanged(e)}let vo=null;const au=()=>(vo||(vo=new ResizeObserver(nv)),vo);let yo=null;const cu=()=>(yo||(yo=new IntersectionObserver(iv,{root:null,rootMargin:"0px"})),yo);function rv(){var t;const e=new zm({sdk:Wl.JS,protocol:qg,version:$g});return vt()&&(e.os=(t=su())!==null&&t!==void 0?t:""),e}function lu(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Ti;function bo(){if(!Ti){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Ti]=i.stream.getAudioTracks(),!Ti)throw Error("Could not get empty media stream audio track");Ti.enabled=!1}return Ti.clone()}class Hn{constructor(e,n){this.onFinally=n,this.promise=new Promise((i,r)=>b(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;return(i=this.onFinally)===null||i===void 0?void 0:i.call(this)})}}function sv(t){return zg.includes(t)}function en(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function ov(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function _o(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function av(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const d=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),u=Date.now();return c?e.delete(i):e.set(i,d),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:d,lastReceivedTime:u}})}function cv(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function du(t){switch(t.reason){case Z.LeaveRequest:return t.context;case Z.Cancelled:return nt.CLIENT_INITIATED;case Z.NotAllowed:return nt.USER_REJECTED;case Z.ServerUnreachable:return nt.JOIN_FAILURE;default:return nt.UNKNOWN_REASON}}function br(t){return t!==void 0?Number(t):void 0}function Cn(t){return t!==void 0?BigInt(t):void 0}function zn(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function bt(t){return!!t&&t.kind==x.Kind.Audio}function Sn(t){return!!t&&t.kind==x.Kind.Video}function tn(t){return zn(t)&&Sn(t)}function Bt(t){return zn(t)&&bt(t)}function ko(t){return!!t&&!t.isLocal}function lv(t){return!!t&&!t.isLocal}function Co(t){return ko(t)&&Sn(t)}function dv(t){return t.isLocal}function uv(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function uu(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=pu(t??{}),d=e==null?void 0:e.processor,u=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(So(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||d)&&(h.audio.processor=c??d)),h.video&&(So(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||u)&&(h.video.processor=l??u)),h}function So(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function To(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":So(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function hu(t){return b(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=fu();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Ve(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function fu(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>b(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function hv(t){return t==="audioinput"?x.Source.Microphone:t==="videoinput"?x.Source.Camera:x.Source.Unknown}function wo(t){return t===x.Source.Microphone?"audioinput":t===x.Source.Camera?"videoinput":void 0}function fv(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Wn()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function _r(t){return t.split("/")[1].toLowerCase()}function pv(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Hs({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function J(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?J(t.track):{})}}function mv(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function gv(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function pu(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:Fg(e)}}function vv(t){switch(t){case ke.CAMERA:return x.Source.Camera;case ke.MICROPHONE:return x.Source.Microphone;case ke.SCREEN_SHARE:return x.Source.ScreenShare;case ke.SCREEN_SHARE_AUDIO:return x.Source.ScreenShareAudio;default:return x.Source.Unknown}}class yv extends mt.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:s,data:o}=n.data;switch(s){case"error":X.error(o.error.message),this.emit(Qt.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(Qt.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Qt.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(Xt.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break}},this.onWorkerError=n=>{X.error("e2ee worker encountered an error:",{error:n.error}),this.emit(Qt.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!Ng())throw new ro("tried to setup end-to-end encryption on an unsupported browser");if(X.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:_g.getLevel()}};this.worker&&(X.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){X.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?X.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(N.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(O.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==We.NONE,r.identity)),e.on(O.ConnectionStateChanged,i=>{i===ee.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==We.NONE,r.identity)})})}).on(O.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(O.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(O.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(L.LocalSenderCreated,(i,r)=>b(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),n.on(Xt.SetKey,i=>this.postKey(i)).on(Xt.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?_r(i.mimeType):void 0)}}setupE2EESender(e,n){if(!zn(e)||!n){n||X.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return b(this,void 0,void 0,function*(){if(this.worker){if(io()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(ki in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:ki in e}};this.worker.postMessage(a,[o,s])}e[ki]=!0}})}handleSender(e,n,i){var r;if(!(ki in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(io()){X.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{X.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[ki]=!0}}}const Eo="default";class Ie{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ie),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Ie.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){X.debug("awaiting getUserMedia promise");try{n?yield Ie.userMediaPromiseMap.get(n):yield Promise.all(Ie.userMediaPromiseMap.values())}catch{X.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Wn()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",d=n?c.kind===n:!0;return l&&d}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(d=>{d.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return b(this,void 0,void 0,function*(){if(n!==Eo)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===Eo);if(!s){X.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==Eo&&a.groupId===(i??s.groupId));if(!o){X.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Ie.userMediaPromiseMap.has(e):Ie.userMediaPromiseMap.size>0}}Ie.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Ie.userMediaPromiseMap=new Map;var wi;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(wi||(wi={}));class bv{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ue,this.nextTaskIndex=0}run(e){return b(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:wi.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=wi.RUNNING,yield e()}finally{n.status=wi.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return b(this,void 0,void 0,function*(){return this.run(()=>b(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function _v(t,e){const n=new URL(ov(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),mu(n,"rtc")}function kv(t){const e=new URL(_o(t));return mu(e,"validate")}function Cv(t){return t.endsWith("/")?t:"".concat(t,"/")}function mu(t,e){return t.pathname="".concat(Cv(t.pathname)).concat(e),t.toString()}const Sv=["syncState","trickle","offer","answer","simulate","leave"];function Tv(t){const e=Sv.indexOf(t.case)>=0;return X.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var he;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(he||(he={}));class Po{get currentState(){return this.state}get isDisconnected(){return this.state===he.DISCONNECTING||this.state===he.DISCONNECTED}get isEstablishingConnection(){return this.state===he.CONNECTING||this.state===he.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=he.DISCONNECTED,this.log=X,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Lt((i=n.loggerName)!==null&&i!==void 0?i:rt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new bv,this.queuedRequests=[],this.closingLock=new Ue,this.connectionLock=new Ue,this.state=he.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return b(this,void 0,void 0,function*(){return this.state=he.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return b(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=he.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const s=rv(),o=wv(n,s,i),a=_v(e,o),c=kv(a);return new Promise((l,d)=>b(this,void 0,void 0,function*(){const u=yield this.connectionLock.lock();try{const h=()=>b(this,void 0,void 0,function*(){this.close(),clearTimeout(f),d(new de("room connection has been cancelled (signal)",Z.Cancelled))}),f=setTimeout(()=>{this.close(),d(new de("room connection has timed out (signal)",Z.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const m=new URL(a);m.searchParams.has("access_token")&&m.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(m),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(f)},this.ws.onerror=p=>b(this,void 0,void 0,function*(){if(this.state!==he.CONNECTED){this.state=he.DISCONNECTED,clearTimeout(f);try{const g=yield fetch(c);if(g.status.toFixed(0).startsWith("4")){const v=yield g.text();d(new de(v,Z.NotAllowed,g.status))}else d(new de("Encountered unknown websocket error during connection: ".concat(p.toString()),Z.InternalError,g.status))}catch(g){d(new de(g instanceof Error?g.message:"server was not reachable",Z.ServerUnreachable))}return}this.handleWSError(p)}),this.ws.onmessage=p=>b(this,void 0,void 0,function*(){var g,v,_;let C;if(typeof p.data=="string"){const y=JSON.parse(p.data);C=Yl.fromJson(y,{ignoreUnknownFields:!0})}else if(p.data instanceof ArrayBuffer)C=Yl.fromBinary(new Uint8Array(p.data));else{this.log.error("could not decode websocket message: ".concat(typeof p.data),this.logContext);return}if(this.state!==he.CONNECTED){let y=!1;if(((g=C.message)===null||g===void 0?void 0:g.case)==="join"?(this.state=he.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=C.message.value.pingTimeout,this.pingIntervalDuration=C.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(C.message.value)):this.state===he.RECONNECTING&&C.message.case!=="leave"?(this.state=he.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((v=C.message)===null||v===void 0?void 0:v.case)==="reconnect"?l(C.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),y=!0)):this.isEstablishingConnection&&C.message.case==="leave"?d(new de("Received leave request while trying to (re)connect",Z.LeaveRequest,void 0,C.message.value.reason)):i.reconnect||d(new de("did not receive join response, got ".concat((_=C.message)===null||_===void 0?void 0:_.case," instead"),Z.InternalError)),!y)return}this.signalLatency&&(yield Ve(this.signalLatency)),this.handleSignalResponse(C)}),this.ws.onclose=p=>{this.isEstablishingConnection&&d(new de("Websocket got closed during a (re)connection attempt",Z.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:p.reason,code:p.code,wasClean:p.wasClean,state:this.state})),this.handleOnClose(p.reason)}}finally{u()}}))}close(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=he.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,Ve(250)])),e.ws=void 0}}finally{n&&(e.state=he.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:kr(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:kr(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new qs({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Ws({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new ed({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Zl({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new id({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:me.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new ad({timestamp:me.parse(Date.now()),rtt:me.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Ql({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new cr({reason:nt.CLIENT_INITIATED,action:Bn.DISCONNECT})})}sendRequest(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!Tv(n)&&i.state===he.RECONNECTING){i.queuedRequests.push(()=>b(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ve(i.signalLatency)),!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new Jm({message:n});try{i.useJSON?i.ws.send(o.toJsonString()):i.ws.send(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=gu(r.value);this.onAnswer&&this.onAnswer(o,r.value.id)}else if(r.case==="offer"){const o=gu(r.value);this.onOffer&&this.onOffer(o,r.value.id)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return b(this,void 0,void 0,function*(){if(this.state===he.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=De.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&De.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=De.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&De.clearInterval(this.pingInterval)}}function gu(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function kr(t,e){return new _n({sdp:t.sdp,type:t.type,id:e})}function wv(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",vt()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class vu{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class Ev{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var st={},xo={},Ro={exports:{}},yu;function Io(){if(yu)return Ro.exports;yu=1;var t=Ro.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Ro.exports}var bu;function Pv(){return bu||(bu=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var u=0;u<l.length;u+=1)a[u+1]!=null&&(c[l[u]]=e(a[u+1]))},i=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var u=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),u,a.names,a.name),a.push&&c[a.push].push(u)},r=Io(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(u){var h=u[0],f=u.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var m=0;m<(r[h]||[]).length;m+=1){var p=r[h][m];if(p.reg.test(f))return i(p,d,f)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,u=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),u=!0),{scid:d,paused:u}})})}}(xo)),xo}var Oo,_u;function xv(){if(_u)return Oo;_u=1;var t=Io(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(d){if(a>=l)return d;var u=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(u);case"%d":return Number(u);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+l];if(a.names)for(var u=0;u<a.names.length;u+=1){var h=a.names[u];a.name?d.push(c[a.name][h]):d.push(c[a.names[u]])}else d.push(c[a.name]);return n.apply(null,d)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Oo=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(u){u.payloads==null&&(u.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,d=[];return c.forEach(function(u){t[u].forEach(function(h){h.name in o&&o[h.name]!=null?d.push(i(u,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(f){d.push(i(u,h,f))})})}),o.media.forEach(function(u){d.push(i("m",t.m[0],u)),l.forEach(function(h){t[h].forEach(function(f){f.name in u&&u[f.name]!=null?d.push(i(h,f,u)):f.push in u&&u[f.push]!=null&&u[f.push].forEach(function(m){d.push(i(h,f,m))})})})}),d.join(`\r
`)+`\r
`},Oo}var ku;function Rv(){if(ku)return st;ku=1;var t=Pv(),e=xv(),n=Io();return st.grammar=n,st.write=e,st.parse=t.parse,st.parseParams=t.parseParams,st.parseFmtpConfig=t.parseFmtpConfig,st.parsePayloads=t.parsePayloads,st.parseRemoteCandidates=t.parseRemoteCandidates,st.parseImageAttributes=t.parseImageAttributes,st.parseSimulcastStreamList=t.parseSimulcastStreamList,st}var nn=Rv();function Ao(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(c!==void 0){var f=Date.now()-l;if(f+e>=c)return c-f}return e}var h=function(){var f=[].slice.call(arguments),m=this;return new Promise(function(p,g){var v=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var C=t.apply(m,f);a&&a(C),d.forEach(function(y){return(0,y.resolve)(C)}),d=[]}},u()),v){var _=t.apply(m,f);return a&&a(_),p(_)}d.push({resolve:p,reject:g})})};return h.cancel=function(f){s!==void 0&&clearTimeout(s),d.forEach(function(m){return(0,m.reject)(f)}),d=[]},h}const Iv=.7,Ov=20,Gn={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Cu extends mt.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=X,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Ao(r=>b(this,void 0,void 0,function*(){this.emit(Gn.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),Ov),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Lt((i=n.loggerName)!==null&&i!==void 0?i:rt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Ue}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return b(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return b(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=Av(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=nn.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{o.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||o.mid!=a.transceiver.mid)return!1;let c=0;if(o.rtp.some(d=>d.codec.toUpperCase()===a.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let l=!1;for(const d of o.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=nn.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Gn.NegotiationComplete),e.sdp&&nn.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Gn.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return b(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{const r=this.latestOfferId+1;if(this.latestOfferId=r,this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=nn.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{Tu(a),a.type==="audio"?Su(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(u=>u.codec.toUpperCase()===c.codec.toUpperCase()?(l=u.payload,!0):!1),l===0||(gt(c.codec)&&this.ensureVideoDDExtensionForSVC(a,o),c.codec!=="av1"))return!0;const d=Math.round(c.maxbr*Iv);for(const u of a.fmtp)if(u.payload===l){u.config.includes("x-google-start-bitrate")||(u.config+=";x-google-start-bitrate=".concat(d));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,nn.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=nn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Tu(r),r.type==="audio"&&Su(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,nn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Pe("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Pe("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return b(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return b(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new so(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===nu))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:nu})}}}function Su(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function Av(t){var e;const n=[],i=[],r=nn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function Tu(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const Do="vp8",Dv={audioPreset:co.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:uo.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Do,backupCodec:!0,preConnectBuffer:!1},wu={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Eu={deviceId:{ideal:"default"},resolution:Si.h720.resolution},Mv={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Cg,disconnectOnPageLeave:!0,webAudioMix:!1},Mo={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ye;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ye||(ye={}));class Nv{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Mo.peerConnectionTimeout,this.log=X,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=ye.CONNECTED:a.some(c=>c==="failed")?this.state=ye.FAILED:a.some(c=>c==="connecting")?this.state=ye.CONNECTING:a.every(c=>c==="closed")?this.state=ye.CLOSED:a.some(c=>c==="closed")?this.state=ye.CLOSING:a.every(c=>c==="new")&&(this.state=ye.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(ye[o]," to ").concat(ye[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Lt((r=i.loggerName)!==null&&r!==void 0?r:rt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new Cu(e,i),this.subscriber=new Cu(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,it.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,it.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ye.NEW,this.connectionLock=new Ue,this.remoteOfferLock=new Ue}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return b(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return b(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return b(this,void 0,void 0,function*(){n===it.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return b(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return b(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return b(this,void 0,void 0,function*(){return new Promise((n,i)=>b(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Gn.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Gn.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===it.PUBLISHER?this.publisher.getConnectedAddress():e===it.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>b(s,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),De.clearTimeout(u),l(new de("room connection has been cancelled",Z.Cancelled))};r!=null&&r.signal.aborted&&d(),r==null||r.signal.addEventListener("abort",d);const u=De.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",d),l(new de("could not establish pc connection",Z.InternalError))},o);for(;this.state!==ye.CONNECTED;)if(yield Ve(50),r!=null&&r.signal.aborted){l(new de("room connection has been cancelled",Z.Cancelled));return}De.clearTimeout(u),r==null||r.signal.removeEventListener("abort",d),c()}))}()})}}class be extends Error{constructor(e,n,i){super(n),this.code=e,this.message=xu(n,be.MAX_MESSAGE_BYTES),this.data=i?xu(i,be.MAX_DATA_BYTES):void 0}static fromProto(e){return new be(e.code,e.message,e.data)}toProto(){return new jl({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new be(be.ErrorCode[e],be.ErrorMessage[e],n)}}be.MAX_MESSAGE_BYTES=256,be.MAX_DATA_BYTES=15360,be.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},be.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Pu=15360;function No(t){return new TextEncoder().encode(t).length}function xu(t,e){if(No(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Lo=2e3;function Cr(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Uo=typeof MediaRecorder<"u";class Lv{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const Uv=Uo?MediaRecorder:Lv;class Fv extends Uv{constructor(e,n){if(!Uo)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>b(this,void 0,void 0,function*(){const d=yield l.data.arrayBuffer();s()||c.enqueue(new Uint8Array(d))}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function Bv(){return Uo}const jv=1e3,Vv=1e4;class Ru extends x{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Ao(()=>b(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>b(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(M.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ue,this.pauseUpstreamLock=new Ue,this.processorLock=new Ue,this.restartLock=new Ue,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==x.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return b(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{$n(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){const s=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Vn(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{s()}}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Vn(r??e,s)}))})}waitForDimensions(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:jv;return function*(){var i;if(e.kind===x.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=He())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ve(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield Ve(50)}throw new Ft("unable to get track dimensions after timeout")}()})}setDeviceId(e){return b(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===en(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),en(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===x.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===x.Kind.Audio?"audioinput":"videoinput";return n?Ie.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return b(this,void 0,void 0,function*(){if(!this.sender)throw new Ft("unable to replace an unpublished track");let i,r;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return b(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=Sg(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===x.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{$n(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield c.applyConstraints(s),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(M.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),iu()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(M.UpstreamPaused,this);const i=He();if((i==null?void 0:i.name)==="Safari"&&yt(i.version,"12.0")<0)throw new ro("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(M.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.processorLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.stopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Vn(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&($n(i._mediaStreamTrack,l),Vn(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(M.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(M.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!Bv()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(!this.localTrackRecorder)this.localTrackRecorder=new Fv(this,{mimeType:"audio/webm;codecs=opus"});else{this.log.warn("preconnect buffer already started");return}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},Vv)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}}class Sr extends Ru{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,x.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=Cr(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(M.AudioTrackFeatureUpdate,this,Re.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(M.AudioTrackFeatureUpdate,this,Re.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==en(this._constraints.deviceId);return this.source===x.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return b(this,void 0,void 0,function*(){let n;if(e){const i=To({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return b(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){$e()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Lo)))}setProcessor(e){return b(this,void 0,void 0,function*(){var n;const i=yield this.processorLock.lock();try{if(!vt()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(M.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return b(this,void 0,void 0,function*(){const e=yield hu(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(M.AudioSilenceDetected)),e})}}function $v(t,e,n){switch(t.kind){case"audio":return new Sr(t,e,!1,void 0,n);case"video":return new Tr(t,e,!1,n);default:throw new Ft("unsupported track type: ".concat(t.kind))}}const qv=Object.values(Si),Wv=Object.values(lo),Hv=Object.values(uo),zv=[Si.h180,Si.h360],Gv=[lo.h180,lo.h360],Kv=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new se(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),Fo=["q","h","f"];function Bo(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=Yv(t,e,n,l),X.debug("using video encoding",o));const d=o.maxFramerate,u=new se(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&gt(l)){const m=new Au(c),p=[];if(m.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const g=He();if(mo()||vt()||(g==null?void 0:g.name)==="Chrome"&&yt(g==null?void 0:g.version,"113")<0){const v=m.suffix=="h"?2:3,_=ev(g);for(let C=0;C<m.spatial;C+=1)p.push({rid:Fo[2-C],maxBitrate:o.maxBitrate/Math.pow(v,C),maxFramerate:u.encoding.maxFramerate,scaleResolutionDownBy:_?Math.pow(2,C):void 0});p[0].scalabilityMode=c}else p.push({maxBitrate:o.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(p[0].priority=u.encoding.priority,p[0].networkPriority=u.encoding.priority),X.debug("using svc encoding",{encodings:p}),p}if(!a)return[o];let h=[];t?h=(r=Ou(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Iu(t,u):h=(s=Ou(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:Iu(t,u);let f;if(h.length>0){const m=h[0];h.length>1&&([,f]=h);const p=Math.max(e,n);if(p>=960&&f)return jo(e,n,[m,f,u],d);if(p>=480)return jo(e,n,[m,u],d)}return jo(e,n,[u])}function Jv(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&X.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===x.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Bo(t.source===x.Source.ScreenShare,c,l,n)}function Yv(t,e,n,i){const r=Xv(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function Xv(t,e,n){if(t)return Hv;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?qv:Wv}function Iu(t,e){if(t)return Kv(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?zv:Gv}function jo(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=Fo.length)return;const a=Math.min(t,e),l={rid:Fo[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},d=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;d&&(l.maxFramerate=d);const u=qn()||o===0;s.encoding.priority&&u&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),vt()&&su()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,X.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),X.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Ou(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class Au{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function Qv(t){return t.source===x.Source.ScreenShare||t.constraints.height&&en(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const Zv=5e3;class Tr extends Ru{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,x.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(M.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,d)=>{var u;const h=(u=this.prevStats)===null||u===void 0?void 0:u.get(d);c+=Cr(l,h)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Ue}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!$e())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Lo))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return b(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Ut(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return b(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Ut(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const d=s;yield(o=d.sender)===null||o===void 0?void 0:o.replaceTrack(d.mediaStreamTrack)}}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=et.LOW;i<=et.HIGH;i+=1)n.push(new zs({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(gt(this.codec),n)}restartTrack(e){return b(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const u=To({video:e});typeof u.video!="boolean"&&(a=u.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=Ut(this.simulcastCodecs.values()),d;d=yield l.next(),n=d.done,!n;c=!0){s=d.value,c=!1;const u=s;u.sender&&((o=u.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(u.mediaStreamTrack=this.mediaStreamTrack.clone(),yield u.sender.replaceTrack(u.mediaStreamTrack))}}catch(u){i={error:u}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return b(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,d,u;if(yield n.setProcessor.call(r,i,s),!((d=r.processor)===null||d===void 0)&&d.processedTrack)try{for(var h=!0,f=Ut(r.simulcastCodecs.values()),m;m=yield f.next(),o=m.done,!o;h=!0)l=m.value,h=!1,yield(u=l.sender)===null||u===void 0?void 0:u.replaceTrack(r.processor.processedTrack)}catch(p){a={error:p}}finally{try{!h&&!o&&(c=f.return)&&(yield c.call(f))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return b(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},Zv))}setPublishingCodecs(e){return b(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(gt(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=Ut(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const d=c;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(gt(d.codec),d.qualities);else{const u=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:u})),!u||!u.sender){for(const h of d.qualities)if(h.enabled){l.push(d.codec);break}}else u.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield Du(u.sender,u.encodings,d.qualities,this.senderLock,gt(d.codec),this.log,this.logContext))}}}catch(d){o={error:d}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return b(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Du(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return b(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&gt(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),iu()&&this.isInBackground&&this.source===x.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Du(t,e,n,i,r,s,o){return b(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let d=!1;!1&&l[0].scalabilityMode||(r&&n.some(f=>f.enabled)&&n.forEach(f=>f.enabled=!0),l.forEach((h,f)=>{var m;let p=(m=h.rid)!==null&&m!==void 0?m:"";p===""&&(p="q");const g=Mu(p),v=n.find(_=>_.quality===g);v&&h.active!==v.enabled&&(d=!0,h.active=v.enabled,s.debug("setting layer ".concat(v.quality," to ").concat(h.active?"enabled":"disabled"),o),qn()&&(v.enabled?(h.scaleResolutionDownBy=e[f].scaleResolutionDownBy,h.maxBitrate=e[f].maxBitrate,h.maxFrameRate=e[f].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),d&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Mu(t){switch(t){case"f":return et.HIGH;case"h":return et.MEDIUM;case"q":return et.LOW;default:return et.HIGH}}function Nu(t,e,n,i){if(!n)return[new bn({quality:et.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new Au(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new bn({quality:Math.min(et.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Mu((o=r.rid)!==null&&o!==void 0?o:"");return new bn({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const Lu="_lossy",Uu="_reliable",ey=2*1e3,Vo="leave-reconnect",ty=3e4;var ot;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(ot||(ot={}));class ny extends mt.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Mo.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=ot.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=X,this.reliableDataSequence=1,this.reliableMessageBuffer=new vu,this.reliableReceivedState=new Ev(ty),this.handleDataChannel=i=>b(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===Uu)s.reliableDCSub=o;else if(o.label===Lu)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>b(this,void 0,void 0,function*(){var r,s;const o=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=je.fromBinary(new Uint8Array(a));if(c.sequence>0&&c.participantSid!==""){const l=this.reliableReceivedState.get(c.participantSid);if(l&&c.sequence<=l)return;this.reliableReceivedState.set(c.participantSid,c.sequence)}((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(N.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&ry(c,c.value.value),this.emit(N.DataPacketReceived,c))}finally{o()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?G.LOSSY:G.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(N.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===Vo&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=De.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===ot.Connected&&i();const s=()=>{this.off(N.Disconnected,o),i()},o=()=>{this.off(N.Restarted,s),r()};this.once(N.Restarted,s),this.once(N.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(N.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===G.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===he.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Ln.RR_SIGNAL_DISCONNECTED))},this.log=Lt((n=e.loggerName)!==null&&n!==void 0?n:rt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Po(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ue,this.dataProcessLock=new Ue,this.dcBufferStatus=new Map([[G.LOSSY,!0],[G.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(N.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(N.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(N.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(N.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(N.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(N.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(N.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(N.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return b(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,this.emit(N.SignalConnected,s),s}catch(s){if(s instanceof de&&s.reason===Z.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return b(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(N.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return b(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new vu,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return b(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ft("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new de("publication of local track timed out, no response from server",Z.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return b(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return b(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ye.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new Nv(r,e.subscriberPrimary,this.loggerOptions),this.emit(N.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>b(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ye.CONNECTED){const d=this.pcState===ot.New;this.pcState=ot.Connected,d&&this.emit(N.Connected,e)}else s===ye.FAILED&&this.pcState===ot.Connected&&(this.pcState=ot.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?Ln.RR_SUBSCRIBER_FAILED:Ln.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===he.RECONNECTING,l=[ye.FAILED,ye.CLOSING,ye.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(N.Offline)}),this.pcManager.onTrack=s=>{this.emit(N.MediaTrackAdded,s.track,s.streams[0],s.receiver)},iy((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>b(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>b(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(N.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(N.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(N.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(N.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(N.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Ln.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Bn.DISCONNECT:this.emit(N.Disconnected,e==null?void 0:e.reason),this.close();break;case Bn.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Vo);break;case Bn.RESUME:this.handleDisconnect(Vo)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===vi.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Lu,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Uu,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return b(this,void 0,void 0,function*(){if(ho())return yield this.createTransceiverRTCRtpSender(e,n,i);if(fo())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return b(this,void 0,void 0,function*(){if(ho())return this.createSimulcastTransceiverSender(e,n,i,r);if(fo())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Sn(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return b(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){X.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===vi.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ye.NEW)===ye.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Pe?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Kn||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Ln.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(N.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return b(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(N.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Kn;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof de&&o.reason===Z.NotAllowed?new Pe("could not reconnect, token might be expired"):new Kn}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(N.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==he.CONNECTED)throw new Kn("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(N.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return b(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");if(!this.pcManager)throw new Pe("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(N.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof de&&r.reason===Z.NotAllowed?new Pe("could not reconnect, token might be expired"):r instanceof de&&r.reason===Z.LeaveRequest?r:new Kn(s)}if(this.emit(N.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==he.CONNECTED)throw new Kn("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(N.Resumed)})}waitForPCInitialConnection(e,n){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return b(this,void 0,void 0,function*(){this.pcState=ot.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ve(ey),!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=ot.Connected}catch(e){throw this.pcState=ot.Disconnected,new de("could not establish PC connection, ".concat(e.message),Z.InternalError)}})}publishRpcResponse(e,n,i,r){return b(this,void 0,void 0,function*(){const s=new je({destinationIdentities:[e],kind:G.RELIABLE,value:{case:"rpcResponse",value:new Bl({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,G.RELIABLE)})}publishRpcAck(e,n){return b(this,void 0,void 0,function*(){const i=new je({destinationIdentities:[e],kind:G.RELIABLE,value:{case:"rpcAck",value:new Fl({requestId:n})}});yield this.sendDataPacket(i,G.RELIABLE)})}sendDataPacket(e,n){return b(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(n),n===G.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===G.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return b(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(G.RELIABLE);const n=this.dataChannelForKind(G.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(G.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>b(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(N.Closing,r);!this.dcBufferStatus.get(e);)yield Ve(10);this.off(N.Closing,r),n()}}))}ensureDataTransportConnected(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Pe("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new de("".concat(a," connection not set"),Z.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const d=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<d;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield Ve(50)}throw new de("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),Z.InternalError)}()})}ensurePublisherConnected(e){return b(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ye.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return b(this,void 0,void 0,function*(){return new Promise((e,n)=>b(this,void 0,void 0,function*(){if(!this.pcManager){n(new so("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(N.Closing,r),this.pcManager.publisher.once(Gn.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();sv(c)&&o.set(a.payload,c)}),this.emit(N.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof so&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Ln.RR_UNKNOWN),n(s)}finally{this.off(N.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===G.LOSSY)return this.lossyDCSub;if(e===G.RELIABLE)return this.reliableDCSub}else{if(e===G.LOSSY)return this.lossyDC;if(e===G.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(d=>{d.isDesired!==a&&c.push(d.trackSid),d.isEnabled||l.push(d.trackSid)}),this.client.sendSyncState(new rd({answer:s?kr({sdp:s.sdp,type:s.type}):void 0,offer:o?kr({sdp:o.sdp,type:o.type}):void 0,subscription:new ar({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:pv(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((d,u)=>new sd({publisherSid:u,lastSeq:d}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new od({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(G.LOSSY),it.PUBLISHER),n(this.dataChannelForKind(G.RELIABLE),it.PUBLISHER),n(this.dataChannelForKind(G.LOSSY,!0),it.SUBSCRIBER),n(this.dataChannelForKind(G.RELIABLE,!0),it.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&De.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){$e()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){$e()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Kn extends Error{}function iy(t){return t!==void 0&&t>13}function ry(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class $o{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return go(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return b(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),X.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return b(this,void 0,void 0,function*(){const n=yield fetch("".concat(sy(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new de("Could not fetch region settings: ".concat(n.statusText),n.status===401?Z.NotAllowed:Z.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function sy(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Fu{get info(){return this._info}constructor(e,n,i){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0}}class oy extends Fu{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>b(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:i.content})}catch{return{done:!0,value:void 0}}}),return(){return b(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return b(this,void 0,void 0,function*(){var e,n,i,r;let s=new Set;try{for(var o=!0,a=Ut(this),c;c=yield a.next(),e=c.done,!e;o=!0){r=c.value,o=!1;const l=r;s.add(l)}}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return Array.from(s)})}}class ay extends Fu{constructor(e,n,i){super(e,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=br(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength;const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>b(this,void 0,void 0,function*(){try{const{done:i,value:r}=yield e.read();return i?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:n.decode(r.content)})}catch{return{done:!0,value:void 0}}}),return(){return b(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return b(this,void 0,void 0,function*(){var e,n,i,r;let s="";try{for(var o=!0,a=Ut(this),c;c=yield a.next(),e=c.done,!e;o=!0)r=c.value,o=!1,s+=r}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return s})}}class Bu{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return b(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class cy extends Bu{}class ly extends Bu{}class ju extends x{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(M.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Lo)),mv()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(M.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class dy extends ju{constructor(e,n,i,r,s,o){super(e,n,x.Kind.Audio,i,o),this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Cr(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;vt()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(vt())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return b(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(po(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&po(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(M.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(M.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const qo=100;class uy extends ju{constructor(e,n,i,r,s){super(e,n,x.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Cr(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=Ao(()=>{this.updateDimensions()},qo),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?$n(this._mediaStreamTrack,n):Vn(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new hy(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!r||s;if(this.lastVisible!==o){if(!o&&Date.now()-i<qo){De.setTimeout(()=>{this.updateVisibility()},qo);return}this.lastVisible=o,this.emit(M.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(M.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?ou():n||(ou()>2?2:1)}}class hy{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=Ei(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Ei(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Ei(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Wo(e),this.isPiP=$e()&&Ei(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Wo(this.element),this.isPiP=Ei(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,cu().observe(this.element),au().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=cu())===null||e===void 0||e.unobserve(this.element),(n=au())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Ei(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Wo(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Wo(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class jt extends mt.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=We.NONE,this.log=X,this.handleMuted=()=>{this.emit(M.Muted)},this.handleUnmuted=()=>{this.emit(M.Unmuted)},this.log=Lt((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:rt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=x.Source.Unknown}setTrack(e){this.track&&(this.track.off(M.Muted,this.handleMuted),this.track.off(M.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(M.Muted,this.handleMuted),e.on(M.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),J(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==We.NONE}get audioTrack(){if(bt(this.track))return this.track}get videoTrack(){if(Sn(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=x.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===x.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(jt||(jt={}));class Ho extends jt{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(M.Ended)},this.handleCpuConstrained=()=>{this.track&&Sn(this.track)&&this.emit(M.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(M.Ended,this.handleTrackEnded),this.track.off(M.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(M.Ended,this.handleTrackEnded),e.on(M.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(bt(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Re.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Re.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Re.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Re.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Re.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Re.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function wr(t,e){return b(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=pu(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const u=s.audio.deviceId;s.audio.deviceId={exact:u},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:u}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const u=s.video.deviceId;s.video.deviceId={exact:u},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:u}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=uu(s,wu,Eu),l=To(c),d=navigator.mediaDevices.getUserMedia(l);s.audio&&(Ie.userMediaPromiseMap.set("audioinput",d),d.catch(()=>Ie.userMediaPromiseMap.delete("audioinput"))),s.video&&(Ie.userMediaPromiseMap.set("videoinput",d),d.catch(()=>Ie.userMediaPromiseMap.delete("videoinput")));try{const u=yield d;return yield Promise.all(u.getTracks().map(h=>b(this,void 0,void 0,function*(){const f=h.kind==="audio";let m=f?c.audio:c.video;(typeof m=="boolean"||!m)&&(m={});let p;const g=f?l.audio:l.video;typeof g!="boolean"&&(p=g);const v=h.getSettings().deviceId;p!=null&&p.deviceId&&en(p.deviceId)!==v?p.deviceId=v:p||(p={deviceId:v});const _=$v(h,p,e);return _.kind===x.Kind.Video?_.source=x.Source.Camera:_.kind===x.Kind.Audio&&(_.source=x.Source.Microphone),_.mediaStream=u,bt(_)&&i?yield _.setProcessor(i):Sn(_)&&r&&(yield _.setProcessor(r)),_})))}catch(u){if(!n)throw u;return wr(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function fy(t){return b(this,void 0,void 0,function*(){return(yield wr({audio:!1,video:!0}))[0]})}function py(t){return b(this,void 0,void 0,function*(){return(yield wr({audio:!0,video:!1}))[0]})}var rn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(rn||(rn={}));function my(t){switch(t){case gi.EXCELLENT:return rn.Excellent;case gi.GOOD:return rn.Good;case gi.POOR:return rn.Poor;case gi.LOST:return rn.Lost;default:return rn.Unknown}}class Vu extends mt.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===yi.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Un.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:yi.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=rn.Unknown,this.log=X,this.log=Lt((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:rt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Hn,this.once(L.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(x.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(x.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(x.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Un.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Un.ACTIVE&&this.emit(L.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(L.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(L.ParticipantNameChanged,e)}_setAttributes(e){const n=gv(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(L.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((d,u)=>{var h;return d!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[u])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(L.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(L.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=my(e),n!==this._connectionQuality&&this.emit(L.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>bt(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(M.Muted,()=>{this.emit(L.TrackMuted,e)}),e.on(M.Unmuted,()=>{this.emit(L.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case x.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case x.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function gy(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new nd({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}const $u=15e3;class vy extends Vu{constructor(e,n,i,r,s){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=We.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Hn)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,a,c,l,d,u;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((l=(c=this.signalConnectedFuture).reject)===null||l===void 0||l.call(c,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(u=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||u===void 0||u.call(d,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=o=>{var a,c;o.participant&&this.updateInfo(o.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Hn),(c=(a=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(a)},this.handleSignalRequestResponse=o=>{const{requestId:a,reason:c,message:l}=o,d=this.pendingSignalRequests.get(a);d&&(c!==Gs.OK&&d.reject(new Zd(l,c)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let a=o.value.value,c=null,l=null;a.value.case==="payload"?c=a.value.value:a.value.case==="error"&&(l=be.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,c,l);break;case"rpcAck":let d=o.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>gy(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),J(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),J(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),J(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const a=this.audioTrackPublications.get(o.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.onTrackCpuConstrained=(o,a)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),J(a))),this.emit(L.LocalTrackCpuConstrained,o,a)},this.handleSubscribedQualityUpdate=o=>b(this,void 0,void 0,function*(){var a,c,l,d,u;if(!(!((u=this.roomOptions)===null||u===void 0)&&u.dynacast))return;const h=this.videoTrackPublications.get(o.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(!h.videoTrack)return;const f=yield h.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var m=!0,p=Ut(f),g;g=yield p.next(),a=g.done,!a;m=!0){d=g.value,m=!1;const v=d;Gg(v)&&(this.log.debug("publish ".concat(v," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),J(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,v,h.options))}}catch(v){c={error:v}}finally{try{!m&&!a&&(l=p.return)&&(yield l.call(p))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=o=>{const a=this.trackPublications.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>b(this,void 0,void 0,function*(){if(o.source===x.Source.ScreenShare||o.source===x.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),J(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(Bt(o)||tn(o))try{if($e())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===x.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),J(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),J(o))),Bt(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),J(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==We.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.on(N.RemoteMute,(n,i)=>{const r=this.trackPublications.get(n);!r||!r.track||(i?r.mute():r.unmute())}),this.engine.on(N.Connected,this.handleReconnected).on(N.SignalConnected,this.handleSignalConnected).on(N.SignalRestarted,this.handleReconnected).on(N.SignalResumed,this.handleReconnected).on(N.Restarting,this.handleReconnecting).on(N.Resuming,this.handleReconnecting).on(N.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(N.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(N.Disconnected,this.handleDisconnected).on(N.SignalRequestResponse,this.handleSignalRequestResponse).on(N.DataPacketReceived,this.handleDataPacket),this.signalConnectedFuture=void 0}setMetadata(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return b(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>b(i,void 0,void 0,function*(){var l,d;try{let u=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(d=s??this.name)!==null&&d!==void 0?d:"",o),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:m=>{c(m),u=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-f<5e3&&!u;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(m=>{let[p,g]=m;return this.attributes[p]===g||g===""&&!this.attributes[p]}))){this.pendingSignalRequests.delete(h),a();return}yield Ve(50)}c(new Zd("Request to update local metadata timed out","TimeoutError"))}catch(u){u instanceof Error&&c(u)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(x.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(x.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(x.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(L.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){this.encryptionType=e?We.GCM:We.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return b(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case x.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case x.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case x.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Ft(e)}}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l instanceof Error&&this.emit(L.MediaDevicesError,l,wo(e)),this.pendingPublishing.delete(e),l}for(const l of c)e===x.Source.Microphone&&bt(l)&&(r!=null&&r.preConnectBuffer)&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer());try{const l=[];for(const u of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),J(u))),l.push(this.publishTrack(u,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===x.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(x.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return b(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(x.Source.Camera)||this.pendingPublishing.has(x.Source.Microphone))){this.pendingPublishing.add(x.Source.Camera),this.pendingPublishing.add(x.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(x.Source.Camera),this.pendingPublishing.delete(x.Source.Microphone)}}})}createTracks(e){return b(this,void 0,void 0,function*(){var n,i;e??(e={});const r=uu(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield wr(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(bt(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=x.Source.Microphone,this.emit(L.AudioStreamAcquired)),Sn(a)&&(this.cameraError=void 0,a.source=x.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return b(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new ro("getDisplayMedia not supported");e.resolution===void 0&&!Zg()&&(e.resolution=uo.h1080fps30.resolution);const n=fv(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Ft("no video track found");const s=new Tr(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=x.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(L.AudioStreamAcquired);const a=new Sr(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=x.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return b(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,d;Bt(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),zn(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let u;if(i instanceof MediaStreamTrack)u=i.getConstraints();else{u=i.constraints;let v;switch(i.source){case x.Source.Microphone:v="audioinput";break;case x.Source.Camera:v="videoinput"}v&&s.activeDeviceMap.has(v)&&(u=Object.assign(Object.assign({},u),{deviceId:s.activeDeviceMap.get(v)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Sr(i,u,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Tr(i,u,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new Ft("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(v=>{v.track&&v.track===i&&(h=v)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),J(h))),h;const f="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,m=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:f;m&&(r||(r={}),r.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),J(i))),r.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(d=r.red)!==null&&d!==void 0||(r.red=!1));const p=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r);!tv()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),p.simulcast=!1),p.source&&(i.source=p.source);const g=new Promise((v,_)=>b(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==he.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:J(i)}));const C=setTimeout(()=>{_(new Qd("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(C);const y=yield this.publish(i,p,m);v(y)}else try{const C=yield this.publish(i,p,m);v(C)}catch(C){_(C)}}catch(C){_(C)}}));s.pendingPublishPromises.set(i,g);try{return yield g}catch(v){throw v}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Hn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),J(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>vv(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),J(e))),!1)}publish(e,n,i){return b(this,void 0,void 0,function*(){var r,s,o,a,c,l,d,u,h,f;if(!this.hasPermissionsToPublish(e))throw new Qd("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(R=>zn(e)&&R.source===e.source)&&e.source!==x.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),J(e))),n.stopMicTrackOnMute&&bt(e)&&(e.stopOnMute=!0),e.source===x.Source.ScreenShare&&qn()&&(n.simulcast=!1),n.videoCodec==="av1"&&!Yg()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!Xg()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Do),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(R=>n.videoCodec===_r(R.mime))||(n.videoCodec=_r(this.enabledPublishVideoCodecs[0].mime)));const p=n.videoCodec;e.on(M.Muted,this.onTrackMuted),e.on(M.Unmuted,this.onTrackUnmuted),e.on(M.Ended,this.handleTrackEnded),e.on(M.UpstreamPaused,this.onTrackUpstreamPaused),e.on(M.UpstreamResumed,this.onTrackUpstreamResumed),e.on(M.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const g=[],v=!(!((r=n.dtx)!==null&&r!==void 0)||r),_=e.getSourceTrackSettings();_.autoGainControl&&g.push(Re.TF_AUTO_GAIN_CONTROL),_.echoCancellation&&g.push(Re.TF_ECHO_CANCELLATION),_.noiseSuppression&&g.push(Re.TF_NOISE_SUPPRESSION),_.channelCount&&_.channelCount>1&&g.push(Re.TF_STEREO),v&&g.push(Re.TF_NO_DTX),Bt(e)&&e.hasPreConnectBuffer&&g.push(Re.TF_PRECONNECT_BUFFER);const C=new $s({cid:e.mediaStreamTrack.id,name:n.name,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),disableDtx:v,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:g});let y;if(e.kind===x.Kind.Video){let R={width:0,height:0};try{R=yield e.waitForDimensions()}catch{const A=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Si.h720.resolution;R={width:A.width,height:A.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{dims:R}))}C.width=R.width,C.height=R.height,tn(e)&&(gt(p)&&(e.source===x.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),J(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),C.simulcastCodecs=[new Vs({codec:p,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Do}),n.backupCodec&&p!==n.backupCodec.codec&&C.encryption===We.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),C.simulcastCodecs.push(new Vs({codec:n.backupCodec.codec,cid:""})))),y=Bo(e.source===x.Source.ScreenShare,C.width,C.height,n),C.layers=Nu(C.width,C.height,y,gt(n.videoCodec))}else e.kind===x.Kind.Audio&&(y=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(u=(d=n.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&u!==void 0?u:"high",networkPriority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const k=()=>b(this,void 0,void 0,function*(){var R,D,A;if(!this.engine.pcManager)throw new Pe("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,y),this.emit(L.LocalSenderCreated,e.sender,e),tn(e)&&((R=n.degradationPreference)!==null&&R!==void 0||(n.degradationPreference=Qv(e)),e.setDegradationPreference(n.degradationPreference)),y)if(qn()&&e.kind===x.Kind.Audio){let U;for(const $ of this.engine.pcManager.publisher.getTransceivers())if($.sender===e.sender){U=$;break}U&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:U,codec:"opus",maxbr:!((D=y[0])===null||D===void 0)&&D.maxBitrate?y[0].maxBitrate/1e3:0})}else e.codec&&gt(e.codec)&&(!((A=y[0])===null||A===void 0)&&A.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:C.cid,codec:e.codec,maxbr:y[0].maxBitrate/1e3});yield this.engine.negotiate()});let w;const E=new Promise((R,D)=>b(this,void 0,void 0,function*(){var A;try{w=yield this.engine.addTrack(C),R(w)}catch(U){e.sender&&(!((A=this.engine.pcManager)===null||A===void 0)&&A.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch($=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{error:$}))})),D(U)}}));if(this.enabledPublishVideoCodecs.length>0)w=(yield Promise.all([E,k()]))[0];else{w=yield E;let R;if(w.codecs.forEach(D=>{R===void 0&&(R=D.mimeType)}),R&&e.kind===x.Kind.Video){const D=_r(R);D!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{codec:D})),n.videoCodec=D,y=Bo(e.source===x.Source.ScreenShare,C.width,C.height,n))}yield k()}const I=new Ho(e.kind,w,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(I.on(M.CpuConstrained,R=>this.onTrackCpuConstrained(R,I)),I.options=n,e.sid=w.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:w})),tn(e)?e.startMonitor(this.engine.client):Bt(e)&&e.startMonitor(),this.addTrackPublication(I),this.emit(L.LocalTrackPublished,I),Bt(e)&&w.audioFeatures.includes(Re.TF_PRECONNECT_BUFFER)){const R=e.getPreConnectBuffer();this.on(L.LocalTrackSubscribed,D=>{if(D.trackSid===w.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),J(e))),e.stopPreConnectBuffer()}}),R&&new Promise((A,U)=>b(this,void 0,void 0,function*(){var $,H,te,q,Q,j;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),J(e)));const Je=setTimeout(()=>{U(new Error("agent not active within 10 seconds"))},1e4),wt=yield this.waitUntilActiveAgentPresent();clearTimeout(Je),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),J(e)));const Ne=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[wt.identity],attributes:{trackId:I.trackSid,sampleRate:String((Q=_.sampleRate)!==null&&Q!==void 0?Q:"48000"),channels:String((j=_.channelCount)!==null&&j!==void 0?j:"1")}});try{for(var ne=!0,Te=Ut(R),we;we=yield Te.next(),$=we.done,!$;ne=!0){q=we.value,ne=!1;const Ye=q;yield Ne.write(Ye)}}catch(Ye){H={error:Ye}}finally{try{!ne&&!$&&(te=Te.return)&&(yield te.call(Te))}finally{if(H)throw H.error}}yield Ne.close(),A()}catch(Je){U(Je)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),J(e)))}).catch(A=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{error:A}))})}return I})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return b(this,void 0,void 0,function*(){var r;if(this.encryptionType!==We.NONE)return;let s;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(s=f)}),!s)throw new Ft("track is not published");if(!tn(e))throw new Ft("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=Jv(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),J(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new $s({cid:c.mediaStreamTrack.id,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Nu(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const d=()=>b(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),d()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return b(this,void 0,void 0,function*(){var i,r;if(zn(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),J(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?J(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(M.Muted,this.onTrackMuted),e.off(M.Unmuted,this.onTrackUnmuted),e.off(M.Ended,this.handleTrackEnded),e.off(M.UpstreamPaused,this.onTrackUpstreamPaused),e.off(M.UpstreamResumed,this.onTrackUpstreamResumed),e.off(M.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ye.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),tn(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case x.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case x.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(L.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return b(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>b(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>b(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==x.Source.ScreenShare&&l.source!==x.Source.ScreenShareAudio&&(Bt(l)||tn(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?G.RELIABLE:G.LOSSY,o=r.destinationIdentities,a=r.topic,c=new je({kind:s,value:{case:"user",value:new Nl({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a})}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return b(this,void 0,void 0,function*(){const i=new je({kind:G.RELIABLE,value:{case:"sipDtmf",value:new Ll({code:e,digit:n})}});yield this.engine.sendDataPacket(i,G.RELIABLE)})}sendChatMessage(e,n){return b(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new je({value:{case:"chatMessage",value:new Ns(Object.assign(Object.assign({},i),{timestamp:me.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,G.RELIABLE),this.emit(L.ChatMessage,i),i})}editChatMessage(e,n){return b(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new je({value:{case:"chatMessage",value:new Ns(Object.assign(Object.assign({},i),{timestamp:me.parse(i.timestamp),editTimestamp:me.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,G.RELIABLE),this.emit(L.ChatMessage,i),i})}sendText(e,n){return b(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(u,h)=>{var f;c[h]=u;const m=c.reduce((p,g)=>p+g,0);(f=n==null?void 0:n.onProgress)===null||f===void 0||f.call(n,m)},d=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield d.write(e),l(1,0),yield d.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((u,h)=>b(this,void 0,void 0,function*(){return this._sendFile(a[h],u,{topic:n.topic,mimeType:u.type,onProgress:f=>{l(f,h+1)}})})))),d.info})}streamText(e){return b(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new Us({streamId:r,mimeType:s.mimeType,topic:s.topic,timestamp:Cn(s.timestamp),totalLength:Cn(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new Kl({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Ls.UPDATE:Ls.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new je({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,G.RELIABLE);let l=0;const d=this,u=new WritableStream({write(m){return b(this,void 0,void 0,function*(){for(const p of uv(m,$u)){yield d.engine.waitForBufferStatusLow(G.RELIABLE);const g=new Fs({content:p,streamId:r,chunkIndex:Cn(l)}),v=new je({destinationIdentities:a,value:{case:"streamChunk",value:g}});yield d.engine.sendDataPacket(v,G.RELIABLE),l+=1}})},close(){return b(this,void 0,void 0,function*(){const m=new Bs({streamId:r}),p=new je({destinationIdentities:a,value:{case:"streamTrailer",value:m}});yield d.engine.sendDataPacket(p,G.RELIABLE)})},abort(m){console.log("Sink error:",m)}});let h=()=>b(this,void 0,void 0,function*(){yield f.close()});d.engine.once(N.Closing,h);const f=new cy(u,s,()=>this.engine.off(N.Closing,h));return f})}sendFile(e,n){return b(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return b(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return b(this,void 0,void 0,function*(){var n,i,r,s,o;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown"},d=new Us({totalLength:Cn((o=l.size)!==null&&o!==void 0?o:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:Cn(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new Jl({name:l.name})}}),u=new je({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(u,G.RELIABLE);let h=0;const f=new Ue,m=this.engine,p=this.log,g=new WritableStream({write(_){return b(this,void 0,void 0,function*(){const C=yield f.lock();let y=0;try{for(;y<_.byteLength;){const k=_.slice(y,y+$u);yield m.waitForBufferStatusLow(G.RELIABLE);const w=new je({destinationIdentities:c,value:{case:"streamChunk",value:new Fs({content:k,streamId:a,chunkIndex:Cn(h)})}});yield m.sendDataPacket(w,G.RELIABLE),h+=1,y+=k.byteLength}}finally{C()}})},close(){return b(this,void 0,void 0,function*(){const _=new Bs({streamId:a}),C=new je({destinationIdentities:c,value:{case:"streamTrailer",value:_}});yield m.sendDataPacket(C,G.RELIABLE)})},abort(_){p.error("Sink error:",_)}});return new ly(g,l)})}performRpc(e){return b(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((l,d)=>b(i,void 0,void 0,function*(){var u,h,f,m;if(No(o)>Pu){d(be.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||h===void 0)&&h.version&&yt((m=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||m===void 0?void 0:m.version,"1.8.0")<0){d(be.builtIn("UNSUPPORTED_SERVER"));return}const p=crypto.randomUUID();yield this.publishRpcRequest(r,p,s,o,a-2e3);const g=setTimeout(()=>{this.pendingAcks.delete(p),d(be.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(p),clearTimeout(v)},2e3);this.pendingAcks.set(p,{resolve:()=>{clearTimeout(g)},participantIdentity:r});const v=setTimeout(()=>{this.pendingResponses.delete(p),d(be.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(p,{resolve:(_,C)=>{clearTimeout(v),this.pendingAcks.has(p)&&(console.warn("RPC response received before ack",p),this.pendingAcks.delete(p),clearTimeout(g)),C?d(C):l(_??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return b(this,void 0,void 0,function*(){const o=new je({destinationIdentities:[e],kind:G.RELIABLE,value:{case:"rpcRequest",value:new Ul({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,G.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,be.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),J(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Hn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Bt(r)||tn(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return b(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield Ve(20)}})}}class yy extends jt{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=et.HIGH,this.handleEnded=s=>{this.setTrack(void 0),this.emit(M.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.disabled=!s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensions=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new ar({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Vl({participantSid:"",trackSids:[this.trackSid]})]});this.emit(M.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?jt.SubscriptionStatus.Unsubscribed:super.isSubscribed?jt.SubscriptionStatus.Subscribed:jt.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?jt.PermissionStatus.Allowed:jt.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.videoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Co(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Co(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(M.VisibilityChanged,this.handleVisibilityChange),r.off(M.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(M.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(M.VisibilityChanged,this.handleVisibilityChange),e.on(M.Ended,this.handleEnded),this.emit(M.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(M.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?M.Muted:M.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(M.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(M.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===x.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Co(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Xl({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=et.HIGH,this.emit(M.UpdateSettings,e)}}class Er extends Vu{static fromParticipantInfo(e,n,i){return new Er(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:yi.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(M.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),J(e))),this.signalClient.sendUpdateTrackSettings(n)}),e.on(M.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(M.SubscriptionPermissionChanged,n=>{this.emit(L.TrackSubscriptionPermissionChanged,e,n)}),e.on(M.SubscriptionStatusChanged,n=>{this.emit(L.TrackSubscriptionStatusChanged,e,n)}),e.on(M.Subscribed,n=>{this.emit(L.TrackSubscribed,n,e)}),e.on(M.Unsubscribed,n=>{this.emit(L.TrackUnsubscribed,n,e)}),e.on(M.SubscriptionFailed,n=>{this.emit(L.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(d=>{!a&&e.kind===d.kind.toString()&&(a=d)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(L.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),J(a))),this.emit(L.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new uy(e,n,r,s):l=new dy(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&ko(l)&&bt(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=x.kindFromProto(r.type);if(!c)return;a=new yy(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(d=>d.source===(a==null?void 0:a.source));l&&a.source!==x.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:J(l),newTrack:J(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),J(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(L.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case x.Kind.Audio:this.audioTrackPublications.delete(e);break;case x.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(L.TrackUnpublished,i)}setAudioOutput(e){return b(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;bt(i.track)&&ko(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ee;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ee||(ee={}));const by=4*1e3;class Jn extends mt.EventEmitter{constructor(e){var n,i,r,s;if(super(),n=this,this.state=ee.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=X,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,a,c)=>b(this,void 0,void 0,function*(){var l;if(!Qg())throw vt()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===ee.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(ee.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),go(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new $o(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(f=>{var m;(m=this.regionUrlProvider)===null||m===void 0||m.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const u=(f,m,p)=>b(this,void 0,void 0,function*(){var g,v;this.abortController&&this.abortController.abort();const _=new AbortController;this.abortController=_,d==null||d();try{yield this.attemptConnection(p??o,a,c,_),this.abortController=void 0,f()}catch(C){if(this.regionUrlProvider&&C instanceof de&&C.reason!==Z.Cancelled&&C.reason!==Z.NotAllowed){let y=null;try{y=yield this.regionUrlProvider.getNextBestRegionUrl((g=this.abortController)===null||g===void 0?void 0:g.signal)}catch(k){if(k instanceof de&&(k.status===401||k.reason===Z.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),m(k);return}}y&&!(!((v=this.abortController)===null||v===void 0)&&v.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(C.message,". Retrying with another region: ").concat(y),this.logContext),this.recreateEngine(),yield u(f,m,y)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,du(C)),m(C))}else{let y=nt.UNKNOWN_REASON;C instanceof de&&(y=du(C)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,y),m(C)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Hn((f,m)=>{u(f,m,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,d,u)=>b(this,void 0,void 0,function*(){var h,f,m;const p=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},u.signal);let g=p.serverInfo;if(g||(g={version:p.serverVersion,region:p.serverRegion}),this.serverInfo=g,this.log.debug("connected to Livekit Server ".concat(Object.entries(g).map(v=>{let[_,C]=v;return"".concat(_,": ").concat(C)}).join(", ")),{room:(h=p.room)===null||h===void 0?void 0:h.name,roomSid:(f=p.room)===null||f===void 0?void 0:f.sid,identity:(m=p.participant)===null||m===void 0?void 0:m.identity}),!g.version)throw new Ug("unknown server version");return g.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),p}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>b(this,void 0,void 0,function*(){var d,u;this.state===ee.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((u=this.regionUrlProvider)===null||u===void 0)&&u.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Mo),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(O.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const f=new de("could not establish signal connection",Z.ServerUnreachable);throw h instanceof Error&&(f.message="".concat(f.message,": ").concat(h.message)),h instanceof de&&(f.reason=h.reason,f.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),f}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new de("Connection attempt aborted",Z.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}$e()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),$e()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ee.Connected),this.emit(O.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return b(n,[...a],void 0,function(){var l=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var u,h,f,m;const p=yield l.disconnectLock.lock();try{if(l.state===ee.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===ee.Connecting||l.state===ee.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(u=l.abortController)===null||u===void 0||u.abort(),(f=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new de("Client initiated disconnect",Z.Cancelled)),l.connectFuture=void 0),!((m=l.engine)===null||m===void 0)&&m.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(d,nt.CLIENT_INITIATED),l.engine=void 0}finally{p()}}()})},this.onPageLeave=()=>b(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>b(this,void 0,void 0,function*(){const o=[],a=He();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const d=bo();d.enabled=!0;const u=new MediaStream([d]);l.srcObject=u,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:u,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(O.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(d=>{o.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>b(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(d=>{o.includes(d)||o.push(d)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(ee.Reconnecting)&&this.emit(O.Reconnecting)},this.handleSignalRestarted=o=>b(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(ee.Connected),this.emit(O.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===Un.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(l.sid);d&&(d.audioLevel=l.level,d.setIsSpeaking(!0),a.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(O.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const d=this.remoteParticipants.get(l.identity);d&&d.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let d=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=l.level,d.setIsSpeaking(l.active),l.active?a.set(l.sid,d):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,d)=>d.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(O.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const d=x.streamStateFromProto(a.state);d!==l.track.streamState&&(l.track.streamState=d,c.emit(L.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(O.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,c)=>{this.emit(O.DataReceived,a.payload,o,c,a.topic),o==null||o.emit(L.DataReceived,a.payload,c)},this.handleSipDtmf=(o,a)=>{this.emit(O.SipDTMFReceived,a,o),o==null||o.emit(L.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),d=av(a,this.transcriptionReceivedTimes);l==null||l.emit(M.TranscriptionReceived,d),c==null||c.emit(L.TranscriptionReceived,d,l),this.emit(O.TranscriptionReceived,d,c,l)},this.handleChatMessage=(o,a)=>{const c=cv(a);this.emit(O.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(O.MetricsReceived,o,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(O.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(O.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(O.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(O.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>b(this,void 0,void 0,function*(){var o;((o=He())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(O.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(O.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(O.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(O.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(O.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(O.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(O.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(O.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>b(this,void 0,void 0,function*(){var a,c,l,d,u,h;(a=o.track)===null||a===void 0||a.on(M.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(M.Restarted,this.onLocalTrackRestarted),(u=(d=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||u===void 0||u.call(d,this),this.emit(O.LocalTrackPublished,o,this.localParticipant),Bt(o.track)&&(yield o.track.checkForSilence())&&this.emit(O.LocalAudioSilenceDetected,o);const f=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),m=wo(o.source);m&&f&&f!==this.localParticipant.activeDeviceMap.get(m)&&(this.localParticipant.activeDeviceMap.set(m,f),this.emit(O.ActiveDeviceChanged,m,f))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(M.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(M.Restarted,this.onLocalTrackRestarted),this.emit(O.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>b(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=wo(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(O.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(O.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(O.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(O.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(O.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},Mv),e),this.log=Lt((i=this.options.loggerName)!==null&&i!==void 0?i:rt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},wu),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Eu),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Dv),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Ue,this.localParticipant=new vy("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",en(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",en(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",en(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),$e()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Jn.cleanupRegistry&&Jn.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,i,r,s,o){return b(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const d=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});No(d)>Pu?(c=be.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=d}catch(d){d instanceof be?c=d:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),d),c=be.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new yv(this.options.e2ee),this.e2eeManager.on(Qt.ParticipantEncryptionStatusChanged,(n,i)=>{dv(i)&&(this.isE2EEEnabled=n),this.emit(O.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(Qt.EncryptionError,n=>this.emit(O.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return b(this,void 0,void 0,function*(){return this.state===ee.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(N.RoomUpdate,i),e(r.sid))};this.engine.on(N.RoomUpdate,i),this.once(O.Disconnected,()=>{this.engine.off(N.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new ny(this.options),this.engine.on(N.ParticipantUpdate,this.handleParticipantUpdates).on(N.RoomUpdate,this.handleRoomUpdate).on(N.SpeakersChanged,this.handleSpeakersChanged).on(N.StreamStateChanged,this.handleStreamStateUpdate).on(N.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(N.SubscriptionError,this.handleSubscriptionError).on(N.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(N.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(N.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(N.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(N.DataPacketReceived,this.handleDataPacket).on(N.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ee.SignalReconnecting)&&this.emit(O.SignalReconnecting)}).on(N.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ee.Connected)&&this.emit(O.Reconnected)}).on(N.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ee.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(N.Restarting,this.handleRestarting).on(N.SignalRestarted,this.handleSignalRestarted).on(N.Offline,()=>{this.setAndEmitConnectionState(ee.Reconnecting)&&this.emit(O.Reconnecting)}).on(N.DCBufferStatusChanged,(e,n)=>{this.emit(O.DCBufferStatusChanged,e,n)}).on(N.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(L.LocalTrackSubscribed,n),this.emitWhenConnected(O.LocalTrackSubscribed,n,this.localParticipant)}).on(N.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(O.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ie.getInstance().getDevices(e,n)}prepareConnection(e,n){return b(this,void 0,void 0,function*(){if(this.state===ee.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(go(new URL(e))&&n){this.regionUrlProvider=new $o(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ee.Disconnected&&(this.regionUrl=i,yield fetch(_o(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(_o(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return b(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new pt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new pt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new pt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new pt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new pt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new pt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new pt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>b(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new cr({reason:nt.CLIENT_INITIATED,action:Bn.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new pt({scenario:{case:"subscriberBandwidth",value:Cn(n)}});break;case"leave-full-reconnect":r=new pt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,d,u,h,f;let m=!0,p=!1;const g=o?{exact:r}:r;if(i==="audioinput"){p=s.localParticipant.audioTrackPublications.size===0;const v=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=g;const _=Array.from(s.localParticipant.audioTrackPublications.values()).filter(y=>y.source===x.Source.Microphone);try{m=(yield Promise.all(_.map(y=>{var k;return(k=y.audioTrack)===null||k===void 0?void 0:k.setDeviceId(g)}))).every(y=>y===!0)}catch(y){throw s.options.audioCaptureDefaults.deviceId=v,y}const C=_.some(y=>{var k,w;return(w=(k=y.track)===null||k===void 0?void 0:k.isMuted)!==null&&w!==void 0?w:!1});m&&C&&(p=!0)}else if(i==="videoinput"){p=s.localParticipant.videoTrackPublications.size===0;const v=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=g;const _=Array.from(s.localParticipant.videoTrackPublications.values()).filter(C=>C.source===x.Source.Camera);try{m=(yield Promise.all(_.map(C=>{var y;return(y=C.videoTrack)===null||y===void 0?void 0:y.setDeviceId(g)}))).every(C=>C===!0)}catch(C){throw s.options.videoCaptureDefaults.deviceId=v,C}}else if(i==="audiooutput"){if(p=!0,!po()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(r=(l=yield Ie.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(d=(f=s.options).audioOutput)!==null&&d!==void 0||(f.audioOutput={});const v=(u=s.getActiveDevice(i))!==null&&u!==void 0?u:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(_=>_.setAudioOutput({deviceId:r})))}catch(_){throw s.options.audioOutput.deviceId=v,_}}return p&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(O.ActiveDeviceChanged,i,r)),m}()})}setupLocalParticipantEvents(){this.localParticipant.on(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(L.AttributesChanged,this.onLocalAttributesChanged).on(L.TrackMuted,this.onLocalTrackMuted).on(L.TrackUnmuted,this.onLocalTrackUnmuted).on(L.LocalTrackPublished,this.onLocalTrackPublished).on(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(L.MediaDevicesError,this.onMediaDevicesError).on(L.AudioStreamAcquired,this.startAudio).on(L.ChatMessage,this.onLocalChatMessageSent).on(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ee.Connecting||this.state===ee.Reconnecting){const d=()=>{this.onTrackAdded(e,n,i),u()},u=()=>{this.off(O.Reconnected,d),this.off(O.Connected,d),this.off(O.Disconnected,u)};this.once(O.Reconnected,d),this.once(O.Connected,d),this.once(O.Disconnected,u);return}if(this.state===ee.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=Jg(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ee.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(L.AttributesChanged,this.onLocalAttributesChanged).off(L.TrackMuted,this.onLocalTrackMuted).off(L.TrackUnmuted,this.onLocalTrackUnmuted).off(L.LocalTrackPublished,this.onLocalTrackPublished).off(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(L.MediaDevicesError,this.onMediaDevicesError).off(L.AudioStreamAcquired,this.startAudio).off(L.ChatMessage,this.onLocalChatMessageSent).off(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),$e()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ee.Disconnected),this.emit(O.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(O.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return b(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:br(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.byteStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new oy(o,a,br(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.textStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new ay(o,a,br(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return b(this,void 0,void 0,function*(){var e,n,i;const r=Ie.getInstance().previousDevices,s=yield Ie.getInstance().getDevices(void 0,!1),o=He();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(d=>d.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(O.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=hv(c),d=this.localParticipant.getTrackPublication(l);if(d&&(!((e=d.track)===null||e===void 0)&&e.isUserProvided))continue;const u=s.filter(f=>f.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(f=>f.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&u.length>0&&((i=u[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,u[0].deviceId);continue}c==="audioinput"&&!mo()||c==="videoinput"||u.length>0&&!u.find(f=>f.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!mo())&&(yield this.switchActiveDevice(c,u[0].deviceId))}})}acquireAudioContext(){return b(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=fu())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ve(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(O.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Er.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Er(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(O.ParticipantConnected,i),i.on(L.TrackPublished,r=>{this.emitWhenConnected(O.TrackPublished,r,i)}).on(L.TrackSubscribed,(r,s)=>{r.kind===x.Kind.Audio?(r.on(M.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(M.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===x.Kind.Video&&(r.on(M.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(M.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(O.TrackSubscribed,r,s,i)}).on(L.TrackUnpublished,r=>{this.emit(O.TrackUnpublished,r,i)}).on(L.TrackUnsubscribed,(r,s)=>{this.emit(O.TrackUnsubscribed,r,s,i)}).on(L.TrackMuted,r=>{this.emitWhenConnected(O.TrackMuted,r,i)}).on(L.TrackUnmuted,r=>{this.emitWhenConnected(O.TrackUnmuted,r,i)}).on(L.ParticipantMetadataChanged,r=>{this.emitWhenConnected(O.ParticipantMetadataChanged,r,i)}).on(L.ParticipantNameChanged,r=>{this.emitWhenConnected(O.ParticipantNameChanged,r,i)}).on(L.AttributesChanged,r=>{this.emitWhenConnected(O.ParticipantAttributesChanged,r,i)}).on(L.ConnectionQualityChanged,r=>{this.emitWhenConnected(O.ConnectionQualityChanged,r,i)}).on(L.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(O.ParticipantPermissionsChanged,r,i)}).on(L.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(O.TrackSubscriptionStatusChanged,r,s,i)}).on(L.TrackSubscriptionFailed,(r,s)=>{this.emit(O.TrackSubscriptionFailed,r,i,s)}).on(L.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(O.TrackSubscriptionPermissionChanged,r,s,i)}).on(L.Active,()=>{this.emitWhenConnected(O.ParticipantActive,i),i.kind===yi.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&lv(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=De.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,nt.STATE_MISMATCH))):e=0},by)}clearConnectionReconcile(){this.connectionReconcileInterval&&De.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(O.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===ee.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ee.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return b(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new sr({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:me.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new yn({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(O.SignalConnected),this.emit(O.Connected),this.setAndEmitConnectionState(ee.Connected),r.video){const o=new Ho(x.Kind.Video,new Fn({source:ke.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO,name:"video-dummy"}),new Tr(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:lu(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(L.LocalTrackPublished,o)}if(r.audio){const o=new Ho(x.Kind.Audio,new Fn({source:ke.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO}),new Sr(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:bo(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(L.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new yn({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Un.ACTIVE,tracks:[],joinedAt:me.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=lu(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),d=new Fn({source:ke.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}if(s.audio){const l=bo(),d=new Fn({source:ke.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==O.ActiveSpeakersChanged&&e!==O.TranscriptionReceived){const s=qu(i).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Jn.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function qu(t){return t.map(e=>{if(e)return Array.isArray(e)?qu(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var at;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(at||(at={}));class sn extends mt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=at.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Jn(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return b(this,void 0,void 0,function*(){if(this.status!==at.IDLE)throw Error("check is running already");this.setStatus(at.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==at.SKIPPED&&this.setStatus(this.isSuccess()?at.SUCCESS:at.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return b(this,void 0,void 0,function*(){return this.room.state===ee.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return b(this,void 0,void 0,function*(){this.room&&this.room.state!==ee.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(at.SKIPPED)}switchProtocol(e){return b(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(O.Reconnecting,()=>{n=!0}),this.room.once(O.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Ve(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class _y extends sn{get description(){return"Cloud regions"}perform(){return b(this,void 0,void 0,function*(){const e=new $o(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return b(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),d=Date.now();for(let m=0;m<c;m++)yield s.write(l);yield s.close();const u=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:r,rtt:1e4,duration:u-d};return h==null||h.forEach(m=>{m.type==="candidate-pair"&&m.nominated&&(f.rtt=m.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const zo=1e4;class ky extends sn{get description(){return"Connection via UDP vs TCP"}perform(){return b(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(zo/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(zo/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return b(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,d={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},u=setInterval(()=>b(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(d.packetsSent=f.packetsSent,d.qualityLimitationDurations=f.qualityLimitationDurations,d.bitrateTotal+=f.targetBitrate,d.count++):f.type==="remote-inbound-rtp"&&(d.packetsLost=f.packetsLost,d.rttTotal+=f.roundTripTime,d.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,zo)),clearInterval(u),a.stop(),n.remove(),yield this.disconnect(),d})}}class Cy extends sn{get description(){return"Can publish audio"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield py();if(yield hu(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class Sy extends sn{get description(){return"Can publish video"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield fy();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return b(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),d=e.getSettings(),u=(o=(s=d.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=d.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=u,l.height=h;const f=l.getContext("2d");f.drawImage(i,0,0);const p=f.getImageData(0,0,l.width,l.height).data;let g=!0;for(let v=0;v<p.length;v+=4)if(p[v]!==0||p[v+1]!==0||p[v+2]!==0){g=!1;break}g?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class Ty extends sn{get description(){return"Resuming connection after interruption"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(O.SignalReconnecting,a).on(O.Reconnecting,a).on(O.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==ee.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class wy extends sn{get description(){return"Can connect via TURN"}perform(){return b(this,void 0,void 0,function*(){var e,n;const i=new Po,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class Ey extends sn{get description(){return"Establishing WebRTC connection"}perform(){return b(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(O.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(Py(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),X.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function Py(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class xy extends sn{get description(){return"Connecting to signal connection via WebSocket"}perform(){return b(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Po;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===ql.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class jk extends mt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:at.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==at.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return b(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(xy)})}checkWebRTC(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Ey)})}checkTURN(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(wy)})}checkReconnect(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Ty)})}checkPublishAudio(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Cy)})}checkPublishVideo(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Sy)})}checkConnectionProtocol(){return b(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(ky);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(_y)})}}function Pr(){return Pr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Pr.apply(null,arguments)}const Wu=new Uint8Array(0);class Pi{static getFullOptions(e){return Pr({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=1,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":return void await i.handleClientToolCall(r);case"audio":return void i.handleAudio(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});default:return void i.options.onDebug(r)}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id)}handleAgentResponse(e){this.options.onMessage({source:"ai",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage({source:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i==null?void 0:i.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i==null?void 0:i.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}onError(e,n){console.error(e,n),this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){}getInputByteFrequencyData(){return Wu}getOutputByteFrequencyData(){return Wu}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let Hu=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function xr(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const zu="0.4.0";function Go(t){return!!t.type}const Gu="conversation_initiation_client_data";function Ku(t){const e={type:Gu};var n,i,r,s,o;return t.overrides&&(e.conversation_config_override={agent:{prompt:(n=t.overrides.agent)==null?void 0:n.prompt,first_message:(i=t.overrides.agent)==null?void 0:i.firstMessage,language:(r=t.overrides.agent)==null?void 0:r.language},tts:{voice_id:(s=t.overrides.tts)==null?void 0:s.voiceId},conversation:{text_only:(o=t.overrides.conversation)==null?void 0:o.textOnly}}),t.customLlmExtraBody&&(e.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(e.dynamic_variables=t.dynamicVariables),t.userId&&(e.user_id=t.userId),e}class Ko extends Hu{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",s=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:s}),0)}),this.socket.addEventListener("close",s=>{this.disconnect(s.code===1e3?{reason:"agent",context:s}:{reason:"error",message:s.reason||"The connection was closed by the server.",context:s})}),this.socket.addEventListener("message",s=>{try{const o=JSON.parse(s.data);if(!Go(o))return;this.handleMessage(o)}catch{}})}static async create(e){let n=null;try{var i,r,s;const a=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const l=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||zu,d=((s=e.overrides)==null||(s=s.client)==null?void 0:s.source)||"js_sdk";if(e.signedUrl){const _=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${_}source=${d}&version=${l}`}else c=`${a}/v1/convai/conversation?agent_id=${e.agentId}&source=${d}&version=${l}`;const u=["convai"];e.authorization&&u.push(`bearer.${e.authorization}`),n=new WebSocket(c,u);const h=await new Promise((_,C)=>{n.addEventListener("open",()=>{var y;const k=Ku(e);(y=n)==null||y.send(JSON.stringify(k))},{once:!0}),n.addEventListener("error",y=>{setTimeout(()=>C(y),0)}),n.addEventListener("close",C),n.addEventListener("message",y=>{const k=JSON.parse(y.data);Go(k)&&(k.type==="conversation_initiation_metadata"?_(k.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:f,agent_output_audio_format:m,user_input_audio_format:p}=h,g=xr(p??"pcm_16000"),v=xr(m);return new Ko(n,f,g,v)}catch(a){var o;throw(o=n)==null||o.close(),a}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}}class Jo extends Hu{constructor(e,n,i,r,s={}){super(s),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r;const o=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||zu,a=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",c=`https://api.elevenlabs.io/v1/convai/conversation/token?agent_id=${e.agentId}&source=${a}&version=${o}`,l=await fetch(c);if(!l.ok)throw new Error(`ElevenLabs API returned ${l.status} ${l.statusText}`);if(n=(await l.json()).token,!n)throw new Error("No conversation token received from API")}catch(o){let a=o instanceof Error?o.message:String(o);throw o instanceof Error&&o.message.includes("401")&&(a="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${a}`)}}const s=new Jn;try{const o=`webrtc-${Date.now()}`,a=xr("pcm_48000"),c=xr("pcm_48000"),l=new Jo(s,o,a,c,e),d=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";await s.connect(d,n),await new Promise(h=>{if(l.isConnected)h();else{const f=()=>{s.off(O.Connected,f),h()};s.on(O.Connected,f)}}),s.name&&(l.conversationId=s.name),await s.localParticipant.setMicrophoneEnabled(!0);const u=Ku(e);return l.debug({type:Gu,message:u}),await l.sendMessage(u),l}catch(o){throw await s.disconnect(),o}}setupRoomEventListeners(){var e=this;this.room.on(O.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(O.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(O.ConnectionStateChanged,n=>{n===ee.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(O.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;Go(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(O.TrackSubscribed,async function(n,i,r){if(n.kind===x.Kind.Audio&&r.identity.includes("agent")){const s=n.attach();s.autoplay=!0,s.controls=!1,s.style.display="none",document.body.appendChild(s)}})}close(){this.isConnected&&this.room.disconnect()}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}}async function Ju(t){const e=function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"}(t);switch(e){case"websocket":return Ko.create(t);case"webrtc":return Jo.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function Yu(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Xu(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(Yu()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class Yo extends Pi{static async startSession(e){const n=Pi.getFullOptions(e);n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await Xu(n.connectionDelay),i=await Ju(e),new Yo(n,i)}catch(s){var r;throw n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),s}}}function Ry(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function Iy(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Xo=new Map;function Qu(t,e){return async n=>{const i=Xo.get(t);if(i)return n.addModule(i);const r=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(r);try{return await n.addModule(s),void Xo.set(t,s)}catch{URL.revokeObjectURL(s)}try{const o=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(o),Xo.set(t,o)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets.`)}}}const Oy=Qu("raw-audio-processor",`
const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("raw-audio-processor", RawAudioProcessor);
`);class Qo{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i}){let r=null,s=null;try{const c={sampleRate:{ideal:e},echoCancellation:{ideal:!0},noiseSuppression:{ideal:!0}};if(Yu()&&i){const f=(await window.navigator.mediaDevices.enumerateDevices()).find(m=>m.kind==="audioinput"&&["airpod","headphone","earphone"].find(p=>m.label.toLowerCase().includes(p)));f&&(c.deviceId={ideal:f.deviceId})}const l=navigator.mediaDevices.getSupportedConstraints().sampleRate;r=new window.AudioContext(l?{sampleRate:e}:{});const d=r.createAnalyser();l||await r.audioWorklet.addModule("https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js"),await Oy(r.audioWorklet),s=await navigator.mediaDevices.getUserMedia({audio:c});const u=r.createMediaStreamSource(s),h=new AudioWorkletNode(r,"raw-audio-processor");return h.port.postMessage({type:"setFormat",format:n,sampleRate:e}),u.connect(d),d.connect(h),await r.resume(),new Qo(r,d,h,s)}catch(c){var o,a;throw(o=s)==null||o.getTracks().forEach(l=>l.stop()),(a=r)==null||a.close(),c}}constructor(e,n,i,r){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r}async close(){this.inputStream.getTracks().forEach(e=>e.stop()),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}}const Ay=Qu("audio-concat-processor",`
const decodeTable = [0,132,396,924,1980,4092,8316,16764];

export function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audio-concat-processor", AudioConcatProcessor);
`);let Dy=class $f{static async create({sampleRate:e,format:n}){let i=null;try{i=new AudioContext({sampleRate:e});const s=i.createAnalyser(),o=i.createGain();o.connect(s),s.connect(i.destination),await Ay(i.audioWorklet);const a=new AudioWorkletNode(i,"audio-concat-processor");return a.port.postMessage({type:"setFormat",format:n}),a.connect(o),await i.resume(),new $f(i,s,o,a)}catch(s){var r;throw(r=i)==null||r.close(),s}}constructor(e,n,i,r){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r}async close(){await this.context.close()}};class Zo extends Pi{static async startSession(e){var n;const i=Pi.getFullOptions(e);i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,s=null,o=null,a=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var l;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await Xu(i.connectionDelay),s=await Ju(e),[r,o]=await Promise.all([Qo.create(Pr({},s.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices})),Dy.create(s.outputFormat)]),(l=a)==null||l.getTracks().forEach(p=>p.stop()),a=null,new Zo(i,s,r,o,c)}catch(p){var d,u,h,f;i.onStatusChange({status:"disconnected"}),(d=a)==null||d.getTracks().forEach(g=>g.stop()),(u=s)==null||u.close(),await((h=r)==null?void 0:h.close()),await((f=o)==null?void 0:f.close());try{var m;await((m=c)==null?void 0:m.release()),c=null}catch{}throw p}}constructor(e,n,i,r,s){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=o=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:Ry(o.data[0].buffer)})},this.onOutputWorkletMessage=({data:o})=>{o.type==="process"&&this.updateMode(o.finished?"listening":"speaking")},this.addAudioBase64Chunk=o=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:Iy(o)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=o=>{if(o.length===0)return 0;let a=0;for(let c=0;c<o.length;c++)a+=o[c]/255;return a/=o.length,a<0?0:a>1?1:a},this.input=i,this.output=r,this.wakeLock=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){this.lastInterruptTimestamp<=e.audio_event.event_id&&(this.options.onAudio(e.audio_event.audio_base_64),this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}}class My extends Pi{static startSession(e){return e.textOnly?Yo.startSession(e):Zo.startSession(e)}}const Zu=xe(null);function Ny({children:t}){const e=vn(),n=qe(()=>e.value.mic_muting_enabled??!1),i=Ot(!1),r=ie(()=>({isMuted:Ze(()=>n.value?i.value:!1),setIsMuted:s=>{i.value=s},isMutingEnabled:n}),[]);return S(Zu.Provider,{value:r,children:t})}function ea(){return ht(Zu)}const xi={en:{name:"English",flagCode:"us",languageCode:"en"},zh:{name:"Chinese",flagCode:"cn",languageCode:"zh"},es:{name:"Spanish",flagCode:"es",languageCode:"es"},hi:{name:"Hindi",flagCode:"in",languageCode:"hi"},pt:{name:"Portuguese (Portugal)",flagCode:"pt",languageCode:"pt"},"pt-br":{name:"Portuguese (Brazil)",flagCode:"br",languageCode:"pt-br"},fr:{name:"French",flagCode:"fr",languageCode:"fr"},de:{name:"German",flagCode:"de",languageCode:"de"},ja:{name:"Japanese",flagCode:"jp",languageCode:"ja"},ar:{name:"Arabic",flagCode:"ae",languageCode:"ar"},ru:{name:"Russian",flagCode:"ru",languageCode:"ru"},ko:{name:"Korean",flagCode:"kr",languageCode:"ko"},id:{name:"Indonesian",flagCode:"id",languageCode:"id"},it:{name:"Italian",flagCode:"it",languageCode:"it"},nl:{name:"Dutch",flagCode:"nl",languageCode:"nl"},tr:{name:"Turkish",flagCode:"tr",languageCode:"tr"},pl:{name:"Polish",flagCode:"pl",languageCode:"pl"},sv:{name:"Swedish",flagCode:"se",languageCode:"sv"},fil:{name:"Filipino",flagCode:"ph",languageCode:"fi"},ms:{name:"Malay",flagCode:"my",languageCode:"ms"},ro:{name:"Romanian",flagCode:"ro",languageCode:"ro"},uk:{name:"Ukrainian",flagCode:"ua",languageCode:"uk"},el:{name:"Greek",flagCode:"gr",languageCode:"el"},cs:{name:"Czech",flagCode:"cz",languageCode:"cs"},da:{name:"Danish",flagCode:"dk",languageCode:"da"},fi:{name:"Finnish",flagCode:"fi",languageCode:"fi"},bg:{name:"Bulgarian",flagCode:"bg",languageCode:"bg"},hr:{name:"Croatian",flagCode:"hr",languageCode:"hr"},sk:{name:"Slovak",flagCode:"sk",languageCode:"sk"},ta:{name:"Tamil",flagCode:"in",languageCode:"ta"},hu:{name:"Hungarian",flagCode:"hu",languageCode:"hu"},no:{name:"Norwegian",flagCode:"no",languageCode:"no"},vi:{name:"Vietnamese",flagCode:"vn",languageCode:"vi"}};function Rr(t){return Object.keys(xi).includes(t??"")}const eh=xe(null);function Ly({children:t}){const e=vn(),n=Ae("language"),i=Ae("override-language"),r=Ot(n.peek()??e.peek().language),s=qe(()=>(e.value.supported_language_overrides??[]).filter(Rr)),o=qe(()=>s.value.map(c=>xi[c]).sort((c,l)=>c.name.localeCompare(l.name))),a=ie(()=>({language:Ze(()=>Rr(i.value)?xi[i.value]:Rr(r.value)&&s.value.includes(r.value)?xi[r.value]:xi[e.value.language]),setLanguage:c=>{r.value=c},options:o,showPicker:Ze(()=>!Rr(i.value)&&o.value.length>0)}),[]);return S(eh.Provider,{value:a,children:t})}function ta(){return ht(eh)}const th=xe(null);function Uy({children:t}){const{language:e}=ta(),n=Ae("override-prompt"),i=Ae("override-first-message"),r=Ae("override-voice-id"),s=qe(()=>({agent:{prompt:{prompt:n.value},firstMessage:i.value,language:e.value.languageCode},tts:{voiceId:r.value}})),o=Ae("dynamic-variables"),a=qe(()=>{if(o.value)try{return JSON.parse(o.value)}catch(h){console.error(`[ConversationalAI] Cannot parse dynamic-variables: ${h==null?void 0:h.message}`)}}),{webSocketUrl:c}=Ps(),l=Ae("agent-id"),d=Ae("signed-url"),u=qe(()=>{const h={dynamicVariables:a.value,overrides:s.value};return l.value?{agentId:l.value,connectionType:"websocket",origin:c.value,source:"widget",version:"0.0.1",...h}:d.value?{signedUrl:d.value,...h}:(console.error("[ConversationalAI] Either agent-id or signed-url is required"),null)});return u.value?S(th.Provider,{value:u,children:t}):null}function Fy(){return ht(th)}const nh=xe(null);function By({children:t}){const e=jy();return S(nh.Provider,{value:e,children:t})}function Ir(){return ht(nh)}function jy(){const t=W(null),e=W(null),n=Fy(),{isMuted:i}=ea();return gn(()=>{var r;i.value&&((r=t==null?void 0:t.current)==null||r.setMicMuted(i.value))}),K(()=>()=>{var r;(r=t.current)==null||r.endSession()},[]),ie(()=>{const r=Gt("disconnected"),s=Ze(()=>r.value==="disconnected"),o=Gt("listening"),a=Ze(()=>o.value==="speaking"),c=Gt(null),l=Gt(null),d=Gt(!1);return{status:r,isSpeaking:a,mode:o,isDisconnected:s,lastId:l,error:c,canSendFeedback:d,startSession:async u=>{var h;if((h=t.current)!=null&&h.isOpen())return t.current.getId();if(e.current)return(await e.current).getId();try{e.current=My.startSession({...Vy(u,n.peek()),onModeChange:m=>{o.value=m.mode},onStatusChange:m=>{r.value=m.status},onCanSendFeedbackChange:m=>{d.value=m.canSendFeedback},onDisconnect:m=>{m.reason==="error"&&(c.value=m.message,console.error("[ConversationalAI] Disconnected due to an error:",m.message))}}),t.current=await e.current,i.peek()!==void 0&&t.current.setMicMuted(i.peek());const f=t.current.getId();return l.value=f,c.value=null,f}catch(f){let m="Could not start a conversation.";f instanceof CloseEvent?m=f.reason||m:f instanceof Error&&(m=f.message||m),c.value=m}finally{e.current=null}},endSession:async()=>{const u=t.current;t.current=null,await(u==null?void 0:u.endSession())},getInputVolume:()=>{var u;return((u=t.current)==null?void 0:u.getInputVolume())??0},getOutputVolume:()=>{var u;return((u=t.current)==null?void 0:u.getOutputVolume())??0},sendFeedback:u=>{var h;(h=t.current)==null||h.sendFeedback(u)}}},[n,i])}function Vy(t,e){try{const n=new CustomEvent("elevenlabs-convai:call",{bubbles:!0,composed:!0,detail:{config:structuredClone(e)}});return t.dispatchEvent(n),n.detail.config}catch(n){return console.error("[ConversationalAI] Could not trigger call event:",n),e}}function $y(t,e,n="https://api.elevenlabs.io"){return fetch(`${n}/v1/convai/conversations/${t}/feedback`,{method:"POST",body:JSON.stringify({feedback:e?"like":"dislike"}),headers:{"Content-Type":"application/json"}})}const ih=1e3*30,qy=1e3*5,Wy=1e3*60*5,rh=xe(null);function Hy({children:t}){const e=vn(),{serverUrl:n}=Ps(),{canSendFeedback:i,sendFeedback:r,isDisconnected:s,error:o,lastId:a}=Ir(),c=Ot(0),l=Ot(!1);gn(()=>{a.value!==null&&(l.value=!0,c.value=0)}),gn(()=>{const g=Date.now()-c.value;if(g>=ih)l.value=!0;else{l.value=!1;const v=setTimeout(()=>{l.value=!0},ih-g);return()=>clearTimeout(v)}});const d=Ot(i.value);gn(()=>{if(i.value){const g=setTimeout(()=>{d.value=!0},qy);return()=>clearTimeout(g)}else d.value=!1});const u=Ot(!0);gn(()=>{if(s.value){const g=setTimeout(()=>{u.value=!1},Wy);return()=>clearTimeout(g)}else u.value=!0});const h=Ot(null),f=qe(()=>!!a.value&&h.value!==a.value&&o.value===null&&s.value&&(e.value.feedback_mode==="end"||e.value.feedback_mode==="during")),m=qe(()=>!!a.value&&l.value&&o.value===null&&!s.value&&d.value&&e.value.feedback_mode==="during"),p=ie(()=>({endFeedbackActive:f,duringFeedbackActive:m,postEndFeedback:g=>{const v=a.peek();f.peek()&&v&&(h.value=v,$y(v,g,n.peek()).catch(()=>{console.error(`[ConversationalAI] Cannot send feedback for conversation ${v}`)}))},postDuringFeedback:g=>{m.peek()&&(r(g),l.value=!1,c.value=Date.now())}}),[]);return S(rh.Provider,{value:p,children:t})}function na(){return ht(rh)}const sh=xe(null);function zy({children:t}){const e=vn(),n=Xc(),i=ie(()=>Object.fromEntries(ic.map((r,s)=>[r,Ze(()=>n[rc[s]].value??e.value[r]??nc[r])])),[]);return S(sh.Provider,{value:i,children:t})}function Gy(){return ht(sh)}function oh(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=oh(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function _t(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=oh(t))&&(i&&(i+=" "),i+=e);return i}function Ky(t){const e=s=>typeof window<"u"?window.matchMedia(s).matches:!1,[n,i]=B(e(t));function r(){i(e(t))}return K(()=>{const s=window.matchMedia(t);return r(),s.addListener?s.addListener(r):s.addEventListener("change",r),()=>{s.removeListener?s.removeListener(r):s.removeEventListener("change",r)}},[t]),n}const Jy=`#version 300 es
precision highp float;

uniform float uTime;
uniform float uOffsets[7];
uniform vec3 uColor1;
uniform vec3 uColor2;
uniform sampler2D uPerlinTexture;

in vec2 vUv;

out vec4 outColor;

const float PI = 3.14159265358979323846;

// Draw a single oval with soft edges and calculate its gradient color
bool drawOval(vec2 polarUv, vec2 polarCenter, float a, float b, bool reverseGradient, float softness, out vec4 color) {
    vec2 p = polarUv - polarCenter;
    float oval = (p.x * p.x) / (a * a) + (p.y * p.y) / (b * b);
    
    float edge = smoothstep(1.0, 1.0 - softness, oval);
    
    if (edge > 0.0) {
        float gradient = reverseGradient ? (1.0 - (p.x / a + 1.0) / 2.0) : ((p.x / a + 1.0) / 2.0);
        color = vec4(vec3(gradient), 0.8 * edge);
        return true;
    }
    return false;
}

// Map grayscale value to a 4-color ramp (color1, color2, color3, color4)
vec3 colorRamp(float grayscale, vec3 color1, vec3 color2, vec3 color3, vec3 color4) {
    if (grayscale < 0.33) {
        return mix(color1, color2, grayscale * 3.0);
    } else if (grayscale < 0.66) {
        return mix(color2, color3, (grayscale - 0.33) * 3.0);
    } else {
        return mix(color3, color4, (grayscale - 0.66) * 3.0);
    }
}

vec2 hash2(vec2 p) {
    return fract(sin(vec2(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)))) * 43758.5453);
}

// 2D noise for the ring
float noise2D(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    
    vec2 u = f * f * (3.0 - 2.0 * f);
    float n = mix(
        mix(dot(hash2(i + vec2(0.0, 0.0)), f - vec2(0.0, 0.0)),
            dot(hash2(i + vec2(1.0, 0.0)), f - vec2(1.0, 0.0)), u.x),
        mix(dot(hash2(i + vec2(0.0, 1.0)), f - vec2(0.0, 1.0)),
            dot(hash2(i + vec2(1.0, 1.0)), f - vec2(1.0, 1.0)), u.x),
        u.y
    );

    return 0.5 + 0.5 * n;
}

float sharpRing(vec2 uv, float theta, float time) {
    float ringStart = 1.0;
    float ringWidth = 0.5;
    float noiseScale = 5.0;
    
    vec2 noiseCoord = vec2(theta / (2.0 * PI), time * 0.1);
    noiseCoord *= noiseScale;
    
    float noise = noise2D(noiseCoord);
    noise = (noise - 0.5) * 4.0;
    
    return ringStart + noise * ringWidth * 1.5;
}

float smoothRing(vec2 uv, float time) {
    float angle = atan(uv.y, uv.x);
    if (angle < 0.0) angle += 2.0 * PI;
    
    vec2 noiseCoord = vec2(angle / (2.0 * PI), time * 0.1);
    noiseCoord *= 6.0;
    
    float noise = noise2D(noiseCoord);
    noise = (noise - 0.5) * 8.0;
    
    float ringStart = 0.9;
    float ringWidth = 0.3;
    
    return ringStart + noise * ringWidth;
}

void main() {
    // Normalize vUv to be centered around (0.0, 0.0)
    vec2 uv = vUv * 2.0 - 1.0;

    // Convert uv to polar coordinates
    float radius = length(uv);
    float theta = atan(uv.y, uv.x);
    if (theta < 0.0) theta += 2.0 * PI; // Normalize theta to [0, 2*PI]

    // Initialize the base color to white
    vec4 color = vec4(1.0, 1.0, 1.0, 1.0);

    // Original parameters for the ovals in polar coordinates
    float originalCenters[7] = float[7](0.0, 0.5 * PI, 1.0 * PI, 1.5 * PI, 2.0 * PI, 2.5 * PI, 3.0 * PI);

    // Parameters for the animated centers in polar coordinates
    float centers[7];
    for (int i = 0; i < 7; i++) {
        centers[i] = originalCenters[i] + 0.5 * sin(uTime / 20.0 + uOffsets[i]);
    }

    float a, b;
    vec4 ovalColor;

    // Check if the pixel is inside any of the ovals
    for (int i = 0; i < 7; i++) {
        float noise = texture(uPerlinTexture, vec2(mod(centers[i] + uTime * 0.05, 1.0), 0.5)).r;
        a = noise * 1.5; // Increased variance: goes from 0.0 to 1.0
        b = noise * 4.5; // Tall semi-minor axis
        bool reverseGradient = (i % 2 == 1); // Reverse gradient for every second oval

        // Calculate the distance in polar coordinates
        float distTheta = abs(theta - centers[i]);
        if (distTheta > PI) distTheta = 2.0 * PI - distTheta; // Shortest distance on circle
        float distRadius = radius;

        float softness = 0.4; // Controls edge softness (e.g. how much blur is applied to the ovals)

        // Check if the pixel is inside the oval in polar coordinates
        if (drawOval(vec2(distTheta, distRadius), vec2(0.0, 0.0), a, b, reverseGradient, softness, ovalColor)) {
            // Blend the oval color with the existing color
            color.rgb = mix(color.rgb, ovalColor.rgb, ovalColor.a);
            color.a = max(color.a, ovalColor.a); // Max alpha
        }
    }
    
    // Calculate both noisy rings
    float ringRadius1 = sharpRing(uv, theta, uTime);
    float ringRadius2 = smoothRing(uv, uTime);
    
    // Blend both rings
    float ringAlpha1 = (radius >= ringRadius1) ? 0.3 : 0.0;
    float ringAlpha2 = smoothstep(ringRadius2 - 0.05, ringRadius2 + 0.05, radius) * 0.25;
    
    float totalRingAlpha = max(ringAlpha1, ringAlpha2);
    
    // Apply screen blend mode for combined rings
    vec3 ringColor = vec3(1.0); // White ring color
    color.rgb = 1.0 - (1.0 - color.rgb) * (1.0 - ringColor * totalRingAlpha);

    // Define colours to ramp against greyscale (could increase the amount of colours in the ramp)
    vec3 color1 = vec3(0.0, 0.0, 0.0); // Black
    vec3 color2 = uColor1; // Darker Color
    vec3 color3 = uColor2; // Lighter Color
    vec3 color4 = vec3(1.0, 1.0, 1.0); // White

    // Convert grayscale color to the color ramp
    float luminance = color.r; 
    color.rgb = colorRamp(luminance, color1, color2, color3, color4); // Apply the color ramp

    outColor = color;
}
`,Yy=`#version 300 es
precision highp float;

in vec2 position;

out vec2 vUv;

void main() {
  vUv = position * 0.5 + 0.5;
  gl_Position = vec4(position, 0, 1);
}
`,ah=0,Xy=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Qy="https://storage.googleapis.com/eleven-public-cdn/images/perlin-noise.png",Tt=class Tt{constructor(e){Wt(this,"gl");Wt(this,"program");Wt(this,"startTime");Wt(this,"rafId",null);Wt(this,"resizeObserver");Wt(this,"copyNoiseImage",()=>{this.gl&&(this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Tt.noiseImage),this.gl.generateMipmap(this.gl.TEXTURE_2D))});Wt(this,"render",()=>{if(!this.gl){this.rafId=null;return}const e=(performance.now()-this.startTime)/1e3;this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uTime"),e),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.rafId=requestAnimationFrame(this.render)});const n=e.getContext("webgl2",{depth:!1,stencil:!1});this.gl=n;const i=this.getShader(n.FRAGMENT_SHADER,Jy),r=this.getShader(n.VERTEX_SHADER,Yy);if(!i||!r)throw new Error("Failed to compile shaders");if(this.program=n.createProgram(),n.attachShader(this.program,i),n.attachShader(this.program,r),n.linkProgram(this.program),!n.getProgramParameter(this.program,n.LINK_STATUS))throw new Error("Failed to link program");const s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([128,128,128,255])),Tt.noiseImage||(Tt.noiseImage=new Image,Tt.noiseImage.crossOrigin="anonymous",Tt.noiseImage.src=Qy),Tt.noiseImage.complete?this.copyNoiseImage():Tt.noiseImage.addEventListener("load",this.copyNoiseImage);const o=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,Xy,n.STATIC_DRAW),n.vertexAttribPointer(ah,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(ah),n.useProgram(this.program),n.uniform1i(n.getUniformLocation(this.program,"uPerlinTexture"),0),n.uniform1fv(n.getUniformLocation(this.program,"uOffsets"),new Float32Array(7).map(()=>Math.random()*Math.PI*2)),this.updateColors("#2792DC","#9CE6E6"),this.resizeObserver=new ResizeObserver(c=>{const l=c[0],d=l.devicePixelContentBoxSize?l.devicePixelContentBoxSize[0]:l.contentBoxSize[0];e.width=Math.min(512,d.inlineSize),e.height=Math.min(512,d.blockSize),this.updateViewport()});const a=e.parentElement;if(a)try{this.resizeObserver.observe(a,{box:"device-pixel-content-box"})}catch{this.resizeObserver.observe(a)}this.startTime=performance.now(),this.rafId=requestAnimationFrame(this.render)}dispose(){var e,n,i;this.rafId!==null&&cancelAnimationFrame(this.rafId),(e=this.resizeObserver)==null||e.disconnect(),(i=(n=this.gl)==null?void 0:n.getExtension("WEBGL_lose_context"))==null||i.loseContext(),this.gl=null,this.program=null}updateViewport(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}updateColors(e,n){this.updateColor("uColor1",e),this.updateColor("uColor2",n)}updateColor(e,n){try{const i=parseInt(n.slice(1,3),16)/255,r=parseInt(n.slice(3,5),16)/255,s=parseInt(n.slice(5,7),16)/255;this.gl.uniform3fv(this.gl.getUniformLocation(this.program,e),[Math.pow(i,2.2),Math.pow(r,2.2),Math.pow(s,2.2)])}catch(i){console.error(`[ConversationalAI] Failed to parse ${n} as color:`,i)}}getShader(e,n){const i=this.gl.createShader(e);return this.gl.shaderSource(i,n),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}};Wt(Tt,"noiseImage");let ia=Tt;const V={devHost:"_devHost_1968y_7",wrapper:"_wrapper_1968y_18",box:"_box_1968y_39",open:"_open_1968y_57",compact:"_compact_1968y_62",customContent:"_customContent_1968y_62",avatar:"_avatar_1968y_68",avatarBackground:"_avatarBackground_1968y_80",avatarImage:"_avatarImage_1968y_90",canvas:"_canvas_1968y_102",actions:"_actions_1968y_107",actionButtons:"_actionButtons_1968y_114",status:"_status_1968y_121",btn:"_btn_1968y_132",avatarButton:"_avatarButton_1968y_166",disabled:"_disabled_1968y_189",secondary:"_secondary_1968y_203",iconBtn:"_iconBtn_1968y_217",select:"_select_1968y_224",ellipsis:"_ellipsis_1968y_231",iconSlot:"_iconSlot_1968y_237",btnIcon:"_btnIcon_1968y_242",minimize:"_minimize_1968y_248",poweredBy:"_poweredBy_1968y_252",full:"_full_1968y_277",terms:"_terms_1968y_281",strong:"_strong_1968y_312",show:"_show_1968y_340",termsFooter:"_termsFooter_1968y_344",feedback:"_feedback_1968y_355",inlineFeedback:"_inlineFeedback_1968y_381",feedbackText:"_feedbackText_1968y_400",flag:"_flag_1968y_404",selectContent:"_selectContent_1968y_412",selectViewport:"_selectViewport_1968y_423",selectValue:"_selectValue_1968y_427",selectIcon:"_selectIcon_1968y_433",selectItem:"_selectItem_1968y_437",selectItemIndicator:"_selectItemIndicator_1968y_456",selectScrollButton:"_selectScrollButton_1968y_465",error:"_error_1968y_474"};function ch(){const{getInputVolume:t,getOutputVolume:e,isSpeaking:n,isDisconnected:i}=Ir(),r=$p(),s=W(null),o=W(null);gn(()=>{if(i.value){s.current.style.transform="",o.current.style.transform="",o.current.style.opacity="";return}let c;function l(){const d=t(),u=e(),h=n.peek()?1:.5,f=n.peek()?1:1-d*.6,m=n.peek()?1+u*.6:1;s.current.style.transform=`scale(${m})`,o.current.style.transform=`scale(${f})`,o.current.style.opacity=`${h}`,c=requestAnimationFrame(l)}return l(),()=>{cancelAnimationFrame(c)}});const a=qe(()=>({backgroundImage:r.value.type==="image"?`url(${r.value.url})`:r.value.type==="url"?`url(${r.value.custom_url})`:void 0}));return S("div",{className:V.avatar,children:[S("div",{ref:s,className:V.avatarBackground}),S("div",{ref:o,style:a,className:V.avatarImage,children:r.value.type==="orb"&&S(Zy,{color1:r.value.color_1,color2:r.value.color_2})})]})}function Zy({color1:t,color2:e}){const n=W(null),i=W(null);return K(()=>{var r;try{i.current=new ia(n.current)}catch{(r=i.current)==null||r.dispose(),i.current=null}return()=>{var s;(s=i.current)==null||s.dispose()}},[]),K(()=>{var r;(r=i.current)==null||r.updateColors(t,e)},[t,e]),S("canvas",{className:V.canvas,ref:n})}const eb={phone:tb,"phone-off":nb,"thumbs-up":ib,"thumbs-down":rb,mic:sb,"mic-off":ob,check:lb,"chevron-down":ab,"chevron-up":cb};function Yn({name:t,className:e}){const n=eb[t];return S("slot",{name:`icon-${t}`,className:_t(V.iconSlot,e),children:S(n,{})})}function tb(t){return S("svg",{viewBox:"0 0 640 640",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",stroke:"currentColor",fill:"currentColor",...t,children:S("path",{d:"M 82.6 88.6 l 104 -24 c 11.3 -2.6 22.9 3.3 27.5 13.9 l 48 112 c 4.2 9.8 1.4 21.3 -6.9 28 l -60.6 49.6 c 36 76.7 98.9 140.5 177.2 177.2 l 49.6 -60.6 c 6.8 -8.3 18.2 -11.1 28 -6.9 l 112 48 C 572.1 430.5 578 442.1 575.4 453.4 l -24 104 C 548.9 568.2 539.3 576 528 576 c -256.1 0 -464 -207.5 -464 -464 c 0 -11.2 7.7 -20.9 18.6 -23.4 z"})})}function nb(t){return S("svg",{viewBox:"0 0 640 640",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",stroke:"currentColor",fill:"currentColor",...t,children:S("path",{d:"M 371.8 445.4 l 49.6 -60.6 c 6.8 -8.3 18.2 -11.1 28 -6.9 l 112 48 c 10.7 4.6 16.5 16.1 13.9 27.5 l -24 104 c -2.5 10.8 -12.1 18.6 -23.4 18.6 c -100.7 0 -193.7 -32.4 -269.7 -86.9 l 80 -61.8 c 10.9 6.5 22.1 12.7 33.6 18.1 z m -365.6 76.7 L 164.9 399.5 C 102.1 320.4 64 220.9 64 112 c 0 -11.2 7.7 -20.9 18.6 -23.4 l 104 -24 c 11.3 -2.6 22.9 3.3 27.5 13.9 l 48 112 c 4.2 9.8 1.4 21.3 -6.9 28 l -60.6 49.6 c 12.2 26.1 27.9 50.3 46 72.8 L 594.5 67.4 C 601.5 62 611.5 63.2 617 70.2 L 636.6 95.4 c 5.4 7 4.2 17 -2.8 22.4 l -588.4 454.7 c -7 5.4 -17 4.2 -22.5 -2.8 l -19.6 -25.3 c -5.4 -6.8 -4.1 -16.9 2.9 -22.3 z"})})}function ib(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",className:"lucide lucide-thumbs-up",...t,children:[S("path",{d:"M7 10v12"}),S("path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"})]})}function rb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:[S("path",{d:"M17 14V2"}),S("path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"})]})}function sb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:[S("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),S("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),S("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}function ob(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:[S("line",{x1:"2",x2:"22",y1:"2",y2:"22"}),S("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"}),S("path",{d:"M5 10v2a7 7 0 0 0 12 5"}),S("path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33"}),S("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12"}),S("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}function ab(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:S("path",{d:"m6 9 6 6 6-6"})})}function cb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:S("path",{d:"m18 15-6-6-6 6"})})}function lb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",...t,children:S("path",{d:"M20 6 9 17l-5-5"})})}const db={primary:"",secondary:V.secondary};function Tn({variant:t="secondary",children:e,icon:n,className:i,disabledStyle:r,truncate:s=!0,...o}){return S("button",{className:_t(V.btn,db[t],(o.disabled||r)&&V.disabled,i),type:"button",...o,children:[n&&S(Yn,{className:V.btnIcon,name:n}),s?S("div",{className:V.ellipsis,children:e}):e]})}function ub({value:t,children:e}){const[n,i]=B(!1);return K(()=>{if(n){const r=setTimeout(()=>{i(!1)},2e3);return()=>{clearTimeout(r)}}},[n]),S("button",{className:_t(V.btn,V.secondary),onClick:()=>{navigator.clipboard.writeText(t),i(!0)},children:n?"Copied!":e})}function hb(){const{error:t,lastId:e}=Ir();return S("div",{className:V.error,children:[S("h1",{children:"An error occurred"}),S("p",{children:t.value}),e.value&&S("p",{children:["Conversation ID: ",e.value]}),S("div",{className:V.termsFooter,children:[e.value&&S(ub,{value:e.value,children:"Copy ID"}),S(Tn,{onClick:()=>{t.value=null},children:"Close"})]})]})}function ra({className:t,icon:e,...n}){return S(Tn,{className:_t(V.iconBtn,t),truncate:!1,...n,children:S(Yn,{name:e})})}const fb=()=>{const{postEndFeedback:t}=na();return S(lh,{text:"Was the call helpful?",onSubmit:t,show:!0,inline:!0})},pb=()=>{const{duringFeedbackActive:t,postDuringFeedback:e}=na();return S(lh,{text:"Is this response helpful?",onSubmit:e,show:t.value})},lh=Gi(({onSubmit:t,text:e,show:n,inline:i})=>S("div",{className:_t(i?V.inlineFeedback:V.feedback,n&&V.show),children:[S("span",{className:V.feedbackText,children:e}),S(ra,{icon:"thumbs-up",variant:i?"primary":"secondary",title:"Yes",onClick:()=>t==null?void 0:t(!0)}),S(ra,{icon:"thumbs-down",variant:i?"primary":"secondary",title:"No",onClick:()=>t==null?void 0:t(!1)})]}));function dh(t,[e,n]){return Math.min(n,Math.max(e,t))}function Ce(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function uh(t,e=[]){let n=[];function i(s,o){const a=xe(o),c=n.length;n=[...n,o];function l(u){const{scope:h,children:f,...m}=u,p=(h==null?void 0:h[t][c])||a,g=ie(()=>m,Object.values(m));return S(p.Provider,{value:g,children:f})}function d(u,h){const f=(h==null?void 0:h[t][c])||a,m=It(f);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${u}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,d]}const r=()=>{const s=n.map(o=>xe(o));return function(a){const c=(a==null?void 0:a[t])||s;return ie(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return r.scopeName=t,[i,mb(r,...e)]}function mb(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const o=i.reduce((a,{useScope:c,scopeName:l})=>{const u=c(s)[`__scope${l}`];return{...a,...u}},{});return ie(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function gb(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function hh(...t){return e=>t.forEach(n=>gb(n,e))}function Me(...t){return re(hh(...t),t)}var Ri=Y((t,e)=>{const{children:n,...i}=t,r=Kt.toArray(n),s=r.find(yb);if(s){const o=s.props.children,a=r.map(c=>c===s?Kt.count(o)>1?Kt.only(null):At(o)?o.props.children:null:c);return S(sa,{...i,ref:e,children:At(o)?hi(o,void 0,a):null})}return S(sa,{...i,ref:e,children:n})});Ri.displayName="Slot";var sa=Y((t,e)=>{const{children:n,...i}=t;if(At(n)){const r=_b(n);return hi(n,{...bb(i,n.props),ref:e?hh(e,r):r})}return Kt.count(n)>1?Kt.only(null):null});sa.displayName="SlotClone";var vb=({children:t})=>S(Ee,{children:t});function yb(t){return At(t)&&t.type===vb}function bb(t,e){const n={...e};for(const i in e){const r=t[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?n[i]=(...a)=>{s(...a),r(...a)}:r&&(n[i]=r):i==="style"?n[i]={...r,...s}:i==="className"&&(n[i]=[r,s].filter(Boolean).join(" "))}return{...t,...n}}function _b(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function kb(t){const e=t+"CollectionProvider",[n,i]=uh(e),[r,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=f=>{const{scope:m,children:p}=f,g=Dt.useRef(null),v=Dt.useRef(new Map).current;return S(r,{scope:m,itemMap:v,collectionRef:g,children:p})};o.displayName=e;const a=t+"CollectionSlot",c=Dt.forwardRef((f,m)=>{const{scope:p,children:g}=f,v=s(a,p),_=Me(m,v.collectionRef);return S(Ri,{ref:_,children:g})});c.displayName=a;const l=t+"CollectionItemSlot",d="data-radix-collection-item",u=Dt.forwardRef((f,m)=>{const{scope:p,children:g,...v}=f,_=Dt.useRef(null),C=Me(m,_),y=s(l,p);return Dt.useEffect(()=>(y.itemMap.set(_,{ref:_,...v}),()=>void y.itemMap.delete(_))),S(Ri,{[d]:"",ref:C,children:g})});u.displayName=l;function h(f){const m=s(t+"CollectionConsumer",f);return Dt.useCallback(()=>{const g=m.collectionRef.current;if(!g)return[];const v=Array.from(g.querySelectorAll(`[${d}]`));return Array.from(m.itemMap.values()).sort((y,k)=>v.indexOf(y.ref.current)-v.indexOf(k.ref.current))},[m.collectionRef,m.itemMap])}return[{Provider:o,Slot:c,ItemSlot:u},h,i]}function Cb(t,e=[]){let n=[];function i(s,o){const a=xe(o),c=n.length;n=[...n,o];const l=u=>{var v;const{scope:h,children:f,...m}=u,p=((v=h==null?void 0:h[t])==null?void 0:v[c])||a,g=ie(()=>m,Object.values(m));return S(p.Provider,{value:g,children:f})};l.displayName=s+"Provider";function d(u,h){var p;const f=((p=h==null?void 0:h[t])==null?void 0:p[c])||a,m=It(f);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${u}\` must be used within \`${s}\``)}return[l,d]}const r=()=>{const s=n.map(o=>xe(o));return function(a){const c=(a==null?void 0:a[t])||s;return ie(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return r.scopeName=t,[i,Sb(r,...e)]}function Sb(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const o=i.reduce((a,{useScope:c,scopeName:l})=>{const u=c(s)[`__scope${l}`];return{...a,...u}},{});return ie(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var Tb=xe(void 0);function wb(t){const e=It(Tb);return t||e||"ltr"}var Eb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Se=Eb.reduce((t,e)=>{const n=Y((i,r)=>{const{asChild:s,...o}=i,a=s?Ri:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S(a,{...o,ref:r})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function Pb(t,e){t&&Ji(()=>t.dispatchEvent(e))}function Vt(t){const e=W(t);return K(()=>{e.current=t}),ie(()=>(...n)=>{var i;return(i=e.current)==null?void 0:i.call(e,...n)},[])}function xb(t,e=globalThis==null?void 0:globalThis.document){const n=Vt(t);K(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var Rb="DismissableLayer",oa="dismissableLayer.update",Ib="dismissableLayer.pointerDownOutside",Ob="dismissableLayer.focusOutside",fh,ph=xe({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),mh=Y((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...c}=t,l=It(ph),[d,u]=B(null),h=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=B({}),m=Me(e,E=>u(E)),p=Array.from(l.layers),[g]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),v=p.indexOf(g),_=d?p.indexOf(d):-1,C=l.layersWithOutsidePointerEventsDisabled.size>0,y=_>=v,k=Mb(E=>{const I=E.target,R=[...l.branches].some(D=>D.contains(I));!y||R||(r==null||r(E),o==null||o(E),E.defaultPrevented||a==null||a())},h),w=Nb(E=>{const I=E.target;[...l.branches].some(D=>D.contains(I))||(s==null||s(E),o==null||o(E),E.defaultPrevented||a==null||a())},h);return xb(E=>{_===l.layers.size-1&&(i==null||i(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},h),K(()=>{if(d)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(fh=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(d)),l.layers.add(d),gh(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=fh)}},[d,h,n,l]),K(()=>()=>{d&&(l.layers.delete(d),l.layersWithOutsidePointerEventsDisabled.delete(d),gh())},[d,l]),K(()=>{const E=()=>f({});return document.addEventListener(oa,E),()=>document.removeEventListener(oa,E)},[]),S(Se.div,{...c,ref:m,style:{pointerEvents:C?y?"auto":"none":void 0,...t.style},onFocusCapture:Ce(t.onFocusCapture,w.onFocusCapture),onBlurCapture:Ce(t.onBlurCapture,w.onBlurCapture),onPointerDownCapture:Ce(t.onPointerDownCapture,k.onPointerDownCapture)})});mh.displayName=Rb;var Ab="DismissableLayerBranch",Db=Y((t,e)=>{const n=It(ph),i=W(null),r=Me(e,i);return K(()=>{const s=i.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),S(Se.div,{...t,ref:r})});Db.displayName=Ab;function Mb(t,e=globalThis==null?void 0:globalThis.document){const n=Vt(t),i=W(!1),r=W(()=>{});return K(()=>{const s=a=>{if(a.target&&!i.current){let c=function(){vh(Ib,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);i.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function Nb(t,e=globalThis==null?void 0:globalThis.document){const n=Vt(t),i=W(!1);return K(()=>{const r=s=>{s.target&&!i.current&&vh(Ob,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function gh(){const t=new CustomEvent(oa);document.dispatchEvent(t)}function vh(t,e,n,{discrete:i}){const r=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?Pb(r,s):r.dispatchEvent(s)}var aa=0;function Lb(){K(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??yh()),document.body.insertAdjacentElement("beforeend",t[1]??yh()),aa++,()=>{aa===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),aa--}},[])}function yh(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var ca="focusScope.autoFocusOnMount",la="focusScope.autoFocusOnUnmount",bh={bubbles:!1,cancelable:!0},Ub="FocusScope",_h=Y((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:s,...o}=t,[a,c]=B(null),l=Vt(r),d=Vt(s),u=W(null),h=Me(e,p=>c(p)),f=W({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;K(()=>{if(i){let p=function(C){if(f.paused||!a)return;const y=C.target;a.contains(y)?u.current=y:on(u.current,{select:!0})},g=function(C){if(f.paused||!a)return;const y=C.relatedTarget;y!==null&&(a.contains(y)||on(u.current,{select:!0}))},v=function(C){if(document.activeElement===document.body)for(const k of C)k.removedNodes.length>0&&on(a)};document.addEventListener("focusin",p),document.addEventListener("focusout",g);const _=new MutationObserver(v);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",g),_.disconnect()}}},[i,a,f.paused]),K(()=>{if(a){Sh.add(f);const p=document.activeElement;if(!a.contains(p)){const v=new CustomEvent(ca,bh);a.addEventListener(ca,l),a.dispatchEvent(v),v.defaultPrevented||(Fb(qb(kh(a)),{select:!0}),document.activeElement===p&&on(a))}return()=>{a.removeEventListener(ca,l),setTimeout(()=>{const v=new CustomEvent(la,bh);a.addEventListener(la,d),a.dispatchEvent(v),v.defaultPrevented||on(p??document.body,{select:!0}),a.removeEventListener(la,d),Sh.remove(f)},0)}}},[a,l,d,f]);const m=re(p=>{if(!n&&!i||f.paused)return;const g=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,v=document.activeElement;if(g&&v){const _=p.currentTarget,[C,y]=Bb(_);C&&y?!p.shiftKey&&v===y?(p.preventDefault(),n&&on(C,{select:!0})):p.shiftKey&&v===C&&(p.preventDefault(),n&&on(y,{select:!0})):v===_&&p.preventDefault()}},[n,i,f.paused]);return S(Se.div,{tabIndex:-1,...o,ref:h,onKeyDown:m})});_h.displayName=Ub;function Fb(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(on(i,{select:e}),document.activeElement!==n)return}function Bb(t){const e=kh(t),n=Ch(e,t),i=Ch(e.reverse(),t);return[n,i]}function kh(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Ch(t,e){for(const n of t)if(!jb(n,{upTo:e}))return n}function jb(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Vb(t){return t instanceof HTMLInputElement&&"select"in t}function on(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&Vb(t)&&e&&t.select()}}var Sh=$b();function $b(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=Th(t,e),t.unshift(e)},remove(e){var n;t=Th(t,e),(n=t[0])==null||n.resume()}}}function Th(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function qb(t){return t.filter(e=>e.tagName!=="A")}var ze=globalThis!=null&&globalThis.document?Rt:()=>{},Wb=Op.useId||(()=>{}),Hb=0;function da(t){const[e,n]=B(Wb());return ze(()=>{n(i=>i??String(Hb++))},[t]),e?`radix-${e}`:""}const zb=["top","right","bottom","left"],an=Math.min,Ge=Math.max,Or=Math.round,Ar=Math.floor,cn=t=>({x:t,y:t}),Gb={left:"right",right:"left",bottom:"top",top:"bottom"},Kb={start:"end",end:"start"};function ua(t,e,n){return Ge(t,an(e,n))}function $t(t,e){return typeof t=="function"?t(e):t}function qt(t){return t.split("-")[0]}function Xn(t){return t.split("-")[1]}function ha(t){return t==="x"?"y":"x"}function fa(t){return t==="y"?"height":"width"}function ln(t){return["top","bottom"].includes(qt(t))?"y":"x"}function pa(t){return ha(ln(t))}function Jb(t,e,n){n===void 0&&(n=!1);const i=Xn(t),r=pa(t),s=fa(r);let o=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Dr(o)),[o,Dr(o)]}function Yb(t){const e=Dr(t);return[ma(t),e,ma(e)]}function ma(t){return t.replace(/start|end/g,e=>Kb[e])}function Xb(t,e,n){const i=["left","right"],r=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:i:e?i:r;case"left":case"right":return e?s:o;default:return[]}}function Qb(t,e,n,i){const r=Xn(t);let s=Xb(qt(t),n==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(ma)))),s}function Dr(t){return t.replace(/left|right|bottom|top/g,e=>Gb[e])}function Zb(t){return{top:0,right:0,bottom:0,left:0,...t}}function wh(t){return typeof t!="number"?Zb(t):{top:t,right:t,bottom:t,left:t}}function Mr(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function Eh(t,e,n){let{reference:i,floating:r}=t;const s=ln(e),o=pa(e),a=fa(o),c=qt(e),l=s==="y",d=i.x+i.width/2-r.width/2,u=i.y+i.height/2-r.height/2,h=i[a]/2-r[a]/2;let f;switch(c){case"top":f={x:d,y:i.y-r.height};break;case"bottom":f={x:d,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:u};break;case"left":f={x:i.x-r.width,y:u};break;default:f={x:i.x,y:i.y}}switch(Xn(e)){case"start":f[o]-=h*(n&&l?-1:1);break;case"end":f[o]+=h*(n&&l?-1:1);break}return f}const e0=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:d,y:u}=Eh(l,i,c),h=i,f={},m=0;for(let p=0;p<a.length;p++){const{name:g,fn:v}=a[p],{x:_,y:C,data:y,reset:k}=await v({x:d,y:u,initialPlacement:i,placement:h,strategy:r,middlewareData:f,rects:l,platform:o,elements:{reference:t,floating:e}});d=_??d,u=C??u,f={...f,[g]:{...f[g],...y}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(h=k.placement),k.rects&&(l=k.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):k.rects),{x:d,y:u}=Eh(l,h,c)),p=-1)}return{x:d,y:u,placement:h,strategy:r,middlewareData:f}};async function Ii(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:f=0}=$t(e,t),m=wh(f),g=a[h?u==="floating"?"reference":"floating":u],v=Mr(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(g)))==null||n?g:g.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:d,strategy:c})),_=u==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,C=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),y=await(s.isElement==null?void 0:s.isElement(C))?await(s.getScale==null?void 0:s.getScale(C))||{x:1,y:1}:{x:1,y:1},k=Mr(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:C,strategy:c}):_);return{top:(v.top-k.top+m.top)/y.y,bottom:(k.bottom-v.bottom+m.bottom)/y.y,left:(v.left-k.left+m.left)/y.x,right:(k.right-v.right+m.right)/y.x}}const t0=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:i,placement:r,rects:s,platform:o,elements:a,middlewareData:c}=e,{element:l,padding:d=0}=$t(t,e)||{};if(l==null)return{};const u=wh(d),h={x:n,y:i},f=pa(r),m=fa(f),p=await o.getDimensions(l),g=f==="y",v=g?"top":"left",_=g?"bottom":"right",C=g?"clientHeight":"clientWidth",y=s.reference[m]+s.reference[f]-h[f]-s.floating[m],k=h[f]-s.reference[f],w=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l));let E=w?w[C]:0;(!E||!await(o.isElement==null?void 0:o.isElement(w)))&&(E=a.floating[C]||s.floating[m]);const I=y/2-k/2,R=E/2-p[m]/2-1,D=an(u[v],R),A=an(u[_],R),U=D,$=E-p[m]-A,H=E/2-p[m]/2+I,te=ua(U,H,$),q=!c.arrow&&Xn(r)!=null&&H!==te&&s.reference[m]/2-(H<U?D:A)-p[m]/2<0,Q=q?H<U?H-U:H-$:0;return{[f]:h[f]+Q,data:{[f]:te,centerOffset:H-te-Q,...q&&{alignmentOffset:Q}},reset:q}}}),n0=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...g}=$t(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const v=qt(r),_=ln(a),C=qt(a)===a,y=await(c.isRTL==null?void 0:c.isRTL(l.floating)),k=h||(C||!p?[Dr(a)]:Yb(a)),w=m!=="none";!h&&w&&k.push(...Qb(a,p,m,y));const E=[a,...k],I=await Ii(e,g),R=[];let D=((i=s.flip)==null?void 0:i.overflows)||[];if(d&&R.push(I[v]),u){const H=Jb(r,o,y);R.push(I[H[0]],I[H[1]])}if(D=[...D,{placement:r,overflows:R}],!R.every(H=>H<=0)){var A,U;const H=(((A=s.flip)==null?void 0:A.index)||0)+1,te=E[H];if(te)return{data:{index:H,overflows:D},reset:{placement:te}};let q=(U=D.filter(Q=>Q.overflows[0]<=0).sort((Q,j)=>Q.overflows[1]-j.overflows[1])[0])==null?void 0:U.placement;if(!q)switch(f){case"bestFit":{var $;const Q=($=D.filter(j=>{if(w){const ne=ln(j.placement);return ne===_||ne==="y"}return!0}).map(j=>[j.placement,j.overflows.filter(ne=>ne>0).reduce((ne,Te)=>ne+Te,0)]).sort((j,ne)=>j[1]-ne[1])[0])==null?void 0:$[0];Q&&(q=Q);break}case"initialPlacement":q=a;break}if(r!==q)return{reset:{placement:q}}}return{}}}};function Ph(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function xh(t){return zb.some(e=>t[e]>=0)}const i0=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:i="referenceHidden",...r}=$t(t,e);switch(i){case"referenceHidden":{const s=await Ii(e,{...r,elementContext:"reference"}),o=Ph(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:xh(o)}}}case"escaped":{const s=await Ii(e,{...r,altBoundary:!0}),o=Ph(s,n.floating);return{data:{escapedOffsets:o,escaped:xh(o)}}}default:return{}}}}};async function r0(t,e){const{placement:n,platform:i,elements:r}=t,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=qt(n),a=Xn(n),c=ln(n)==="y",l=["left","top"].includes(o)?-1:1,d=s&&c?-1:1,u=$t(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:m}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof m=="number"&&(f=a==="end"?m*-1:m),c?{x:f*d,y:h*l}:{x:h*l,y:f*d}}const s0=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:s,placement:o,middlewareData:a}=e,c=await r0(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+c.x,y:s+c.y,data:{...c,placement:o}}}}},o0=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:v,y:_}=g;return{x:v,y:_}}},...c}=$t(t,e),l={x:n,y:i},d=await Ii(e,c),u=ln(qt(r)),h=ha(u);let f=l[h],m=l[u];if(s){const g=h==="y"?"top":"left",v=h==="y"?"bottom":"right",_=f+d[g],C=f-d[v];f=ua(_,f,C)}if(o){const g=u==="y"?"top":"left",v=u==="y"?"bottom":"right",_=m+d[g],C=m-d[v];m=ua(_,m,C)}const p=a.fn({...e,[h]:f,[u]:m});return{...p,data:{x:p.x-n,y:p.y-i,enabled:{[h]:s,[u]:o}}}}}},a0=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:r,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=$t(t,e),d={x:n,y:i},u=ln(r),h=ha(u);let f=d[h],m=d[u];const p=$t(a,e),g=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(c){const C=h==="y"?"height":"width",y=s.reference[h]-s.floating[C]+g.mainAxis,k=s.reference[h]+s.reference[C]-g.mainAxis;f<y?f=y:f>k&&(f=k)}if(l){var v,_;const C=h==="y"?"width":"height",y=["top","left"].includes(qt(r)),k=s.reference[u]-s.floating[C]+(y&&((v=o.offset)==null?void 0:v[u])||0)+(y?0:g.crossAxis),w=s.reference[u]+s.reference[C]+(y?0:((_=o.offset)==null?void 0:_[u])||0)-(y?g.crossAxis:0);m<k?m=k:m>w&&(m=w)}return{[h]:f,[u]:m}}}},c0=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,i;const{placement:r,rects:s,platform:o,elements:a}=e,{apply:c=()=>{},...l}=$t(t,e),d=await Ii(e,l),u=qt(r),h=Xn(r),f=ln(r)==="y",{width:m,height:p}=s.floating;let g,v;u==="top"||u==="bottom"?(g=u,v=h===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(v=u,g=h==="end"?"top":"bottom");const _=p-d.top-d.bottom,C=m-d.left-d.right,y=an(p-d[g],_),k=an(m-d[v],C),w=!e.middlewareData.shift;let E=y,I=k;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(I=C),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(E=_),w&&!h){const D=Ge(d.left,0),A=Ge(d.right,0),U=Ge(d.top,0),$=Ge(d.bottom,0);f?I=m-2*(D!==0||A!==0?D+A:Ge(d.left,d.right)):E=p-2*(U!==0||$!==0?U+$:Ge(d.top,d.bottom))}await c({...e,availableWidth:I,availableHeight:E});const R=await o.getDimensions(a.floating);return m!==R.width||p!==R.height?{reset:{rects:!0}}:{}}}};function Nr(){return typeof window<"u"}function Qn(t){return Rh(t)?(t.nodeName||"").toLowerCase():"#document"}function Ke(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function kt(t){var e;return(e=(Rh(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Rh(t){return Nr()?t instanceof Node||t instanceof Ke(t).Node:!1}function ct(t){return Nr()?t instanceof Element||t instanceof Ke(t).Element:!1}function Ct(t){return Nr()?t instanceof HTMLElement||t instanceof Ke(t).HTMLElement:!1}function Ih(t){return!Nr()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ke(t).ShadowRoot}function Oi(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=lt(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(r)}function l0(t){return["table","td","th"].includes(Qn(t))}function Lr(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function ga(t){const e=va(),n=ct(t)?lt(t):t;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function d0(t){let e=dn(t);for(;Ct(e)&&!Zn(e);){if(ga(e))return e;if(Lr(e))return null;e=dn(e)}return null}function va(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Zn(t){return["html","body","#document"].includes(Qn(t))}function lt(t){return Ke(t).getComputedStyle(t)}function Ur(t){return ct(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function dn(t){if(Qn(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Ih(t)&&t.host||kt(t);return Ih(e)?e.host:e}function Oh(t){const e=dn(t);return Zn(e)?t.ownerDocument?t.ownerDocument.body:t.body:Ct(e)&&Oi(e)?e:Oh(e)}function Ai(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=Oh(t),s=r===((i=t.ownerDocument)==null?void 0:i.body),o=Ke(r);if(s){const a=ya(o);return e.concat(o,o.visualViewport||[],Oi(r)?r:[],a&&n?Ai(a):[])}return e.concat(r,Ai(r,[],n))}function ya(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Ah(t){const e=lt(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=Ct(t),s=r?t.offsetWidth:n,o=r?t.offsetHeight:i,a=Or(n)!==s||Or(i)!==o;return a&&(n=s,i=o),{width:n,height:i,$:a}}function ba(t){return ct(t)?t:t.contextElement}function ei(t){const e=ba(t);if(!Ct(e))return cn(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:s}=Ah(e);let o=(s?Or(n.width):n.width)/i,a=(s?Or(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const u0=cn(0);function Dh(t){const e=Ke(t);return!va()||!e.visualViewport?u0:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function h0(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Ke(t)?!1:e}function wn(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),s=ba(t);let o=cn(1);e&&(i?ct(i)&&(o=ei(i)):o=ei(t));const a=h0(s,n,i)?Dh(s):cn(0);let c=(r.left+a.x)/o.x,l=(r.top+a.y)/o.y,d=r.width/o.x,u=r.height/o.y;if(s){const h=Ke(s),f=i&&ct(i)?Ke(i):i;let m=h,p=ya(m);for(;p&&i&&f!==m;){const g=ei(p),v=p.getBoundingClientRect(),_=lt(p),C=v.left+(p.clientLeft+parseFloat(_.paddingLeft))*g.x,y=v.top+(p.clientTop+parseFloat(_.paddingTop))*g.y;c*=g.x,l*=g.y,d*=g.x,u*=g.y,c+=C,l+=y,m=Ke(p),p=ya(m)}}return Mr({width:d,height:u,x:c,y:l})}function f0(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const s=r==="fixed",o=kt(i),a=e?Lr(e.floating):!1;if(i===o||a&&s)return n;let c={scrollLeft:0,scrollTop:0},l=cn(1);const d=cn(0),u=Ct(i);if((u||!u&&!s)&&((Qn(i)!=="body"||Oi(o))&&(c=Ur(i)),Ct(i))){const h=wn(i);l=ei(i),d.x=h.x+i.clientLeft,d.y=h.y+i.clientTop}return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+d.x,y:n.y*l.y-c.scrollTop*l.y+d.y}}function p0(t){return Array.from(t.getClientRects())}function _a(t,e){const n=Ur(t).scrollLeft;return e?e.left+n:wn(kt(t)).left+n}function m0(t){const e=kt(t),n=Ur(t),i=t.ownerDocument.body,r=Ge(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=Ge(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-n.scrollLeft+_a(t);const a=-n.scrollTop;return lt(i).direction==="rtl"&&(o+=Ge(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}function g0(t,e){const n=Ke(t),i=kt(t),r=n.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,c=0;if(r){s=r.width,o=r.height;const l=va();(!l||l&&e==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}return{width:s,height:o,x:a,y:c}}function v0(t,e){const n=wn(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,s=Ct(t)?ei(t):cn(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,c=r*s.x,l=i*s.y;return{width:o,height:a,x:c,y:l}}function Mh(t,e,n){let i;if(e==="viewport")i=g0(t,n);else if(e==="document")i=m0(kt(t));else if(ct(e))i=v0(e,n);else{const r=Dh(t);i={...e,x:e.x-r.x,y:e.y-r.y}}return Mr(i)}function Nh(t,e){const n=dn(t);return n===e||!ct(n)||Zn(n)?!1:lt(n).position==="fixed"||Nh(n,e)}function y0(t,e){const n=e.get(t);if(n)return n;let i=Ai(t,[],!1).filter(a=>ct(a)&&Qn(a)!=="body"),r=null;const s=lt(t).position==="fixed";let o=s?dn(t):t;for(;ct(o)&&!Zn(o);){const a=lt(o),c=ga(o);!c&&a.position==="fixed"&&(r=null),(s?!c&&!r:!c&&a.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||Oi(o)&&!c&&Nh(t,o))?i=i.filter(d=>d!==o):r=a,o=dn(o)}return e.set(t,i),i}function b0(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const o=[...n==="clippingAncestors"?Lr(e)?[]:y0(e,this._c):[].concat(n),i],a=o[0],c=o.reduce((l,d)=>{const u=Mh(e,d,r);return l.top=Ge(u.top,l.top),l.right=an(u.right,l.right),l.bottom=an(u.bottom,l.bottom),l.left=Ge(u.left,l.left),l},Mh(e,a,r));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function _0(t){const{width:e,height:n}=Ah(t);return{width:e,height:n}}function k0(t,e,n){const i=Ct(e),r=kt(e),s=n==="fixed",o=wn(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=cn(0);if(i||!i&&!s)if((Qn(e)!=="body"||Oi(r))&&(a=Ur(e)),i){const f=wn(e,!0,s,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else r&&(c.x=_a(r));let l=0,d=0;if(r&&!i&&!s){const f=r.getBoundingClientRect();d=f.top+a.scrollTop,l=f.left+a.scrollLeft-_a(r,f)}const u=o.left+a.scrollLeft-c.x-l,h=o.top+a.scrollTop-c.y-d;return{x:u,y:h,width:o.width,height:o.height}}function ka(t){return lt(t).position==="static"}function Lh(t,e){if(!Ct(t)||lt(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return kt(t)===n&&(n=n.ownerDocument.body),n}function Uh(t,e){const n=Ke(t);if(Lr(t))return n;if(!Ct(t)){let r=dn(t);for(;r&&!Zn(r);){if(ct(r)&&!ka(r))return r;r=dn(r)}return n}let i=Lh(t,e);for(;i&&l0(i)&&ka(i);)i=Lh(i,e);return i&&Zn(i)&&ka(i)&&!ga(i)?n:i||d0(t)||n}const C0=async function(t){const e=this.getOffsetParent||Uh,n=this.getDimensions,i=await n(t.floating);return{reference:k0(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function S0(t){return lt(t).direction==="rtl"}const T0={convertOffsetParentRelativeRectToViewportRelativeRect:f0,getDocumentElement:kt,getClippingRect:b0,getOffsetParent:Uh,getElementRects:C0,getClientRects:p0,getDimensions:_0,getScale:ei,isElement:ct,isRTL:S0};function w0(t,e){let n=null,i;const r=kt(t);function s(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const{left:l,top:d,width:u,height:h}=t.getBoundingClientRect();if(a||e(),!u||!h)return;const f=Ar(d),m=Ar(r.clientWidth-(l+u)),p=Ar(r.clientHeight-(d+h)),g=Ar(l),_={rootMargin:-f+"px "+-m+"px "+-p+"px "+-g+"px",threshold:Ge(0,an(1,c))||1};let C=!0;function y(k){const w=k[0].intersectionRatio;if(w!==c){if(!C)return o();w?o(!1,w):i=setTimeout(()=>{o(!1,1e-7)},1e3)}C=!1}try{n=new IntersectionObserver(y,{..._,root:r.ownerDocument})}catch{n=new IntersectionObserver(y,_)}n.observe(t)}return o(!0),s}function E0(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=i,l=ba(t),d=r||s?[...l?Ai(l):[],...Ai(e)]:[];d.forEach(v=>{r&&v.addEventListener("scroll",n,{passive:!0}),s&&v.addEventListener("resize",n)});const u=l&&a?w0(l,n):null;let h=-1,f=null;o&&(f=new ResizeObserver(v=>{let[_]=v;_&&_.target===l&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var C;(C=f)==null||C.observe(e)})),n()}),l&&!c&&f.observe(l),f.observe(e));let m,p=c?wn(t):null;c&&g();function g(){const v=wn(t);p&&(v.x!==p.x||v.y!==p.y||v.width!==p.width||v.height!==p.height)&&n(),p=v,m=requestAnimationFrame(g)}return n(),()=>{var v;d.forEach(_=>{r&&_.removeEventListener("scroll",n),s&&_.removeEventListener("resize",n)}),u==null||u(),(v=f)==null||v.disconnect(),f=null,c&&cancelAnimationFrame(m)}}const P0=s0,x0=o0,R0=n0,I0=c0,O0=i0,Fh=t0,A0=a0,D0=(t,e,n)=>{const i=new Map,r={platform:T0,...n},s={...r.platform,_c:i};return e0(t,e,{...r,platform:s})};var Fr=typeof document<"u"?Rt:K;function Br(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,i,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(i=n;i--!==0;)if(!Br(t[i],e[i]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=n;i--!==0;){const s=r[i];if(!(s==="_owner"&&t.$$typeof)&&!Br(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Bh(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function jh(t,e){const n=Bh(t);return Math.round(e*n)/n}function Ca(t){const e=W(t);return Fr(()=>{e.current=t}),e}function M0(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:i=[],platform:r,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[d,u]=B({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=B(i);Br(h,i)||f(i);const[m,p]=B(null),[g,v]=B(null),_=re(j=>{j!==w.current&&(w.current=j,p(j))},[]),C=re(j=>{j!==E.current&&(E.current=j,v(j))},[]),y=s||m,k=o||g,w=W(null),E=W(null),I=W(d),R=c!=null,D=Ca(c),A=Ca(r),U=Ca(l),$=re(()=>{if(!w.current||!E.current)return;const j={placement:e,strategy:n,middleware:h};A.current&&(j.platform=A.current),D0(w.current,E.current,j).then(ne=>{const Te={...ne,isPositioned:U.current!==!1};H.current&&!Br(I.current,Te)&&(I.current=Te,Ji(()=>{u(Te)}))})},[h,e,n,A,U]);Fr(()=>{l===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,u(j=>({...j,isPositioned:!1})))},[l]);const H=W(!1);Fr(()=>(H.current=!0,()=>{H.current=!1}),[]),Fr(()=>{if(y&&(w.current=y),k&&(E.current=k),y&&k){if(D.current)return D.current(y,k,$);$()}},[y,k,$,D,R]);const te=ie(()=>({reference:w,floating:E,setReference:_,setFloating:C}),[_,C]),q=ie(()=>({reference:y,floating:k}),[y,k]),Q=ie(()=>{const j={position:n,left:0,top:0};if(!q.floating)return j;const ne=jh(q.floating,d.x),Te=jh(q.floating,d.y);return a?{...j,transform:"translate("+ne+"px, "+Te+"px)",...Bh(q.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ne,top:Te}},[n,a,q.floating,d.x,d.y]);return ie(()=>({...d,update:$,refs:te,elements:q,floatingStyles:Q}),[d,$,te,q,Q])}const N0=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:r}=typeof t=="function"?t(n):t;return i&&e(i)?i.current!=null?Fh({element:i.current,padding:r}).fn(n):{}:i?Fh({element:i,padding:r}).fn(n):{}}}},L0=(t,e)=>({...P0(t),options:[t,e]}),U0=(t,e)=>({...x0(t),options:[t,e]}),F0=(t,e)=>({...A0(t),options:[t,e]}),B0=(t,e)=>({...R0(t),options:[t,e]}),j0=(t,e)=>({...I0(t),options:[t,e]}),V0=(t,e)=>({...O0(t),options:[t,e]}),$0=(t,e)=>({...N0(t),options:[t,e]});var q0="Arrow",Vh=Y((t,e)=>{const{children:n,width:i=10,height:r=5,...s}=t;return S(Se.svg,{...s,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:S("polygon",{points:"0,0 30,0 15,10"})})});Vh.displayName=q0;var W0=Vh;function H0(t){const[e,n]=B(void 0);return ze(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),e}var Sa="Popper",[$h,qh]=uh(Sa),[z0,Wh]=$h(Sa),Hh=t=>{const{__scopePopper:e,children:n}=t,[i,r]=B(null);return S(z0,{scope:e,anchor:i,onAnchorChange:r,children:n})};Hh.displayName=Sa;var zh="PopperAnchor",Gh=Y((t,e)=>{const{__scopePopper:n,virtualRef:i,...r}=t,s=Wh(zh,n),o=W(null),a=Me(e,o);return K(()=>{s.onAnchorChange((i==null?void 0:i.current)||o.current)}),i?null:S(Se.div,{...r,ref:a})});Gh.displayName=zh;var Ta="PopperContent",[G0,K0]=$h(Ta),Kh=Y((t,e)=>{var z,fe,Le,ue,oe,ae;const{__scopePopper:n,side:i="bottom",sideOffset:r=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:d=0,sticky:u="partial",hideWhenDetached:h=!1,updatePositionStrategy:f="optimized",onPlaced:m,...p}=t,g=Wh(Ta,n),[v,_]=B(null),C=Me(e,Xe=>_(Xe)),[y,k]=B(null),w=H0(y),E=(w==null?void 0:w.width)??0,I=(w==null?void 0:w.height)??0,R=i+(s!=="center"?"-"+s:""),D=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},A=Array.isArray(l)?l:[l],U=A.length>0,$={padding:D,boundary:A.filter(Y0),altBoundary:U},{refs:H,floatingStyles:te,placement:q,isPositioned:Q,middlewareData:j}=M0({strategy:"fixed",placement:R,whileElementsMounted:(...Xe)=>E0(...Xe,{animationFrame:f==="always"}),elements:{reference:g.anchor},middleware:[L0({mainAxis:r+I,alignmentAxis:o}),c&&U0({mainAxis:!0,crossAxis:!1,limiter:u==="partial"?F0():void 0,...$}),c&&B0({...$}),j0({...$,apply:({elements:Xe,rects:Et,availableWidth:Ni,availableHeight:Li})=>{const{width:Ui,height:Nk}=Et.reference,Xr=Xe.floating.style;Xr.setProperty("--radix-popper-available-width",`${Ni}px`),Xr.setProperty("--radix-popper-available-height",`${Li}px`),Xr.setProperty("--radix-popper-anchor-width",`${Ui}px`),Xr.setProperty("--radix-popper-anchor-height",`${Nk}px`)}}),y&&$0({element:y,padding:a}),X0({arrowWidth:E,arrowHeight:I}),h&&V0({strategy:"referenceHidden",...$})]}),[ne,Te]=Xh(q),we=Vt(m);ze(()=>{Q&&(we==null||we())},[Q,we]);const Je=(z=j.arrow)==null?void 0:z.x,wt=(fe=j.arrow)==null?void 0:fe.y,Ne=((Le=j.arrow)==null?void 0:Le.centerOffset)!==0,[Ye,Pn]=B();return ze(()=>{v&&Pn(window.getComputedStyle(v).zIndex)},[v]),S("div",{ref:H.setFloating,"data-radix-popper-content-wrapper":"",style:{...te,transform:Q?te.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ye,"--radix-popper-transform-origin":[(ue=j.transformOrigin)==null?void 0:ue.x,(oe=j.transformOrigin)==null?void 0:oe.y].join(" "),...((ae=j.hide)==null?void 0:ae.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:S(G0,{scope:n,placedSide:ne,onArrowChange:k,arrowX:Je,arrowY:wt,shouldHideArrow:Ne,children:S(Se.div,{"data-side":ne,"data-align":Te,...p,ref:C,style:{...p.style,animation:Q?void 0:"none"}})})})});Kh.displayName=Ta;var Jh="PopperArrow",J0={top:"bottom",right:"left",bottom:"top",left:"right"},Yh=Y(function(e,n){const{__scopePopper:i,...r}=e,s=K0(Jh,i),o=J0[s.placedSide];return S("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:S(W0,{...r,ref:n,style:{...r.style,display:"block"}})})});Yh.displayName=Jh;function Y0(t){return t!==null}var X0=t=>({name:"transformOrigin",options:t,fn(e){var g,v,_;const{placement:n,rects:i,middlewareData:r}=e,o=((g=r.arrow)==null?void 0:g.centerOffset)!==0,a=o?0:t.arrowWidth,c=o?0:t.arrowHeight,[l,d]=Xh(n),u={start:"0%",center:"50%",end:"100%"}[d],h=(((v=r.arrow)==null?void 0:v.x)??0)+a/2,f=(((_=r.arrow)==null?void 0:_.y)??0)+c/2;let m="",p="";return l==="bottom"?(m=o?u:`${h}px`,p=`${-c}px`):l==="top"?(m=o?u:`${h}px`,p=`${i.floating.height+c}px`):l==="right"?(m=`${-c}px`,p=o?u:`${f}px`):l==="left"&&(m=`${i.floating.width+c}px`,p=o?u:`${f}px`),{data:{x:m,y:p}}}});function Xh(t){const[e,n="center"]=t.split("-");return[e,n]}var Q0=Hh,Z0=Gh,e_=Kh,t_=Yh,n_="Portal",Qh=Y((t,e)=>{var a;const{container:n,...i}=t,[r,s]=B(!1);ze(()=>s(!0),[]);const o=n||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?Dt.createPortal(S(Se.div,{...i,ref:e}),o):null});Qh.displayName=n_;function Zh({prop:t,defaultProp:e,onChange:n=()=>{}}){const[i,r]=i_({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:i,a=Vt(n),c=re(l=>{if(s){const u=typeof l=="function"?l(t):l;u!==t&&a(u)}else r(l)},[s,t,r,a]);return[o,c]}function i_({defaultProp:t,onChange:e}){const n=B(t),[i]=n,r=W(i),s=Vt(e);return K(()=>{r.current!==i&&(s(i),r.current=i)},[i,r,s]),n}function r_(t){const e=W({value:t,previous:t});return ie(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var s_="VisuallyHidden",ef=Y((t,e)=>S(Se.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));ef.displayName=s_;var o_=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},ti=new WeakMap,jr=new WeakMap,Vr={},wa=0,tf=function(t){return t&&(t.host||tf(t.parentNode))},a_=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=tf(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},c_=function(t,e,n,i){var r=a_(e,Array.isArray(t)?t:[t]);Vr[n]||(Vr[n]=new WeakMap);var s=Vr[n],o=[],a=new Set,c=new Set(r),l=function(u){!u||a.has(u)||(a.add(u),l(u.parentNode))};r.forEach(l);var d=function(u){!u||c.has(u)||Array.prototype.forEach.call(u.children,function(h){if(a.has(h))d(h);else{var f=h.getAttribute(i),m=f!==null&&f!=="false",p=(ti.get(h)||0)+1,g=(s.get(h)||0)+1;ti.set(h,p),s.set(h,g),o.push(h),p===1&&m&&jr.set(h,!0),g===1&&h.setAttribute(n,"true"),m||h.setAttribute(i,"true")}})};return d(e),a.clear(),wa++,function(){o.forEach(function(u){var h=ti.get(u)-1,f=s.get(u)-1;ti.set(u,h),s.set(u,f),h||(jr.has(u)||u.removeAttribute(i),jr.delete(u)),f||u.removeAttribute(n)}),wa--,wa||(ti=new WeakMap,ti=new WeakMap,jr=new WeakMap,Vr={})}},l_=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=o_(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live]"))),c_(i,r,n,"aria-hidden")):function(){return null}},St=function(){return St=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},St.apply(this,arguments)};function nf(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function d_(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var $r="right-scroll-bar-position",qr="width-before-scroll-bar",u_="with-scroll-bars-hidden",h_="--removed-body-scroll-bar-size";function Ea(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function f_(t,e){var n=B(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var rf=new WeakMap;function p_(t,e){var n=f_(null,function(i){return t.forEach(function(r){return Ea(r,i)})});return Rt(function(){var i=rf.get(n);if(i){var r=new Set(i),s=new Set(t),o=n.current;r.forEach(function(a){s.has(a)||Ea(a,null)}),s.forEach(function(a){r.has(a)||Ea(a,o)})}rf.set(n,t)},[t]),n}function m_(t){return t}function g_(t,e){e===void 0&&(e=m_);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var o=e(s,i);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(i=!0;n.length;){var o=n;n=[],o.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){i=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(s),o=n}var c=function(){var d=o;o=[],d.forEach(s)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(d){o.push(d),l()},filter:function(d){return o=o.filter(d),n}}}};return r}function v_(t){t===void 0&&(t={});var e=g_(null);return e.options=St({async:!0,ssr:!1},t),e}var sf=function(t){var e=t.sideCar,n=nf(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return pe(i,St({},n))};sf.isSideCarExport=!0;function y_(t,e){return t.useMedium(e),sf}var of=v_(),Pa=function(){},Wr=Y(function(t,e){var n=W(null),i=B({onScrollCapture:Pa,onWheelCapture:Pa,onTouchMoveCapture:Pa}),r=i[0],s=i[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,u=t.shards,h=t.sideCar,f=t.noIsolation,m=t.inert,p=t.allowPinchZoom,g=t.as,v=g===void 0?"div":g,_=t.gapMode,C=nf(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),y=h,k=p_([n,e]),w=St(St({},C),r);return pe(Ee,null,d&&pe(y,{sideCar:of,removeScrollBar:l,shards:u,noIsolation:f,inert:m,setCallbacks:s,allowPinchZoom:!!p,lockRef:n,gapMode:_}),o?hi(Kt.only(a),St(St({},w),{ref:k})):pe(v,St({},w,{className:c,ref:k}),a))});Wr.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Wr.classNames={fullWidth:qr,zeroRight:$r};var b_=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function __(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=b_();return e&&t.setAttribute("nonce",e),t}function k_(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function C_(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var S_=function(){var t=0,e=null;return{add:function(n){t==0&&(e=__())&&(k_(e,n),C_(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},T_=function(){var t=S_();return function(e,n){K(function(){return t.add(e),function(){t.remove()}},[e&&n])}},af=function(){var t=T_(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},w_={left:0,top:0,right:0,gap:0},xa=function(t){return parseInt(t||"",10)||0},E_=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[xa(n),xa(i),xa(r)]},P_=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return w_;var e=E_(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},x_=af(),ni="data-scroll-locked",R_=function(t,e,n,i){var r=t.left,s=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(u_,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(a,"px ").concat(i,`;
  }
  body[`).concat(ni,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat($r,` {
    right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(qr,` {
    margin-right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat($r," .").concat($r,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(qr," .").concat(qr,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(ni,`] {
    `).concat(h_,": ").concat(a,`px;
  }
`)},cf=function(){var t=parseInt(document.body.getAttribute(ni)||"0",10);return isFinite(t)?t:0},I_=function(){K(function(){return document.body.setAttribute(ni,(cf()+1).toString()),function(){var t=cf()-1;t<=0?document.body.removeAttribute(ni):document.body.setAttribute(ni,t.toString())}},[])},O_=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;I_();var s=ie(function(){return P_(r)},[r]);return pe(x_,{styles:R_(s,!e,r,n?"":"!important")})},Ra=!1;if(typeof window<"u")try{var Hr=Object.defineProperty({},"passive",{get:function(){return Ra=!0,!0}});window.addEventListener("test",Hr,Hr),window.removeEventListener("test",Hr,Hr)}catch{Ra=!1}var ii=Ra?{passive:!1}:!1,A_=function(t){return t.tagName==="TEXTAREA"},lf=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!A_(t)&&n[e]==="visible")},D_=function(t){return lf(t,"overflowY")},M_=function(t){return lf(t,"overflowX")},df=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=uf(t,i);if(r){var s=hf(t,i),o=s[1],a=s[2];if(o>a)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},N_=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},L_=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},uf=function(t,e){return t==="v"?D_(e):M_(e)},hf=function(t,e){return t==="v"?N_(e):L_(e)},U_=function(t,e){return t==="h"&&e==="rtl"?-1:1},F_=function(t,e,n,i,r){var s=U_(t,window.getComputedStyle(e).direction),o=s*i,a=n.target,c=e.contains(a),l=!1,d=o>0,u=0,h=0;do{var f=hf(t,a),m=f[0],p=f[1],g=f[2],v=p-g-s*m;(m||v)&&uf(t,a)&&(u+=v,h+=m),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&Math.abs(u)<1||!d&&Math.abs(h)<1)&&(l=!0),l},zr=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},ff=function(t){return[t.deltaX,t.deltaY]},pf=function(t){return t&&"current"in t?t.current:t},B_=function(t,e){return t[0]===e[0]&&t[1]===e[1]},j_=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},V_=0,ri=[];function $_(t){var e=W([]),n=W([0,0]),i=W(),r=B(V_++)[0],s=B(af)[0],o=W(t);K(function(){o.current=t},[t]),K(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var p=d_([t.lockRef.current],(t.shards||[]).map(pf),!0).filter(Boolean);return p.forEach(function(g){return g.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),p.forEach(function(g){return g.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var a=re(function(p,g){if("touches"in p&&p.touches.length===2||p.type==="wheel"&&p.ctrlKey)return!o.current.allowPinchZoom;var v=zr(p),_=n.current,C="deltaX"in p?p.deltaX:_[0]-v[0],y="deltaY"in p?p.deltaY:_[1]-v[1],k,w=p.target,E=Math.abs(C)>Math.abs(y)?"h":"v";if("touches"in p&&E==="h"&&w.type==="range")return!1;var I=df(E,w);if(!I)return!0;if(I?k=E:(k=E==="v"?"h":"v",I=df(E,w)),!I)return!1;if(!i.current&&"changedTouches"in p&&(C||y)&&(i.current=k),!k)return!0;var R=i.current||k;return F_(R,g,p,R==="h"?C:y)},[]),c=re(function(p){var g=p;if(!(!ri.length||ri[ri.length-1]!==s)){var v="deltaY"in g?ff(g):zr(g),_=e.current.filter(function(k){return k.name===g.type&&(k.target===g.target||g.target===k.shadowParent)&&B_(k.delta,v)})[0];if(_&&_.should){g.cancelable&&g.preventDefault();return}if(!_){var C=(o.current.shards||[]).map(pf).filter(Boolean).filter(function(k){return k.contains(g.target)}),y=C.length>0?a(g,C[0]):!o.current.noIsolation;y&&g.cancelable&&g.preventDefault()}}},[]),l=re(function(p,g,v,_){var C={name:p,delta:g,target:v,should:_,shadowParent:q_(v)};e.current.push(C),setTimeout(function(){e.current=e.current.filter(function(y){return y!==C})},1)},[]),d=re(function(p){n.current=zr(p),i.current=void 0},[]),u=re(function(p){l(p.type,ff(p),p.target,a(p,t.lockRef.current))},[]),h=re(function(p){l(p.type,zr(p),p.target,a(p,t.lockRef.current))},[]);K(function(){return ri.push(s),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",c,ii),document.addEventListener("touchmove",c,ii),document.addEventListener("touchstart",d,ii),function(){ri=ri.filter(function(p){return p!==s}),document.removeEventListener("wheel",c,ii),document.removeEventListener("touchmove",c,ii),document.removeEventListener("touchstart",d,ii)}},[]);var f=t.removeScrollBar,m=t.inert;return pe(Ee,null,m?pe(s,{styles:j_(r)}):null,f?pe(O_,{gapMode:t.gapMode}):null)}function q_(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const W_=y_(of,$_);var mf=Y(function(t,e){return pe(Wr,St({},t,{ref:e,sideCar:W_}))});mf.classNames=Wr.classNames;var H_=[" ","Enter","ArrowUp","ArrowDown"],z_=[" ","Enter"],Di="Select",[Gr,Kr,G_]=kb(Di),[si,xC]=Cb(Di,[G_,qh]),Jr=qh(),[K_,un]=si(Di),[J_,Y_]=si(Di),gf=t=>{const{__scopeSelect:e,children:n,open:i,defaultOpen:r,onOpenChange:s,value:o,defaultValue:a,onValueChange:c,dir:l,name:d,autoComplete:u,disabled:h,required:f,form:m}=t,p=Jr(e),[g,v]=B(null),[_,C]=B(null),[y,k]=B(!1),w=wb(l),[E=!1,I]=Zh({prop:i,defaultProp:r,onChange:s}),[R,D]=Zh({prop:o,defaultProp:a,onChange:c}),A=W(null),U=g?m||!!g.closest("form"):!0,[$,H]=B(new Set),te=Array.from($).map(q=>q.props.value).join(";");return S(Q0,{...p,children:S(K_,{required:f,scope:e,trigger:g,onTriggerChange:v,valueNode:_,onValueNodeChange:C,valueNodeHasChildren:y,onValueNodeHasChildrenChange:k,contentId:da(),value:R,onValueChange:D,open:E,onOpenChange:I,dir:w,triggerPointerDownPosRef:A,disabled:h,children:[S(Gr.Provider,{scope:e,children:S(J_,{scope:t.__scopeSelect,onNativeOptionAdd:re(q=>{H(Q=>new Set(Q).add(q))},[]),onNativeOptionRemove:re(q=>{H(Q=>{const j=new Set(Q);return j.delete(q),j})},[]),children:n})}),U?S(Ff,{"aria-hidden":!0,required:f,tabIndex:-1,name:d,autoComplete:u,value:R,onChange:q=>D(q.target.value),disabled:h,form:m,children:[R===void 0?S("option",{value:""}):null,Array.from($)]},te):null]})})};gf.displayName=Di;var vf="SelectTrigger",yf=Y((t,e)=>{const{__scopeSelect:n,disabled:i=!1,...r}=t,s=Jr(n),o=un(vf,n),a=o.disabled||i,c=Me(e,o.onTriggerChange),l=Kr(n),d=W("touch"),[u,h,f]=Bf(p=>{const g=l().filter(C=>!C.disabled),v=g.find(C=>C.value===o.value),_=jf(g,p,v);_!==void 0&&o.onValueChange(_.value)}),m=p=>{a||(o.onOpenChange(!0),f()),p&&(o.triggerPointerDownPosRef.current={x:Math.round(p.pageX),y:Math.round(p.pageY)})};return S(Z0,{asChild:!0,...s,children:S(Se.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":Uf(o.value)?"":void 0,...r,ref:c,onClick:Ce(r.onClick,p=>{p.currentTarget.focus(),d.current!=="mouse"&&m(p)}),onPointerDown:Ce(r.onPointerDown,p=>{d.current=p.pointerType;const g=p.target;g.hasPointerCapture(p.pointerId)&&g.releasePointerCapture(p.pointerId),p.button===0&&p.ctrlKey===!1&&p.pointerType==="mouse"&&(m(p),p.preventDefault())}),onKeyDown:Ce(r.onKeyDown,p=>{const g=u.current!=="";!(p.ctrlKey||p.altKey||p.metaKey)&&p.key.length===1&&h(p.key),!(g&&p.key===" ")&&H_.includes(p.key)&&(m(),p.preventDefault())})})})});yf.displayName=vf;var bf="SelectValue",X_=Y((t,e)=>{const{__scopeSelect:n,className:i,style:r,children:s,placeholder:o="",...a}=t,c=un(bf,n),{onValueNodeHasChildrenChange:l}=c,d=s!==void 0,u=Me(e,c.onValueNodeChange);return ze(()=>{l(d)},[l,d]),S(Se.span,{...a,ref:u,style:{pointerEvents:"none"},children:Uf(c.value)?S(Ee,{children:o}):s})});X_.displayName=bf;var Q_="SelectIcon",_f=Y((t,e)=>{const{__scopeSelect:n,children:i,...r}=t;return S(Se.span,{"aria-hidden":!0,...r,ref:e,children:i||"▼"})});_f.displayName=Q_;var Z_="SelectPortal",kf=t=>S(Qh,{asChild:!0,...t});kf.displayName=Z_;var En="SelectContent",Cf=Y((t,e)=>{const n=un(En,t.__scopeSelect),[i,r]=B();if(ze(()=>{r(new DocumentFragment)},[]),!n.open){const s=i;return s?Ki(S(Sf,{scope:t.__scopeSelect,children:S(Gr.Slot,{scope:t.__scopeSelect,children:S("div",{children:t.children})})}),s):null}return S(Tf,{...t,ref:e})});Cf.displayName=En;var dt=10,[Sf,hn]=si(En),ek="SelectContentImpl",Tf=Y((t,e)=>{const{__scopeSelect:n,position:i="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:s,onPointerDownOutside:o,side:a,sideOffset:c,align:l,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:f,sticky:m,hideWhenDetached:p,avoidCollisions:g,...v}=t,_=un(En,n),[C,y]=B(null),[k,w]=B(null),E=Me(e,z=>y(z)),[I,R]=B(null),[D,A]=B(null),U=Kr(n),[$,H]=B(!1),te=W(!1);K(()=>{if(C)return l_(C)},[C]),Lb();const q=re(z=>{const[fe,...Le]=U().map(ae=>ae.ref.current),[ue]=Le.slice(-1),oe=document.activeElement;for(const ae of z)if(ae===oe||(ae==null||ae.scrollIntoView({block:"nearest"}),ae===fe&&k&&(k.scrollTop=0),ae===ue&&k&&(k.scrollTop=k.scrollHeight),ae==null||ae.focus(),document.activeElement!==oe))return},[U,k]),Q=re(()=>q([I,C]),[q,I,C]);K(()=>{$&&Q()},[$,Q]);const{onOpenChange:j,triggerPointerDownPosRef:ne}=_;K(()=>{if(C){let z={x:0,y:0};const fe=ue=>{var oe,ae;z={x:Math.abs(Math.round(ue.pageX)-(((oe=ne.current)==null?void 0:oe.x)??0)),y:Math.abs(Math.round(ue.pageY)-(((ae=ne.current)==null?void 0:ae.y)??0))}},Le=ue=>{z.x<=10&&z.y<=10?ue.preventDefault():C.contains(ue.target)||j(!1),document.removeEventListener("pointermove",fe),ne.current=null};return ne.current!==null&&(document.addEventListener("pointermove",fe),document.addEventListener("pointerup",Le,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",fe),document.removeEventListener("pointerup",Le,{capture:!0})}}},[C,j,ne]),K(()=>{const z=()=>j(!1);return window.addEventListener("blur",z),window.addEventListener("resize",z),()=>{window.removeEventListener("blur",z),window.removeEventListener("resize",z)}},[j]);const[Te,we]=Bf(z=>{const fe=U().filter(oe=>!oe.disabled),Le=fe.find(oe=>oe.ref.current===document.activeElement),ue=jf(fe,z,Le);ue&&setTimeout(()=>ue.ref.current.focus())}),Je=re((z,fe,Le)=>{const ue=!te.current&&!Le;(_.value!==void 0&&_.value===fe||ue)&&(R(z),ue&&(te.current=!0))},[_.value]),wt=re(()=>C==null?void 0:C.focus(),[C]),Ne=re((z,fe,Le)=>{const ue=!te.current&&!Le;(_.value!==void 0&&_.value===fe||ue)&&A(z)},[_.value]),Ye=i==="popper"?Ia:wf,Pn=Ye===Ia?{side:a,sideOffset:c,align:l,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:f,sticky:m,hideWhenDetached:p,avoidCollisions:g}:{};return S(Sf,{scope:n,content:C,viewport:k,onViewportChange:w,itemRefCallback:Je,selectedItem:I,onItemLeave:wt,itemTextRefCallback:Ne,focusSelectedItem:Q,selectedItemText:D,position:i,isPositioned:$,searchRef:Te,children:S(mf,{as:Ri,allowPinchZoom:!0,children:S(_h,{asChild:!0,trapped:_.open,onMountAutoFocus:z=>{z.preventDefault()},onUnmountAutoFocus:Ce(r,z=>{var fe;(fe=_.trigger)==null||fe.focus({preventScroll:!0}),z.preventDefault()}),children:S(mh,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:z=>z.preventDefault(),onDismiss:()=>_.onOpenChange(!1),children:S(Ye,{role:"listbox",id:_.contentId,"data-state":_.open?"open":"closed",dir:_.dir,onContextMenu:z=>z.preventDefault(),...v,...Pn,onPlaced:()=>H(!0),ref:E,style:{display:"flex",flexDirection:"column",outline:"none",...v.style},onKeyDown:Ce(v.onKeyDown,z=>{const fe=z.ctrlKey||z.altKey||z.metaKey;if(z.key==="Tab"&&z.preventDefault(),!fe&&z.key.length===1&&we(z.key),["ArrowUp","ArrowDown","Home","End"].includes(z.key)){let ue=U().filter(oe=>!oe.disabled).map(oe=>oe.ref.current);if(["ArrowUp","End"].includes(z.key)&&(ue=ue.slice().reverse()),["ArrowUp","ArrowDown"].includes(z.key)){const oe=z.target,ae=ue.indexOf(oe);ue=ue.slice(ae+1)}setTimeout(()=>q(ue)),z.preventDefault()}})})})})})})});Tf.displayName=ek;var tk="SelectItemAlignedPosition",wf=Y((t,e)=>{const{__scopeSelect:n,onPlaced:i,...r}=t,s=un(En,n),o=hn(En,n),[a,c]=B(null),[l,d]=B(null),u=Me(e,E=>d(E)),h=Kr(n),f=W(!1),m=W(!0),{viewport:p,selectedItem:g,selectedItemText:v,focusSelectedItem:_}=o,C=re(()=>{if(s.trigger&&s.valueNode&&a&&l&&p&&g&&v){const E=s.trigger.getBoundingClientRect(),I=l.getBoundingClientRect(),R=s.valueNode.getBoundingClientRect(),D=v.getBoundingClientRect();if(s.dir!=="rtl"){const oe=D.left-I.left,ae=R.left-oe,Xe=E.left-ae,Et=E.width+Xe,Ni=Math.max(Et,I.width),Li=window.innerWidth-dt,Ui=dh(ae,[dt,Math.max(dt,Li-Ni)]);a.style.minWidth=Et+"px",a.style.left=Ui+"px"}else{const oe=I.right-D.right,ae=window.innerWidth-R.right-oe,Xe=window.innerWidth-E.right-ae,Et=E.width+Xe,Ni=Math.max(Et,I.width),Li=window.innerWidth-dt,Ui=dh(ae,[dt,Math.max(dt,Li-Ni)]);a.style.minWidth=Et+"px",a.style.right=Ui+"px"}const A=h(),U=window.innerHeight-dt*2,$=p.scrollHeight,H=window.getComputedStyle(l),te=parseInt(H.borderTopWidth,10),q=parseInt(H.paddingTop,10),Q=parseInt(H.borderBottomWidth,10),j=parseInt(H.paddingBottom,10),ne=te+q+$+j+Q,Te=Math.min(g.offsetHeight*5,ne),we=window.getComputedStyle(p),Je=parseInt(we.paddingTop,10),wt=parseInt(we.paddingBottom,10),Ne=E.top+E.height/2-dt,Ye=U-Ne,Pn=g.offsetHeight/2,z=g.offsetTop+Pn,fe=te+q+z,Le=ne-fe;if(fe<=Ne){const oe=A.length>0&&g===A[A.length-1].ref.current;a.style.bottom="0px";const ae=l.clientHeight-p.offsetTop-p.offsetHeight,Xe=Math.max(Ye,Pn+(oe?wt:0)+ae+Q),Et=fe+Xe;a.style.height=Et+"px"}else{const oe=A.length>0&&g===A[0].ref.current;a.style.top="0px";const Xe=Math.max(Ne,te+p.offsetTop+(oe?Je:0)+Pn)+Le;a.style.height=Xe+"px",p.scrollTop=fe-Ne+p.offsetTop}a.style.margin=`${dt}px 0`,a.style.minHeight=Te+"px",a.style.maxHeight=U+"px",i==null||i(),requestAnimationFrame(()=>f.current=!0)}},[h,s.trigger,s.valueNode,a,l,p,g,v,s.dir,i]);ze(()=>C(),[C]);const[y,k]=B();ze(()=>{l&&k(window.getComputedStyle(l).zIndex)},[l]);const w=re(E=>{E&&m.current===!0&&(C(),_==null||_(),m.current=!1)},[C,_]);return S(ik,{scope:n,contentWrapper:a,shouldExpandOnScrollRef:f,onScrollButtonChange:w,children:S("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:y},children:S(Se.div,{...r,ref:u,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});wf.displayName=tk;var nk="SelectPopperPosition",Ia=Y((t,e)=>{const{__scopeSelect:n,align:i="start",collisionPadding:r=dt,...s}=t,o=Jr(n);return S(e_,{...o,...s,ref:e,align:i,collisionPadding:r,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Ia.displayName=nk;var[ik,Oa]=si(En,{}),Aa="SelectViewport",Ef=Y((t,e)=>{const{__scopeSelect:n,nonce:i,...r}=t,s=hn(Aa,n),o=Oa(Aa,n),a=Me(e,s.onViewportChange),c=W(0);return S(Ee,{children:[S("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),S(Gr.Slot,{scope:n,children:S(Se.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:Ce(r.onScroll,l=>{const d=l.currentTarget,{contentWrapper:u,shouldExpandOnScrollRef:h}=o;if(h!=null&&h.current&&u){const f=Math.abs(c.current-d.scrollTop);if(f>0){const m=window.innerHeight-dt*2,p=parseFloat(u.style.minHeight),g=parseFloat(u.style.height),v=Math.max(p,g);if(v<m){const _=v+f,C=Math.min(m,_),y=_-C;u.style.height=C+"px",u.style.bottom==="0px"&&(d.scrollTop=y>0?y:0,u.style.justifyContent="flex-end")}}}c.current=d.scrollTop})})})]})});Ef.displayName=Aa;var Pf="SelectGroup",[rk,sk]=si(Pf),ok=Y((t,e)=>{const{__scopeSelect:n,...i}=t,r=da();return S(rk,{scope:n,id:r,children:S(Se.div,{role:"group","aria-labelledby":r,...i,ref:e})})});ok.displayName=Pf;var xf="SelectLabel",ak=Y((t,e)=>{const{__scopeSelect:n,...i}=t,r=sk(xf,n);return S(Se.div,{id:r.id,...i,ref:e})});ak.displayName=xf;var Yr="SelectItem",[ck,Rf]=si(Yr),If=Y((t,e)=>{const{__scopeSelect:n,value:i,disabled:r=!1,textValue:s,...o}=t,a=un(Yr,n),c=hn(Yr,n),l=a.value===i,[d,u]=B(s??""),[h,f]=B(!1),m=Me(e,_=>{var C;return(C=c.itemRefCallback)==null?void 0:C.call(c,_,i,r)}),p=da(),g=W("touch"),v=()=>{r||(a.onValueChange(i),a.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return S(ck,{scope:n,value:i,disabled:r,textId:p,isSelected:l,onItemTextChange:re(_=>{u(C=>C||((_==null?void 0:_.textContent)??"").trim())},[]),children:S(Gr.ItemSlot,{scope:n,value:i,disabled:r,textValue:d,children:S(Se.div,{role:"option","aria-labelledby":p,"data-highlighted":h?"":void 0,"aria-selected":l&&h,"data-state":l?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...o,ref:m,onFocus:Ce(o.onFocus,()=>f(!0)),onBlur:Ce(o.onBlur,()=>f(!1)),onClick:Ce(o.onClick,()=>{g.current!=="mouse"&&v()}),onPointerUp:Ce(o.onPointerUp,()=>{g.current==="mouse"&&v()}),onPointerDown:Ce(o.onPointerDown,_=>{g.current=_.pointerType}),onPointerMove:Ce(o.onPointerMove,_=>{var C;g.current=_.pointerType,r?(C=c.onItemLeave)==null||C.call(c):g.current==="mouse"&&_.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ce(o.onPointerLeave,_=>{var C;_.currentTarget===document.activeElement&&((C=c.onItemLeave)==null||C.call(c))}),onKeyDown:Ce(o.onKeyDown,_=>{var y;((y=c.searchRef)==null?void 0:y.current)!==""&&_.key===" "||(z_.includes(_.key)&&v(),_.key===" "&&_.preventDefault())})})})})});If.displayName=Yr;var Mi="SelectItemText",Of=Y((t,e)=>{const{__scopeSelect:n,className:i,style:r,...s}=t,o=un(Mi,n),a=hn(Mi,n),c=Rf(Mi,n),l=Y_(Mi,n),[d,u]=B(null),h=Me(e,v=>u(v),c.onItemTextChange,v=>{var _;return(_=a.itemTextRefCallback)==null?void 0:_.call(a,v,c.value,c.disabled)}),f=d==null?void 0:d.textContent,m=ie(()=>S("option",{value:c.value,disabled:c.disabled,children:f},c.value),[c.disabled,c.value,f]),{onNativeOptionAdd:p,onNativeOptionRemove:g}=l;return ze(()=>(p(m),()=>g(m)),[p,g,m]),S(Ee,{children:[S(Se.span,{id:c.textId,...s,ref:h}),c.isSelected&&o.valueNode&&!o.valueNodeHasChildren?Ki(s.children,o.valueNode):null]})});Of.displayName=Mi;var Af="SelectItemIndicator",Df=Y((t,e)=>{const{__scopeSelect:n,...i}=t;return Rf(Af,n).isSelected?S(Se.span,{"aria-hidden":!0,...i,ref:e}):null});Df.displayName=Af;var Da="SelectScrollUpButton",Mf=Y((t,e)=>{const n=hn(Da,t.__scopeSelect),i=Oa(Da,t.__scopeSelect),[r,s]=B(!1),o=Me(e,i.onScrollButtonChange);return ze(()=>{if(n.viewport&&n.isPositioned){let a=function(){const l=c.scrollTop>0;s(l)};const c=n.viewport;return a(),c.addEventListener("scroll",a),()=>c.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?S(Lf,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:c}=n;a&&c&&(a.scrollTop=a.scrollTop-c.offsetHeight)}}):null});Mf.displayName=Da;var Ma="SelectScrollDownButton",Nf=Y((t,e)=>{const n=hn(Ma,t.__scopeSelect),i=Oa(Ma,t.__scopeSelect),[r,s]=B(!1),o=Me(e,i.onScrollButtonChange);return ze(()=>{if(n.viewport&&n.isPositioned){let a=function(){const l=c.scrollHeight-c.clientHeight,d=Math.ceil(c.scrollTop)<l;s(d)};const c=n.viewport;return a(),c.addEventListener("scroll",a),()=>c.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?S(Lf,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:c}=n;a&&c&&(a.scrollTop=a.scrollTop+c.offsetHeight)}}):null});Nf.displayName=Ma;var Lf=Y((t,e)=>{const{__scopeSelect:n,onAutoScroll:i,...r}=t,s=hn("SelectScrollButton",n),o=W(null),a=Kr(n),c=re(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return K(()=>()=>c(),[c]),ze(()=>{var d;const l=a().find(u=>u.ref.current===document.activeElement);(d=l==null?void 0:l.ref.current)==null||d.scrollIntoView({block:"nearest"})},[a]),S(Se.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:Ce(r.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(i,50))}),onPointerMove:Ce(r.onPointerMove,()=>{var l;(l=s.onItemLeave)==null||l.call(s),o.current===null&&(o.current=window.setInterval(i,50))}),onPointerLeave:Ce(r.onPointerLeave,()=>{c()})})}),lk="SelectSeparator",dk=Y((t,e)=>{const{__scopeSelect:n,...i}=t;return S(Se.div,{"aria-hidden":!0,...i,ref:e})});dk.displayName=lk;var Na="SelectArrow",uk=Y((t,e)=>{const{__scopeSelect:n,...i}=t,r=Jr(n),s=un(Na,n),o=hn(Na,n);return s.open&&o.position==="popper"?S(t_,{...r,...i,ref:e}):null});uk.displayName=Na;function Uf(t){return t===""||t===void 0}var Ff=Y((t,e)=>{const{value:n,...i}=t,r=W(null),s=Me(e,r),o=r_(n);return K(()=>{const a=r.current,c=window.HTMLSelectElement.prototype,d=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==n&&d){const u=new Event("change",{bubbles:!0});d.call(a,n),a.dispatchEvent(u)}},[o,n]),S(ef,{asChild:!0,children:S("select",{...i,ref:s,defaultValue:n})})});Ff.displayName="BubbleSelect";function Bf(t){const e=Vt(t),n=W(""),i=W(0),r=re(o=>{const a=n.current+o;e(a),function c(l){n.current=l,window.clearTimeout(i.current),l!==""&&(i.current=window.setTimeout(()=>c(""),1e3))}(a)},[e]),s=re(()=>{n.current="",window.clearTimeout(i.current)},[]);return K(()=>()=>window.clearTimeout(i.current),[]),[n,r,s]}function jf(t,e,n){const r=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=hk(t,Math.max(s,0));r.length===1&&(o=o.filter(l=>l!==n));const c=o.find(l=>l.textValue.toLowerCase().startsWith(r.toLowerCase()));return c!==n?c:void 0}function hk(t,e){return t.map((n,i)=>t[(e+i)%t.length])}var fk=gf,pk=yf,mk=_f,gk=kf,vk=Cf,yk=Ef,bk=If,_k=Of,kk=Df,Ck=Mf,Sk=Nf;function Vf({flagCode:t}){return S("img",{className:V.flag,src:`https://cdn.jsdelivr.net/gh/lipis/flag-icons/flags/4x3/${t}.svg`,alt:`${t.toUpperCase()} flag`})}function Tk({portal:t}){const[e,n]=B(!1),{language:i,setLanguage:r,options:s,showPicker:o}=ta();return o.value?S(fk,{open:e,value:i.value.languageCode,onValueChange:a=>{r(a),n(!1)},onOpenChange:a=>{a&&n(!0)},children:[S(pk,{className:_t(V.btn,V.secondary,V.select),"aria-label":"Food",children:[S(Vf,{flagCode:i.value.flagCode}),S("span",{className:V.selectValue,children:i.value.name}),S(mk,{className:V.selectIcon,children:S(Yn,{name:"chevron-down"})})]}),S(gk,{container:t,children:S(vk,{className:V.selectContent,position:"popper",sideOffset:8,align:"end",side:"top",onPointerDownOutside:()=>n(!1),onCloseAutoFocus:()=>n(!1),onEscapeKeyDown:()=>n(!1),children:[S(Ck,{className:V.selectScrollButton,children:S(Yn,{name:"chevron-up"})}),S(yk,{className:V.selectViewport,children:s.value.map(a=>S(bk,{value:a.languageCode,className:_t(V.selectItem),children:[S(Vf,{flagCode:a.flagCode}),S(_k,{children:a.name}),S(kk,{className:V.selectItemIndicator,children:S(Yn,{name:"check"})})]},a.languageCode))}),S(Sk,{className:V.selectScrollButton,children:S(Yn,{name:"chevron-down"})})]})})]}):null}function wk(){const{isMuted:t,isMutingEnabled:e,setIsMuted:n}=ea(),i=re(()=>{n(!t.peek())},[n]);return e.value?S(ra,{icon:t.value?"mic-off":"mic",onClick:i}):null}function Ek({link:t}){return S("div",{className:V.poweredBy,children:[S("span",{children:"Powered by ElevenLabs "}),S("a",{href:t||"https://elevenlabs.io/conversational-ai",target:"_blank",children:"Conversational AI"})]})}const Pk=()=>!Ky("(min-width: 768px)"),xk=({expandable:t,isMobile:e})=>{switch(t){case"always":return!0;case"mobile":return e;case"desktop":return!e;default:return!1}},Rk=({allowExpanding:t,isOpen:e})=>t?e:!0,Ik=Gi(function(){const{terms_key:e,terms_html:n,expandable:i,variant:r,disable_banner:s,show_avatar_when_collapsed:o,override_link:a}=vn().value,c=ie(()=>e?!!localStorage.getItem(e):!1,[e]),l=W(null),d=W(null),u=W(null),[h,f]=B(c),[m,p]=B(!1),[g,v]=B(null),[_,C]=B(!1),[y,k]=B(!1),{isMutingEnabled:w}=ea(),{startSession:E,endSession:I,error:R,isSpeaking:D,isDisconnected:A,status:U}=Ir(),$=Pk(),H=xk({expandable:i,isMobile:$}),te=y||!H||!A.value,q=Gy();K(()=>{var we;if(u.current){const Je=()=>{let Ne=null;for(const Ye of u.current.assignedElements())if(Ye instanceof HTMLFormElement){Ne=Ye;break}v(Ne),C((Ne==null?void 0:Ne.checkValidity())??!1)};Je();const wt=u.current;return wt.addEventListener("slotchange",Je),()=>wt.removeEventListener("slotchange",Je)}else v(d.current),C(((we=d.current)==null?void 0:we.checkValidity())??!1)},[n]),K(()=>{c||!g?(p(!1),f(!0)):!c&&g&&f(!1)},[c,g]);const Q=Rk({allowExpanding:H,isOpen:te}),{endFeedbackActive:j}=na(),ne=ta(),Te=qe(()=>({"--additional-width":ne.showPicker.value?"68px":w.value?"40px":void 0}));return S("div",{ref:l,style:Te,className:_t(V.wrapper,j.value?V.compact:V[r],te&&V.open,(m||R.value)&&V.customContent),children:[Q&&!s&&S(Ek,{link:a}),H&&!te&&S(Tn,{variant:"primary",icon:o?void 0:"phone",className:_t(V.minimize,o&&V.avatarButton),onClick:()=>k(!0),title:q.expand_text,children:o?S(ch,{}):q.expand_text}),S("div",{className:V.box,children:[R.value&&S(hb,{}),S("div",{className:_t(V.terms,m&&!R.value&&V.show),children:[n?S("form",{ref:d,onInput:()=>{C((g==null?void 0:g.checkValidity())??!1)},dangerouslySetInnerHTML:{__html:n}}):S("slot",{onInput:()=>{C((g==null?void 0:g.checkValidity())??!1)},ref:u,name:"terms"}),S("div",{class:V.termsFooter,children:[S(Tn,{onClick:()=>p(!1),children:"Cancel"}),S(Tn,{variant:"primary",disabledStyle:!_,onClick:we=>{g!=null&&g.reportValidity()&&(f(!0),e&&localStorage.setItem(e,"true"),p(!1),E(we.currentTarget))},children:"Agree"})]})]}),!m&&!R.value&&(j.value?S(fb,{}):S(Ee,{children:[S(ch,{}),S("div",{className:V.actions,children:[r!=="compact"&&S("p",{className:V.status,children:A.value?q.action_text:D.value?q.speaking_text:q.listening_text}),S("div",{className:V.actionButtons,children:A.value?S(Ee,{children:[S(Tn,{variant:"primary",icon:"phone",title:q.start_call_text,onClick:we=>{if(!h){p(!0);return}E(we.currentTarget)},children:q.start_call_text}),S(Tk,{portal:l.current??void 0})]}):S(Ee,{children:[S(Tn,{icon:"phone-off",title:q.end_call_text,disabled:U.value!=="connected",onClick:()=>I(),children:q.end_call_text}),S(wk,{})]})})]})]}))]}),S(pb,{})]})}),Ok='@import"https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap";*{box-sizing:border-box}._devHost_1968y_7,:host{pointer-events:none;position:fixed;right:32px;bottom:32px;z-index:1000;--btn-max-width: 320px}._wrapper_1968y_18{display:flex;flex-direction:column-reverse;align-items:flex-end;gap:16px;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}._box_1968y_39{background-color:var(--el-bg-color);color:var(--el-text-color);border:1px solid var(--el-border-color);display:flex;align-items:center;gap:16px;padding:20px;border-radius:var(--el-border-radius);box-shadow:0 0 64px 64px #0000001a;pointer-events:none;opacity:0;transition:opacity .2s var(--el-timing-function);max-width:calc(100vw - 64px);max-height:calc(100vh - 64px)}._open_1968y_57 ._box_1968y_39{pointer-events:initial;opacity:1}._compact_1968y_62:not(._customContent_1968y_62) ._box_1968y_39{gap:8px;padding:12px;border-radius:32px}._avatar_1968y_68{position:relative;width:54px;height:54px;flex-shrink:0}._compact_1968y_62 ._avatar_1968y_68{width:36px;height:36px}._avatarBackground_1968y_80{border-radius:50%;position:absolute;top:-1px;left:-1px;right:-1px;bottom:-1px;background-color:var(--el-border-color)}._avatarImage_1968y_90{border-radius:50%;position:absolute;top:0;left:0;right:0;bottom:0;background-size:cover;background-color:var(--el-bg-color);overflow:hidden}._canvas_1968y_102{width:100%;height:100%}._actions_1968y_107{width:min-content;display:flex;gap:11px;flex-direction:column}._actionButtons_1968y_114{min-width:calc(156px + var(--additional-width, 0px));max-width:var(--btn-max-width);display:flex;gap:8px}._status_1968y_121{font-size:14px;text-wrap:nowrap;line-height:24px;margin:-7px 0;max-width:var(--btn-max-width);overflow:hidden;text-overflow:ellipsis;color:var(--el-text-color)}._btn_1968y_132{--el-ring-color: transparent;--el-ring-radius: 0;--el-focus-ring-radius: 0;--el-border-width: 0;background-color:var(--el-btn-color);color:var(--el-btn-text-color);border-radius:var(--el-btn-radius);box-shadow:0 1px 2px #1018280d,0 0 0 var(--el-ring-radius) var(--el-ring-color),0 0 0 var(--el-focus-ring-radius) var(--el-focus-color),inset 0 0 0 var(--el-border-width) var(--el-border-color);cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:none;padding:0 16px;display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;font-size:14px;font-weight:500;transition:all .2s var(--el-timing-function);flex-grow:1;flex-shrink:1;min-height:36px;min-width:0;max-width:var(--btn-max-width)}._avatarButton_1968y_166{background-color:transparent;color:transparent;box-shadow:none;height:56px;padding:0}._avatarButton_1968y_166 ._avatar_1968y_68{margin:1px}._btn_1968y_132:hover{--el-ring-color: rgba(125, 135, 155, .2);--el-ring-radius: 3px}._btn_1968y_132:active{--el-ring-color: rgba(101, 115, 135, .3);--el-ring-radius: 3px}._btn_1968y_132._disabled_1968y_189{opacity:.5}._btn_1968y_132:disabled{opacity:.5;pointer-events:none}._btn_1968y_132:focus-visible{--el-focus-ring-radius: 1px;outline:none}._btn_1968y_132._secondary_1968y_203{--el-border-width: 1px;background-color:var(--el-bg-color);color:var(--el-text-color)}._btn_1968y_132._secondary_1968y_203:hover{--el-ring-color: rgba(135, 145, 165, .1)}._btn_1968y_132._secondary_1968y_203:active{--el-ring-color: rgba(125, 135, 155, .2)}._btn_1968y_132._iconBtn_1968y_217{flex-grow:0;flex-shrink:0;height:36px;width:36px}._btn_1968y_132._select_1968y_224{flex-grow:0;flex-shrink:0;padding:6px;gap:4px}._ellipsis_1968y_231{flex-shrink:1;overflow:hidden;text-overflow:ellipsis}._iconSlot_1968y_237{display:flex;font-size:16px}._btnIcon_1968y_242{margin-left:-6px;margin-right:4px;flex-shrink:0}._minimize_1968y_248{pointer-events:all}._poweredBy_1968y_252{pointer-events:all;font-size:10px;align-self:center;text-align:center;color:var(--el-text-color)}._poweredBy_1968y_252 a,._poweredBy_1968y_252 span{opacity:.5}._poweredBy_1968y_252 a{white-space:nowrap;color:inherit;outline-color:var(--el-focus-color)}._poweredBy_1968y_252 a:hover,._poweredBy_1968y_252 a:focus-visible{opacity:1}._compact_1968y_62 ._poweredBy_1968y_252,._full_1968y_277 ._poweredBy_1968y_252{margin:-8px 0 -20px}._terms_1968y_281{display:none;max-width:480px;font-size:14px;line-height:20px;accent-color:var(--el-btn-color)}._terms_1968y_281 form{display:flex;flex-direction:column;gap:16px}._terms_1968y_281 p,._terms_1968y_281 ul,._terms_1968y_281 ol,._terms_1968y_281 h1,._terms_1968y_281 h2,._terms_1968y_281 h3,._terms_1968y_281 h4,._terms_1968y_281 h5,._terms_1968y_281 h6{margin:0;font-weight:400}._terms_1968y_281 a{color:var(--el-text-color)}._terms_1968y_281 ._strong_1968y_312{font-weight:500}._terms_1968y_281 h1{font-size:35px}._terms_1968y_281 h2{font-size:28px}._terms_1968y_281 h3{font-size:24px}._terms_1968y_281 h4{font-size:20px}._terms_1968y_281 h5{font-size:18px}._terms_1968y_281 h6{font-size:16px}._terms_1968y_281._show_1968y_340{display:block}._termsFooter_1968y_344{display:flex;gap:8px;justify-content:end;margin-top:20px}._termsFooter_1968y_344 ._btn_1968y_132{flex-grow:0}._feedback_1968y_355{display:flex;align-items:center;gap:8px;z-index:1;opacity:0;translate:0 8px;transition:all .6s var(--el-timing-function);font-size:12px;text-wrap:nowrap;line-height:10px;margin:0;color:var(--el-text-color)}._feedback_1968y_355._show_1968y_340{opacity:.5;translate:0 0;pointer-events:auto}._feedback_1968y_355._show_1968y_340:hover{opacity:1}._inlineFeedback_1968y_381{display:flex;align-items:center;gap:5px;z-index:1;translate:0 8px;transition:all .6s var(--el-timing-function);font-size:14px;font-weight:500;text-wrap:nowrap;line-height:20px}._inlineFeedback_1968y_381._show_1968y_340{translate:0 0;pointer-events:auto}._inlineFeedback_1968y_381 ._feedbackText_1968y_400{margin:0 12px}._flag_1968y_404{width:24px;height:24px;border-radius:50%;object-fit:cover;border:1px solid var(--el-border-color)}._selectContent_1968y_412{z-index:1;overflow:hidden;background-color:var(--el-bg-color);color:var(--el-text-color);border:1px solid var(--el-border-color);border-radius:var(--el-border-radius);max-height:min(384px,var(--radix-select-content-available-height));min-width:var(--radix-select-trigger-width)}._selectViewport_1968y_423{padding:8px}._selectValue_1968y_427{display:none;margin-right:auto;margin-left:auto}._selectIcon_1968y_433{padding-right:4px}._selectItem_1968y_437{display:flex;-webkit-user-select:none;user-select:none;align-items:center;padding:6px 32px 6px 6px;gap:8px;cursor:pointer;border-radius:var(--el-border-radius);position:relative}._selectItem_1968y_437:focus-visible{outline:none}._selectItem_1968y_437[data-highlighted]{background-color:#8080801a}._selectItemIndicator_1968y_456{position:absolute;right:0;width:32px;display:inline-flex;align-items:center;justify-content:center}._selectScrollButton_1968y_465{display:flex;align-items:center;justify-content:center;height:24px;background-color:var(--el-bg-color);cursor:default}._error_1968y_474{max-width:320px;font-size:14px;line-height:20px}._error_1968y_474 h1{margin:0 0 16px;font-size:20px;font-weight:400}._error_1968y_474 p{margin:0}';function Ak(){const t=vn();let e=Ok;const n=qe(()=>`.${V.devHost}, :host {
  --el-bg-color: ${t.value.bg_color??"#fff"};
  --el-text-color: ${t.value.text_color??"#000"};
  --el-border-color: ${t.value.border_color??"#e1e1e1"};
  --el-border-radius: ${t.value.border_radius??"20"}px;
  --el-btn-color: ${t.value.btn_color??"#000"};
  --el-btn-text-color: ${t.value.btn_text_color??"#fff"};
  --el-btn-radius: ${t.value.btn_radius??"32"}px;
  --el-focus-color: ${t.value.focus_color??"#000"};
  --el-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}`);return S("style",{children:[n,e]})}function Dk(t){return S(Ap,{value:t,children:S(Up,{children:S(Bp,{children:S(Ly,{children:S(Ny,{children:S(Uy,{children:S(By,{children:S(Hy,{children:S(zy,{children:S(Vp,{children:[S(Ak,{}),S(Ik,{})]})})})})})})})})})})}const Mk=window.__ELEVEN_LABS_CONVAI_WIDGET_TAG_NAME__||"elevenlabs-convai";Zf(Dk,Mk,cs,{shadow:!0})});
