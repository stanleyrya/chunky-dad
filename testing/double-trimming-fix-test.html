<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Trimming Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-case {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
        }
        .fixed {
            background: #e8f5e9;
            border-color: #4CAF50;
        }
        .original {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .step {
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-left: 3px solid #2196F3;
        }
        .improvement {
            border-left-color: #4CAF50;
            background: #e8f5e9;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 5px;
        }
        .before {
            background: #ffebee;
            border: 1px solid #f44336;
        }
        .after {
            background: #e8f5e9;
            border: 1px solid #4CAF50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f0f0f0;
            font-weight: bold;
        }
        .breakpoint {
            font-family: monospace;
            font-size: 0.9em;
        }
        code {
            background: #f0f0f0;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Double Trimming Fix Test ✅</h1>
    
    <p>This test verifies that the double trimming issue has been resolved:</p>
    <ul>
        <li><strong>Fixed:</strong> User-provided shortNames are no longer processed by generateShortName()</li>
        <li><strong>Fixed:</strong> generateShortName() is less aggressive and only removes stop words</li>
        <li><strong>Result:</strong> Only the smart per-line logic handles screen-specific trimming</li>
    </ul>

    <h2>Key Test Case: "South Seattle Bear Social"</h2>
    <div class="comparison">
        <div class="before">
            <h3>❌ Before (Double Trimming)</h3>
            <ol>
                <li><strong>generateShortName():</strong> "South Seattle Bear Social" → "South"</li>
                <li><strong>Per-line logic:</strong> "South" (6 chars) → "Sout…" (xs)</li>
            </ol>
            <p><strong>Result:</strong> Way too aggressive!</p>
        </div>
        <div class="after">
            <h3>✅ After (Single Smart Trimming)</h3>
            <ol>
                <li><strong>User shortName:</strong> "South Seattle Bear Social" (preserved)</li>
                <li><strong>Per-line logic:</strong> Smart multi-line fitting per screen size</li>
            </ol>
            <p><strong>Result:</strong> Appropriate for each screen size!</p>
        </div>
    </div>

    <h2>Test Results</h2>
    <div id="test-results"></div>

    <script src="../js/logger.js"></script>
    <script src="../js/calendar-core.js"></script>
    <script src="../js/dynamic-calendar-loader.js"></script>
    
    <script>
        // Test the fixed behavior
        const calendarLoader = new DynamicCalendarLoader();
        
        const testCases = [
            {
                name: "South Seattle Bear Social",
                description: "shortName: South Seattle Bear Social",
                expectedImprovement: "Should preserve full shortName and fit appropriately per screen"
            },
            {
                name: "International Bear Weekend", 
                description: "shortName: International Bear Weekend",
                expectedImprovement: "Should keep full name and break intelligently"
            },
            {
                name: "The Eagle NYC Bear Night",
                description: "", // No shortName - will use generateShortName (but less aggressive)
                expectedImprovement: "generateShortName should only remove 'The', keeping 'Eagle NYC Bear Night'"
            },
            {
                name: "Woof Wednesday at The Cub",
                description: "shortName: Woof Wednesday",
                expectedImprovement: "Should preserve user's preferred shortName"
            },
            {
                name: "Pride Opening Night at The Bar",
                description: "", // No shortName - will use generateShortName
                expectedImprovement: "Should remove stop words but keep meaningful content"
            }
        ];
        
        const resultsDiv = document.getElementById('test-results');
        
        testCases.forEach((testCase, index) => {
            const mockCalendarEvent = {
                title: testCase.name,
                description: testCase.description,
                start: new Date(),
                end: new Date()
            };
            
            // Parse the event data
            const eventData = calendarLoader.parseEventData(mockCalendarEvent);
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-case fixed';
            
            // Create results table
            const breakpoints = ['xs', 'sm', 'md', 'lg'];
            const charLimits = { xs: 5, sm: 8, md: 12, lg: 20 };
            
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Breakpoint</th>
                            <th>Char Limit/Line</th>
                            <th>Result</th>
                            <th>Length</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            breakpoints.forEach(bp => {
                const result = calendarLoader.getSmartEventNameForBreakpoint(eventData, bp);
                const length = result.length;
                const limit = charLimits[bp];
                
                tableHTML += `
                    <tr>
                        <td class="breakpoint">${bp}</td>
                        <td>${limit}</td>
                        <td><code>${result}</code></td>
                        <td>${length}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            testDiv.innerHTML = `
                <div class="original">Test ${index + 1}: "${testCase.name}"</div>
                <div class="step">
                    <strong>Original shortName processing:</strong><br>
                    • Input shortName: ${testCase.description.includes('shortName:') ? `"${testCase.description.replace('shortName: ', '')}"` : 'None (will generate)'}<br>
                    • Final parsed shortName: <code>"${eventData.shortName || 'none'}"</code><br>
                    • Generated by: ${testCase.description.includes('shortName:') ? 'User (preserved)' : 'generateShortName() (less aggressive)'}
                </div>
                <div class="step improvement">
                    <strong>Expected Improvement:</strong> ${testCase.expectedImprovement}
                </div>
                ${tableHTML}
            `;
            
            resultsDiv.appendChild(testDiv);
        });
        
        // Add summary
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'test-case fixed';
        summaryDiv.innerHTML = `
            <h3>✅ Fix Summary</h3>
            <ul>
                <li><strong>User-provided shortNames</strong> are now preserved and not processed by generateShortName()</li>
                <li><strong>generateShortName()</strong> is less aggressive - only removes stop words, no length limits</li>
                <li><strong>Per-line trimming</strong> handles all screen-specific adjustments intelligently</li>
                <li><strong>Result:</strong> "South Seattle Bear Social" now displays appropriately on each screen size instead of being over-trimmed to "Sout…"</li>
            </ul>
        `;
        resultsDiv.appendChild(summaryDiv);
    </script>
</body>
</html>