<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Hyphenation Test - Chunky Dad</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .test-section {
            margin-bottom: 3rem;
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            border-radius: 8px;
        }
        
        .test-event {
            background: var(--background-light);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            border: 1px solid var(--border-lighter);
        }
        
        .width-simulator {
            border: 2px dashed var(--primary-color);
            padding: 0.5rem;
            margin: 0.5rem 0;
            overflow: hidden;
        }
        
        .width-100 { width: 100px; }
        .width-150 { width: 150px; }
        .width-200 { width: 200px; }
        .width-250 { width: 250px; }
        
        .demo-controls {
            margin: 1rem 0;
        }
        
        .demo-controls button {
            margin: 0.25rem;
            padding: 0.5rem 1rem;
            border: 1px solid var(--primary-color);
            background: var(--background-primary);
            color: var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
        }
        
        .demo-controls button:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .demo-controls button.active {
            background: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Smart Nickname Hyphenation Test</h1>
        <p>This demonstrates automatic hyphenation handling using existing nickname fields.</p>
        
        <div class="test-section">
            <h2>Test Events</h2>
            <p>These events have hyphenated nicknames. The system automatically removes hyphens based on length heuristics for mobile vs desktop:</p>
            
            <div class="test-event">
                <h3>Event: Rockstrap Party</h3>
                <p><strong>Nickname:</strong> Rock-strap (hyphenated) → Rockstrap (unhyphenated when space allows)</p>
                <div class="demo-controls">
                    <button onclick="testWidth('rockstrap', 100)" class="width-btn">100px</button>
                    <button onclick="testWidth('rockstrap', 150)" class="width-btn">150px</button>
                    <button onclick="testWidth('rockstrap', 200)" class="width-btn">200px</button>
                    <button onclick="testWidth('rockstrap', 250)" class="width-btn">250px</button>
                    <button onclick="testWidth('rockstrap', 'auto')" class="width-btn active">Auto</button>
                </div>
                <div id="rockstrap-demo" class="width-simulator width-250">
                    <div class="event-item">
                        <div class="event-name">Rockstrap Party</div>
                        <div class="event-name-mobile" id="rockstrap-mobile">Rockstrap Party</div>
                    </div>
                </div>
            </div>
            
            <div class="test-event">
                <h3>Event: Bear Weekend Festival</h3>
                <p><strong>Nickname:</strong> Bear Week-end (hyphenated) → Bear Weekend (unhyphenated when space allows)</p>
                <div class="demo-controls">
                    <button onclick="testWidth('bearweekend', 100)" class="width-btn">100px</button>
                    <button onclick="testWidth('bearweekend', 150)" class="width-btn">150px</button>
                    <button onclick="testWidth('bearweekend', 200)" class="width-btn">200px</button>
                    <button onclick="testWidth('bearweekend', 250)" class="width-btn">250px</button>
                    <button onclick="testWidth('bearweekend', 'auto')" class="width-btn active">Auto</button>
                </div>
                <div id="bearweekend-demo" class="width-simulator width-250">
                    <div class="event-item">
                        <div class="event-name">Bear Weekend Festival</div>
                        <div class="event-name-mobile" id="bearweekend-mobile">Bear Weekend Festival</div>
                    </div>
                </div>
            </div>
            
            <div class="test-event">
                <h3>Event: Underwear Night</h3>
                <p><strong>Nickname:</strong> Under-wear (hyphenated) → Underwear (unhyphenated when space allows)</p>
                <div class="demo-controls">
                    <button onclick="testWidth('underwear', 100)" class="width-btn">100px</button>
                    <button onclick="testWidth('underwear', 150)" class="width-btn">150px</button>
                    <button onclick="testWidth('underwear', 200)" class="width-btn">200px</button>
                    <button onclick="testWidth('underwear', 250)" class="width-btn">250px</button>
                    <button onclick="testWidth('underwear', 'auto')" class="width-btn active">Auto</button>
                </div>
                <div id="underwear-demo" class="width-simulator width-250">
                    <div class="event-item">
                        <div class="event-name">Underwear Night</div>
                        <div class="event-name-mobile" id="underwear-mobile">Underwear Night</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>How It Works</h2>
            <ol>
                <li><strong>Use existing nickname field:</strong> Include hyphens in your <code>nickname</code> or <code>shortName</code> field</li>
                <li><strong>Automatic detection:</strong> The system detects hyphens and creates an unhyphenated version</li>
                            <li><strong>Smart decision making:</strong> 
                <ul>
                    <li>Uses length-based heuristics for mobile vs desktop</li>
                    <li>Mobile: aggressive hyphenation for limited space</li>
                    <li>Desktop: conservative hyphenation with more space</li>
                </ul>
            </li>
                <li><strong>Mobile optimization:</strong> On mobile screens (≤768px), uses aggressive heuristics for limited space:
                    <ul>
                        <li>Names >10 chars: use unhyphenated if ≤5 chars, otherwise hyphenated</li>
                        <li>Names >6 chars: use unhyphenated if ≤6 chars, otherwise hyphenated</li>
                    </ul>
                </li>
                <li><strong>Desktop optimization:</strong> On desktop screens, uses conservative heuristics:
                    <ul>
                        <li>Names >10 chars: use unhyphenated if ≤10 chars, otherwise hyphenated</li>
                    </ul>
                </li>
                <li><strong>No breaking changes:</strong> Works with existing nickname system, regular nicknames work as before</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h2>Usage in Calendar Data</h2>
            <pre><code>SUMMARY:Rockstrap Party
DESCRIPTION:Bar: The Bear Den
Nickname: Rock-strap
Cover: $15
Website: https://example.com</code></pre>
            <p>The system will automatically use "Rockstrap" when there's space, "Rock-strap" when space is tight, and fall back to "Rockstrap Party" when there's plenty of room.</p>
        </div>
    </div>

    <script>
        // Test data with hyphenated nicknames
        const testEvents = {
            rockstrap: {
                name: 'Rockstrap Party',
                shortName: 'Rock-strap'
            },
            bearweekend: {
                name: 'Bear Weekend Festival',
                shortName: 'Bear Week-end'
            },
            underwear: {
                name: 'Underwear Night',
                shortName: 'Under-wear'
            }
        };



        // Smart nickname hyphenation logic (matches the main system)
        function getSmartEventName(event, maxWidthPx = null) {
            // (A) Start with nickname if available, else event name, else bar
            let base = event.shortName || event.name || event.bar || '';
            if (!base) return '';
            // Always convert '\-' to '-' (escaped hyphens)
            base = base.replace(/\\-/g, '-');
            // (B) If a word will fit horizontally, remove any '-' and show it all
            // (C) If a word won't fit, keep the '-' if they were added in
            // Try to show three lines max, splitting on spaces and hyphens
            // We'll simulate width by character count if maxWidthPx is not provided
            // (real width calc would require DOM, so we use heuristics)
            const maxCharsPerLine = maxWidthPx ? Math.floor(maxWidthPx / 10) : (window.innerWidth <= 400 ? 8 : 14);
            // Split on spaces and hyphens
            let parts = base.split(/[-\s]+/);
            // Remove empty
            parts = parts.filter(Boolean);
            // Try to fit as many as possible in three lines
            let lines = [];
            let currentLine = '';
            for (let i = 0; i < parts.length; i++) {
                let part = parts[i];
                // If adding this part would overflow the line, start a new line
                if ((currentLine + (currentLine ? ' ' : '') + part).length > maxCharsPerLine) {
                    if (currentLine) lines.push(currentLine);
                    currentLine = part;
                    if (lines.length === 3) break;
                } else {
                    currentLine += (currentLine ? ' ' : '') + part;
                }
            }
            if (currentLine && lines.length < 3) lines.push(currentLine);
            // If we couldn't fit all, add ellipsis
            if (lines.length === 3 && parts.length > 3) {
                lines[2] = lines[2].replace(/\s+$/, '') + '...';
            }
            // If the original had hyphens and we had to break, keep hyphens in the output
            if (base.includes('-') && lines.length > 1) {
                // Re-split with hyphens for more faithful output
                let hyphenParts = base.split('-');
                lines = [];
                currentLine = '';
                for (let i = 0; i < hyphenParts.length; i++) {
                    let part = hyphenParts[i].trim();
                    if ((currentLine + (currentLine ? '-' : '') + part).length > maxCharsPerLine) {
                        if (currentLine) lines.push(currentLine);
                        currentLine = part;
                        if (lines.length === 3) break;
                    } else {
                        currentLine += (currentLine ? '-' : '') + part;
                    }
                }
                if (currentLine && lines.length < 3) lines.push(currentLine);
                if (lines.length === 3 && hyphenParts.length > 3) {
                    lines[2] = lines[2].replace(/\s+$/, '') + '...';
                }
            }
            return lines.join('\n');
        }

        // Playground for dynamic testing
        function updatePlayground() {
            const name = document.getElementById('playground-name').value;
            const shortName = document.getElementById('playground-short').value;
            const bar = document.getElementById('playground-bar').value;
            const width = parseInt(document.getElementById('playground-width').value, 10) || 200;
            const event = { name, shortName, bar };
            const smartName = getSmartEventName(event, width);
            document.getElementById('playground-output').textContent = smartName;
        }

        function testWidth(eventKey, width) {
            const event = testEvents[eventKey];
            const demo = document.getElementById(`${eventKey}-demo`);
            const mobileElement = document.getElementById(`${eventKey}-mobile`);
            
            // Update container width
            if (width === 'auto') {
                demo.className = 'width-simulator width-250';
            } else {
                demo.className = 'width-simulator';
                demo.style.width = width + 'px';
            }
            
            // Update button states
            const buttons = demo.parentElement.querySelectorAll('.width-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target?.classList.add('active');
            
            // Calculate and display smart name
            const smartName = getSmartEventName(event);
            mobileElement.textContent = smartName;
            
            // Add visual indicator
            const nickname = event.shortName;
            const unhyphenatedNickname = nickname ? nickname.replace(/-/g, '') : '';
            
            let indicator = '';
            if (smartName === nickname && nickname.includes('-')) {
                indicator = ' ✂️'; // Scissors emoji to indicate hyphenation was kept
            } else if (smartName === unhyphenatedNickname) {
                indicator = ' 🔗'; // Link emoji to indicate hyphens were removed
            }
            
            mobileElement.textContent = smartName + indicator;
        }

        // Initialize demos
        window.addEventListener('load', () => {
            Object.keys(testEvents).forEach(key => {
                testWidth(key, 'auto');
            });
            updatePlayground();
            // Add listeners for playground
            ['playground-name','playground-short','playground-bar','playground-width'].forEach(id => {
                document.getElementById(id).addEventListener('input', updatePlayground);
            });
        });
    </script>
    <div class="test-section">
        <h2>Playground: Try Your Own</h2>
        <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end;">
            <div>
                <label>Event Name<br><input id="playground-name" type="text" value="Rock-Strap Party Hardy" style="width:180px"></label>
            </div>
            <div>
                <label>Nickname/Short<br><input id="playground-short" type="text" value="Rock-Strap" style="width:120px"></label>
            </div>
            <div>
                <label>Bar<br><input id="playground-bar" type="text" value="Bear Bar" style="width:120px"></label>
            </div>
            <div>
                <label>Width (px)<br><input id="playground-width" type="number" value="120" min="40" max="400" style="width:70px"></label>
            </div>
            <div>
                <button onclick="updatePlayground()">Test</button>
            </div>
        </div>
        <div style="margin-top:1rem;">
            <strong>Result (multi-line):</strong>
            <pre id="playground-output" style="background:#f8f8f8; border:1px solid #ccc; padding:1em; min-height:2em; font-size:1.1em;"></pre>
        </div>
    </div>
</body>
</html>