<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildcard Key Matching Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .result { font-weight: bold; }
    </style>
</head>
<body>
    <h1>Wildcard Key Matching Test</h1>
    <div id="results"></div>

    <script src="../scripts/shared-core.js"></script>
    <script>
        // Test the wildcard matching functionality
        function runTests() {
            const resultsDiv = document.getElementById('results');
            const sharedCore = new SharedCore();
            
            const testCases = [
                {
                    name: "Exact match with wildcards",
                    pattern: "chunk-chicago-presents-sausage-party|2025-10-*|*|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-10-15|cell-block|chunk",
                    expected: true
                },
                {
                    name: "Exact match without wildcards",
                    pattern: "chunk-chicago-presents-sausage-party|2025-10-15|cell-block|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-10-15|cell-block|chunk",
                    expected: true
                },
                {
                    name: "Wildcard in date segment",
                    pattern: "chunk-chicago-presents-sausage-party|2025-10-*|cell-block|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-10-22|cell-block|chunk",
                    expected: true
                },
                {
                    name: "Wildcard in venue segment",
                    pattern: "chunk-chicago-presents-sausage-party|2025-10-15|*|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-10-15|different-venue|chunk",
                    expected: true
                },
                {
                    name: "Multiple wildcards",
                    pattern: "chunk-chicago-presents-sausage-party|*|*|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-11-01|any-venue|chunk",
                    expected: true
                },
                {
                    name: "Partial wildcard in date",
                    pattern: "chunk-chicago-presents-sausage-party|2025-*-15|cell-block|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-11-15|cell-block|chunk",
                    expected: true
                },
                {
                    name: "No match - different title",
                    pattern: "chunk-chicago-presents-sausage-party|2025-10-*|*|chunk",
                    key: "different-event|2025-10-15|cell-block|chunk",
                    expected: false
                },
                {
                    name: "No match - different source",
                    pattern: "chunk-chicago-presents-sausage-party|2025-10-*|*|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-10-15|cell-block|different-source",
                    expected: false
                },
                {
                    name: "No match - different number of segments",
                    pattern: "chunk-chicago-presents-sausage-party|2025-10-*|*|chunk",
                    key: "chunk-chicago-presents-sausage-party|2025-10-15|cell-block",
                    expected: false
                }
            ];
            
            let passed = 0;
            let failed = 0;
            
            testCases.forEach(testCase => {
                const result = sharedCore.matchesKeyPattern(testCase.pattern, testCase.key);
                const passed = result === testCase.expected;
                
                const testDiv = document.createElement('div');
                testDiv.className = `test-case ${passed ? 'pass' : 'fail'}`;
                testDiv.innerHTML = `
                    <div class="result">${passed ? 'PASS' : 'FAIL'}: ${testCase.name}</div>
                    <div>Pattern: ${testCase.pattern}</div>
                    <div>Key: ${testCase.key}</div>
                    <div>Expected: ${testCase.expected}, Got: ${result}</div>
                `;
                
                resultsDiv.appendChild(testDiv);
                
                if (passed) {
                    passed++;
                } else {
                    failed++;
                }
            });
            
            // Summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-case';
            summaryDiv.innerHTML = `
                <div class="result">Test Summary: ${passed} passed, ${failed} failed</div>
            `;
            resultsDiv.appendChild(summaryDiv);
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>