<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventbrite Parser - Enhanced Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .header {
            background: #333;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .results {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        
        button:hover {
            background: #005a87;
        }
        
        .event-details {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .event-link {
            color: #007cba;
            text-decoration: none;
            font-weight: bold;
        }
        
        .event-link:hover {
            text-decoration: underline;
        }

        .example-section {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 4px;
        }

        .example-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .example-url {
            font-family: monospace;
            background: #f8f8f8;
            padding: 5px;
            border-radius: 3px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé´ Enhanced Eventbrite Parser Test</h1>
        <p>Testing venue extraction, GPS coordinates, and time parsing improvements</p>
    </div>
    
    <div class="test-section">
        <h3>Test Examples from User</h3>
        
        <div class="example-section">
            <div class="example-title">Example 1: Denver Megawoof</div>
            <div class="example-url">https://www.eventbrite.com/e/megawoof-america-denver-massive-2-parties-1-ticket-tickets-1381219547849</div>
            <div>Expected Venue: <strong>Trade</strong></div>
            <div>Expected Address: <strong>475 Santa Fe Drive Denver, CO 80204</strong></div>
        </div>
        
        <div class="example-section">
            <div class="example-title">Example 2: Atlanta Megawoof</div>
            <div class="example-url">https://www.eventbrite.com/e/megawoof-america-atlanta-tickets-1433358025439</div>
            <div>Expected Venue: <strong>The Heretic Atlanta</strong></div>
            <div>Expected Address: <strong>2069 Cheshire Bridge Road Northeast Atlanta, GA 30324</strong></div>
        </div>
        
        <button onclick="testWithSampleHTML()">Test with Sample HTML</button>
        <button onclick="testTimeParsingExample()">Test Time Parsing</button>
        <button onclick="testGeocodingExample()">Test Geocoding</button>
        <button onclick="clearResults()">Clear Results</button>
        
        <div id="results"></div>
    </div>
    
    <!-- Load the eventbrite parser -->
    <script src="../scripts/core/event-parser-eventbrite.js"></script>
    
    <script>
        // Sample HTML with venue information (based on the examples)
        const sampleHtmlDenver = `
        <div class="Container_root__4i85v NestedActionContainer_root__1jtfr event-card event-card__vertical" 
             data-event-location="Denver, CO">
            <a href="https://www.eventbrite.com/e/megawoof-america-denver-massive-2-parties-1-ticket-tickets-1381219547849" 
               rel="noopener" target="_blank" class="event-card-link" 
               aria-label="View MEGAWOOF AMERICA DENVER : MASSIVE 2 Parties 1 Ticket" 
               data-event-id="1381219547849">
                <section class="event-card-details">
                    <div class="Stack_root__1ksk7">
                        <h3 class="Typography_root__487rx Typography_body-lg__487rx">
                            MEGAWOOF AMERICA DENVER : MASSIVE 2 Parties 1 Ticket
                        </h3>
                        <p class="Typography_root__487rx Typography_body-md__487rx">
                            Sat, Aug 23 ‚Ä¢ 9:00 PM - 2:00 AM
                        </p>
                        <p class="Typography_root__487rx Typography_body-md__487rx">
                            Trade
                        </p>
                        <p class="Typography_root__487rx Typography_body-md-bold__487rx">
                            From $16.84
                        </p>
                    </div>
                </section>
            </a>
        </div>`;

        // Sample with JSON-LD structured data
        const sampleWithStructuredData = `
        <script type="application/ld+json">
        {
            "@type": "Event",
            "name": "MEGAWOOF AMERICA DENVER : MASSIVE 2 Parties 1 Ticket",
            "startDate": "2025-08-23T21:00:00-06:00",
            "endDate": "2025-08-24T02:00:00-06:00",
            "location": {
                "name": "Trade",
                "address": "475 Santa Fe Drive, Denver, CO 80204",
                "geo": {
                    "latitude": "39.7392",
                    "longitude": "-105.0178"
                }
            },
            "url": "https://www.eventbrite.com/e/megawoof-america-denver-massive-2-parties-1-ticket-tickets-1381219547849"
        }
        </script>
        <div>Event content here...</div>`;
        
        function testWithSampleHTML() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing enhanced parser...</p>';
            
            try {
                if (typeof EventbriteEventParser === 'undefined') {
                    throw new Error('EventbriteEventParser is not loaded');
                }
                
                const parser = new EventbriteEventParser({
                    alwaysBear: true,
                    requireDetailPages: false
                });
                
                // Test with sample HTML
                const htmlData = {
                    html: sampleHtmlDenver,
                    url: 'https://www.eventbrite.com/o/megawoof-america-18118978189'
                };
                
                const result = parser.parseEvents(htmlData);
                
                let resultHtml = '<div class="results"><h4>‚úÖ Enhanced Parser Test Results</h4>';
                
                if (result.events && result.events.length > 0) {
                    const event = result.events[0];
                    resultHtml += `
                        <div class="event-details">
                            <h5>üìÖ Parsed Event (HTML):</h5>
                            <p><strong>Title:</strong> ${event.title || 'N/A'}</p>
                            <p><strong>Date String:</strong> ${event.dateString || 'N/A'}</p>
                            <p><strong>Start Date (ISO):</strong> ${event.startDate || event.date || 'N/A'}</p>
                            <p><strong>End Date (ISO):</strong> ${event.endDate || 'N/A'}</p>
                            <p><strong>Venue/Bar Name:</strong> ${event.venue || 'N/A'}</p>
                            <p><strong>Address:</strong> ${event.address || 'N/A'}</p>
                            <p><strong>GPS Coordinates:</strong> ${event.coordinates ? `${event.coordinates.lat}, ${event.coordinates.lng}` : 'N/A'}</p>
                            <p><strong>Google Maps Link:</strong> ${event.googleMapsLink ? `<a href="${event.googleMapsLink}" target="_blank" class="event-link">üó∫Ô∏è Open in Maps</a>` : 'N/A'}</p>
                            <p><strong>City:</strong> ${event.city || 'N/A'}</p>
                            <p><strong>Price:</strong> ${event.price || 'N/A'}</p>
                            <p><strong>Is Bear Event:</strong> ${event.isBearEvent ? 'üêª Yes' : '‚ùå No'}</p>
                        </div>
                    `;
                    
                    // Test venue extraction
                    if (event.venue === 'Trade') {
                        resultHtml += '<p style="color: green; font-weight: bold;">‚úÖ SUCCESS: Venue "Trade" correctly extracted!</p>';
                    } else {
                        resultHtml += `<p style="color: orange; font-weight: bold;">‚ö†Ô∏è PARTIAL: Expected venue "Trade", got "${event.venue}"</p>`;
                    }
                    
                    // Test Google Maps link
                    if (event.googleMapsLink) {
                        resultHtml += '<p style="color: green; font-weight: bold;">‚úÖ SUCCESS: Google Maps link generated!</p>';
                    } else {
                        resultHtml += '<p style="color: red; font-weight: bold;">‚ùå ISSUE: No Google Maps link generated</p>';
                    }
                }
                
                // Now test with structured data
                const structuredDataTest = {
                    html: sampleWithStructuredData,
                    url: 'https://www.eventbrite.com/e/test-event'
                };
                
                const structuredResult = parser.parseEvents(structuredDataTest);
                
                if (structuredResult.events && structuredResult.events.length > 0) {
                    const structuredEvent = structuredResult.events[0];
                    resultHtml += `
                        <div class="event-details">
                            <h5>üìÖ Parsed Event (JSON-LD):</h5>
                            <p><strong>Title:</strong> ${structuredEvent.title || 'N/A'}</p>
                            <p><strong>Start Date:</strong> ${structuredEvent.startDate || 'N/A'}</p>
                            <p><strong>End Date:</strong> ${structuredEvent.endDate || 'N/A'}</p>
                            <p><strong>Venue:</strong> ${structuredEvent.venue || 'N/A'}</p>
                            <p><strong>Address:</strong> ${structuredEvent.address || 'N/A'}</p>
                            <p><strong>GPS Coordinates:</strong> ${structuredEvent.coordinates ? `${structuredEvent.coordinates.lat}, ${structuredEvent.coordinates.lng}` : 'N/A'}</p>
                            <p><strong>Google Maps Link:</strong> ${structuredEvent.googleMapsLink ? `<a href="${structuredEvent.googleMapsLink}" target="_blank" class="event-link">üó∫Ô∏è Open in Maps</a>` : 'N/A'}</p>
                        </div>
                    `;
                    
                    // Test structured data extraction
                    if (structuredEvent.venue === 'Trade' && structuredEvent.address && structuredEvent.coordinates) {
                        resultHtml += '<p style="color: green; font-weight: bold;">‚úÖ EXCELLENT: Full venue data extracted from JSON-LD!</p>';
                    }
                }
                
                resultHtml += '</div>';
                resultsDiv.innerHTML = resultHtml;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="results error">
                    <h4>‚ùå Parser Test Failed</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                </div>`;
            }
        }
        
        function testTimeParsingExample() {
            const resultsDiv = document.getElementById('results');
            
            try {
                const parser = new EventbriteEventParser();
                
                // Test the time parsing with various formats
                const testDates = [
                    "Sat, Aug 23 ‚Ä¢ 9:00 PM - 2:00 AM",
                    "Sat, Aug 23 ‚Ä¢ 9:00 PM",
                    "Sun, Dec 15 ‚Ä¢ 8:00 PM",
                    "Fri, Jan 10 ‚Ä¢ 10:00 PM - 3:00 AM"
                ];
                
                let resultHtml = '<div class="results"><h4>üïê Time Parsing Test Results</h4>';
                
                testDates.forEach((dateStr, index) => {
                    const parsed = parser.parseDate(dateStr);
                    const cleanStr = dateStr.replace('‚Ä¢', '').trim();
                    
                    resultHtml += `
                        <div class="event-details">
                            <h5>Test ${index + 1}:</h5>
                            <p><strong>Input:</strong> "${dateStr}"</p>
                            <p><strong>Parsed ISO:</strong> ${parsed || 'Failed to parse'}</p>
                            <p><strong>Human Readable:</strong> ${parsed ? new Date(parsed).toLocaleString() : 'N/A'}</p>
                        </div>
                    `;
                });
                
                resultHtml += '</div>';
                resultsDiv.innerHTML = resultHtml;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="results error">
                    <h4>‚ùå Time Parsing Test Failed</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                </div>`;
            }
        }
        
        async function testGeocodingExample() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing geocoding functionality...</p>';
            
            try {
                const parser = new EventbriteEventParser();
                
                // Test addresses from the user examples
                const testAddresses = [
                    "475 Santa Fe Drive Denver, CO 80204",
                    "2069 Cheshire Bridge Road Northeast Atlanta, GA 30324",
                    "Trade, Denver, CO"
                ];
                
                let resultHtml = '<div class="results"><h4>üó∫Ô∏è Geocoding Test Results</h4>';
                
                for (let i = 0; i < testAddresses.length; i++) {
                    const address = testAddresses[i];
                    resultHtml += `<div class="event-details"><h5>Test ${i + 1}: ${address}</h5><p>Geocoding...</p></div>`;
                    resultsDiv.innerHTML = resultHtml + '</div>';
                    
                    try {
                        const geocodeResult = await parser.geocodeAddress(address);
                        
                        resultHtml = resultHtml.replace(
                            `<p>Geocoding...</p></div>`,
                            `
                            <p><strong>Status:</strong> ${geocodeResult.geocoded ? '‚úÖ Success' : '‚ùå Failed'}</p>
                            <p><strong>Coordinates:</strong> ${geocodeResult.coordinates ? `${geocodeResult.coordinates.lat}, ${geocodeResult.coordinates.lng}` : 'N/A'}</p>
                            <p><strong>Google Maps:</strong> ${geocodeResult.googleMapsLink ? `<a href="${geocodeResult.googleMapsLink}" target="_blank" class="event-link">üó∫Ô∏è Open in Maps</a>` : 'N/A'}</p>
                            <p><strong>Display Name:</strong> ${geocodeResult.displayName || 'N/A'}</p>
                            ${geocodeResult.error ? `<p><strong>Error:</strong> ${geocodeResult.error}</p>` : ''}
                            </div>`
                        );
                        
                        // Update display
                        resultsDiv.innerHTML = resultHtml + '</div>';
                        
                    } catch (error) {
                        resultHtml = resultHtml.replace(
                            `<p>Geocoding...</p></div>`,
                            `<p><strong>Error:</strong> ${error.message}</p></div>`
                        );
                        resultsDiv.innerHTML = resultHtml + '</div>';
                    }
                    
                    // Small delay between requests
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
                
                resultHtml += '</div>';
                resultsDiv.innerHTML = resultHtml;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="results error">
                    <h4>‚ùå Geocoding Test Failed</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                </div>`;
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Auto-run test when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Enhanced Eventbrite Parser Test Ready');
            testWithSampleHTML(); // Auto-run the test
        });
    </script>
</body>
</html>