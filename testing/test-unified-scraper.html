<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêª Bear Event Scraper - Enhanced Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .header {
            background: #333;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls label {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }
        
        .controls select, .controls input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-left: 10px;
        }
        
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        
        button:hover {
            background: #005a87;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .results-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .html-output-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .html-output-container h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007cba;
            padding-bottom: 10px;
        }
        
        #htmlOutput {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            background: #fafafa;
            min-height: 200px;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
        
        .log-entry {
            margin: 2px 0;
        }
        
        .log-entry.error {
            color: #ff6b6b;
        }
        
        .log-entry.success {
            color: #51cf66;
        }
        
        .log-entry.info {
            color: #64b5f6;
        }
        
        .log-entry.warn {
            color: #ffd93d;
        }

        .eventbrite-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #ff6600;
        }

        .html-input {
            width: 100%;
            height: 150px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }

        .preset-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 5px 5px 0;
        }

        .preset-btn:hover {
            background: #218838;
        }

        .live-results {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        /* Make the generated HTML display nicely */
        #htmlOutput .event-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        #htmlOutput .event-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #htmlOutput .stats-container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêª Bear Event Scraper - Enhanced Test</h1>
        <p>Test the bear event scraper with live data, including enhanced Eventbrite parsing</p>
        <p><strong>New Features:</strong> Venue extraction, GPS coordinates, Google Maps links, improved time parsing</p>
    </div>
    
    <div class="controls">
        <h3>Test Options</h3>
        <label>
            Source:
            <select id="sourceSelect">
                <option value="all">All Sources</option>
                <option value="eventbrite">Eventbrite (Megawoof America)</option>
            </select>
        </label>
        
        <label>
            Days to Look Ahead:
            <input type="number" id="daysInput" value="" placeholder="All future events">
        </label>
        
        <label>
            <input type="checkbox" id="dryRunCheckbox" checked>
            Dry Run Mode (no calendar changes)
        </label>
        
        <br>
        
        <button onclick="runTest()" id="testBtn">Run Scraper Test</button>
        <button onclick="clearConsole()">Clear Console</button>
        <button onclick="testMockData()">Test with Mock Data</button>
    </div>

    <div class="eventbrite-section">
        <h3>üé´ Enhanced Eventbrite Parser Testing</h3>
        <p>Test the enhanced Eventbrite parser with custom HTML (venue extraction, GPS coordinates, time parsing)</p>
        
        <div style="margin: 15px 0;">
            <button class="preset-btn" onclick="loadEventbritePreset('addressParsing')">üìç Load Address Parsing Test</button>
            <button class="preset-btn" onclick="loadEventbritePreset('denver')">Load Denver Example</button>
            <button class="preset-btn" onclick="loadEventbritePreset('atlanta')">Load Atlanta Example</button>
            <button class="preset-btn" onclick="loadEventbritePreset('structured')">Load JSON-LD Example</button>
            <button class="preset-btn" onclick="clearEventbriteInput()">Clear</button>
        </div>
        
        <label for="eventbriteHtml">Paste Eventbrite HTML:</label>
        <textarea id="eventbriteHtml" class="html-input" placeholder="Paste Eventbrite HTML here..." 
                  oninput="parseEventbriteLive()"></textarea>
        
        <div id="eventbriteLiveResults" class="live-results" style="display: none;">
            <h5>üîÑ Live Parsing Results:</h5>
            <div id="eventbriteLiveContent"></div>
        </div>
        
        <button onclick="testEventbriteParser()">üß™ Test Eventbrite Parser</button>
    </div>
    
    <div class="console-output" id="console"></div>
    
    <div class="results-container" id="resultsContainer" style="display: none;">
        <h3>üìä Scraping Results</h3>
        <div id="results"></div>
    </div>
    
    <div class="html-output-container">
        <h2>üé® Generated HTML Output</h2>
        <div id="htmlOutput">
            <p style="color: #666; text-align: center;">Run the scraper to see the generated HTML output here...</p>
        </div>
    </div>
    
    <!-- Load the core modules -->
    <!-- New modular architecture -->
    <script src="../scripts/core/input-handler-web.js" onerror="console.error('Failed to load input-handler-web.js')"></script>
    <script src="../scripts/core/display-handler-web.js" onerror="console.error('Failed to load display-handler-web.js')"></script>
    <script src="../scripts/core/event-parser-eventbrite.js" onerror="console.error('Failed to load event-parser-eventbrite.js')"></script>
    <script src="../scripts/core/event-parser-bearraccuda.js" onerror="console.error('Failed to load event-parser-bearraccuda.js')"></script>
    <script src="../scripts/core/event-parser-generic.js" onerror="console.error('Failed to load event-parser-generic.js')"></script>
    <script src="../scripts/bear-event-scraper-unified.js" onerror="console.error('Failed to load bear-event-scraper-unified.js')"></script>
    
    <script>
        // Add global error handler to catch any script errors
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.message, 'in', event.filename, 'line', event.lineno);
        });
        // Custom console logging
        const consoleDiv = document.getElementById('console');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };
        
        function addLogEntry(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            // Also log to real console
            originalConsole[type](message);
        }
        
        // Override console methods
        console.log = (message) => addLogEntry(message, 'info');
        console.error = (message) => addLogEntry(message, 'error');
        console.warn = (message) => addLogEntry(message, 'warn');
        console.info = (message) => addLogEntry(message, 'info');
        
        function clearConsole() {
            consoleDiv.innerHTML = '';
        }
        
        async function loadScraperConfig() {
            try {
                const response = await fetch('../scripts/scraper-input.json');
                if (!response.ok) {
                    throw new Error(`Failed to load config: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Failed to load scraper configuration: ${error.message}`);
                return null;
            }
        }
        
        async function runTest() {
            const testBtn = document.getElementById('testBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsDiv = document.getElementById('results');
            const htmlOutput = document.getElementById('htmlOutput');
            
            // Check if BearEventScraper is available
            if (typeof BearEventScraper === 'undefined') {
                console.error('BearEventScraper is not loaded yet. Please refresh the page and try again.');
                alert('BearEventScraper is not loaded. Please refresh the page and try again.');
                return;
            }
            
            testBtn.disabled = true;
            testBtn.textContent = 'Running Test...';
            resultsContainer.style.display = 'none';
            
            clearConsole();
            console.log('üêª Starting Bear Event Scraper Test');
            
            try {
                // Load configuration
                const configData = await loadScraperConfig();
                if (!configData) {
                    throw new Error('Failed to load scraper configuration');
                }
                
                // Get test options
                const sourceSelect = document.getElementById('sourceSelect').value;
                const daysInput = document.getElementById('daysInput').value;
                const dryRun = document.getElementById('dryRunCheckbox').checked;
                
                // Filter sources if specific one selected
                let sources = configData.parsers;
                if (sourceSelect !== 'all') {
                    sources = sources.filter(s => s.parser === sourceSelect);
                }
                
                // Create scraper config
                const config = {
                    dryRun: dryRun,
                    daysToLookAhead: daysInput ? parseInt(daysInput) : undefined,
                    corsProxy: 'https://api.allorigins.win/raw?url=' // Public CORS proxy for testing
                };
                
                console.log(`Configuration: ${JSON.stringify(config)}`);
                console.log(`Testing ${sources.length} source(s)`);
                
                // Create and run scraper
                const scraper = new BearEventScraper(config);
                await scraper.initialize();
                
                const results = await scraper.scrapeEvents(sources);
                
                // Display results summary
                resultsContainer.style.display = 'block';
                resultsDiv.innerHTML = `
                    <div class="status ${results.success ? 'success' : 'error'}">
                        <strong>${results.success ? '‚úÖ Success' : '‚ùå Failed'}</strong>
                        <br>Total Events: ${results.events.length}
                        <br>Bear Events: ${results.bearEventCount}
                        <br>Sources: ${results.successfulSources}/${results.totalSources} successful
                        <br>Duplicates Removed: ${results.processingStats.duplicatesRemoved}
                        <br>Past Events Filtered: ${results.processingStats.pastEventsFiltered}
                    </div>
                `;
                
                // Display the generated HTML
                console.log('Generating HTML output...');
                const displayHandler = new WebDisplayHandler();
                const displayResult = await displayHandler.displayResults(results, { format: 'html' });
                
                if (displayResult.element) {
                    htmlOutput.innerHTML = '';
                    htmlOutput.appendChild(displayResult.element);
                    console.log('‚úÖ HTML output generated successfully');
                } else {
                    htmlOutput.innerHTML = '<p style="color: red;">Failed to generate HTML output</p>';
                }
                
            } catch (error) {
                console.error(`Test failed: ${error.message}`);
                resultsContainer.style.display = 'block';
                resultsDiv.innerHTML = `
                    <div class="status error">
                        <strong>‚ùå Test Failed</strong>
                        <br>Error: ${error.message}
                    </div>
                `;
                htmlOutput.innerHTML = '<p style="color: red;">Test failed - no output generated</p>';
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'Run Scraper Test';
            }
        }
        
        async function testMockData() {
            const htmlOutput = document.getElementById('htmlOutput');
            
            console.log('üß™ Testing with mock data...');
            
            try {
                // Create mock results
                const mockResults = {
                    success: true,
                    events: [
                        {
                            title: 'Bear Night Out',
                            date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                            venue: 'Rockbar',
                            city: 'nyc',
                            description: 'Monthly bear gathering with drink specials',
                            isBearEvent: true,
                            source: 'Rockbar NYC',
                            url: 'https://example.com/event1'
                        },
                        {
                            title: 'Furball NYC',
                            date: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString(),
                            venue: 'Terminal 5',
                            city: 'nyc',
                            description: 'The biggest bear dance party in NYC',
                            isBearEvent: true,
                            source: 'Furball NYC',
                            url: 'https://example.com/event2'
                        },
                        {
                            title: 'Bearracuda SF',
                            date: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000).toISOString(),
                            venue: 'SF Eagle',
                            city: 'sf',
                            description: 'Bear dance party with go-go dancers',
                            isBearEvent: true,
                            source: 'Bearracuda',
                            url: 'https://example.com/event3'
                        }
                    ],
                    totalSources: 3,
                    successfulSources: 3,
                    bearEventCount: 3,
                    processingStats: {
                        totalEventsFound: 5,
                        duplicatesRemoved: 1,
                        pastEventsFiltered: 1,
                        finalEventCount: 3
                    },
                    comprehensiveStats: {
                        totalParsed: 5,
                        validEvents: 3,
                        bearEvents: 3,
                        processingSuccess: 100,
                        bearEventRate: 100
                    },
                    timestamp: new Date().toISOString()
                };
                
                // Generate HTML display
                const displayHandler = new WebDisplayHandler({ showDebugInfo: true });
                const displayResult = await displayHandler.displayResults(mockResults, { format: 'html' });
                
                if (displayResult.element) {
                    htmlOutput.innerHTML = '';
                    htmlOutput.appendChild(displayResult.element);
                    console.log('‚úÖ Mock data HTML generated successfully');
                } else {
                    htmlOutput.innerHTML = '<p style="color: red;">Failed to generate HTML from mock data</p>';
                }
                
            } catch (error) {
                console.error(`Mock test failed: ${error.message}`);
                htmlOutput.innerHTML = '<p style="color: red;">Mock test failed</p>';
            }
        }
        
        // Run mock test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded - Bear Event Scraper Test Ready');
            
            // Check module availability
            const moduleStatus = {
                WebInputHandler: typeof WebInputHandler !== 'undefined',
                WebDisplayHandler: typeof WebDisplayHandler !== 'undefined',
                EventbriteEventParser: typeof EventbriteEventParser !== 'undefined',
                BearraccudaEventParser: typeof BearraccudaEventParser !== 'undefined',
                GenericEventParser: typeof GenericEventParser !== 'undefined',
                BearEventScraper: typeof BearEventScraper !== 'undefined'
            };
            
            console.log('Available modules:', moduleStatus);
            
            // If any module is missing, show an error
            const missingModules = Object.entries(moduleStatus)
                .filter(([name, loaded]) => !loaded)
                .map(([name]) => name);
            
            if (missingModules.length > 0) {
                console.error('Missing modules:', missingModules.join(', '));
                const errorDiv = document.createElement('div');
                errorDiv.className = 'status error';
                errorDiv.innerHTML = `<strong>‚ö†Ô∏è Module Loading Error</strong><br>Missing modules: ${missingModules.join(', ')}<br>Please check the console for errors.`;
                document.getElementById('resultsContainer').style.display = 'block';
                document.getElementById('results').appendChild(errorDiv);
            }
        });

        // Enhanced Eventbrite Parser Testing Functions
        const eventbritePresets = {
            denver: `<div class="Container_root__4i85v NestedActionContainer_root__1jtfr event-card event-card__vertical" 
         data-event-location="Denver, CO">
        <a href="https://www.eventbrite.com/e/megawoof-america-denver-massive-2-parties-1-ticket-tickets-1381219547849" 
           rel="noopener" target="_blank" class="event-card-link" 
           aria-label="View MEGAWOOF AMERICA DENVER : MASSIVE 2 Parties 1 Ticket" 
           data-event-id="1381219547849">
            <section class="event-card-details">
                <div class="Stack_root__1ksk7">
                    <h3 class="Typography_root__487rx Typography_body-lg__487rx">
                        MEGAWOOF AMERICA DENVER : MASSIVE 2 Parties 1 Ticket
                    </h3>
                    <p class="Typography_root__487rx Typography_body-md__487rx">
                        Sat, Aug 23 ‚Ä¢ 9:00 PM - 2:00 AM
                    </p>
                    <p class="Typography_root__487rx Typography_body-md__487rx">
                        Trade
                    </p>
                    <p class="Typography_root__487rx Typography_body-md-bold__487rx">
                        From $16.84
                    </p>
                </div>
            </section>
        </a>
    </div>`,
            
            atlanta: `<div class="Container_root__4i85v NestedActionContainer_root__1jtfr event-card event-card__vertical" 
         data-event-location="Atlanta, GA">
        <a href="https://www.eventbrite.com/e/megawoof-america-atlanta-tickets-1433358025439" 
           rel="noopener" target="_blank" class="event-card-link" 
           aria-label="View MEGAWOOF AMERICA ATLANTA" 
           data-event-id="1433358025439">
            <section class="event-card-details">
                <div class="Stack_root__1ksk7">
                    <h3 class="Typography_root__487rx Typography_body-lg__487rx">
                        MEGAWOOF AMERICA ATLANTA
                    </h3>
                    <p class="Typography_root__487rx Typography_body-md__487rx">
                        Sat, Nov 15 ‚Ä¢ 10:00 PM - 4:00 AM
                    </p>
                    <p class="Typography_root__487rx Typography_body-md__487rx">
                        The Heretic Atlanta
                    </p>
                    <p class="Typography_root__487rx Typography_body-md-bold__487rx">
                        From $25.00
                    </p>
                </div>
            </section>
        </a>
    </div>`,

            structured: `<script type="application/ld+json">
{
    "@type": "Event",
    "name": "MEGAWOOF AMERICA DENVER : MASSIVE 2 Parties 1 Ticket",
    "startDate": "2025-08-23T21:00:00-06:00",
    "endDate": "2025-08-24T02:00:00-06:00",
    "location": {
        "name": "Trade",
        "address": "475 Santa Fe Drive, Denver, CO 80204",
        "geo": {
            "latitude": "39.7392",
            "longitude": "-105.0178"
        }
    },
    "url": "https://www.eventbrite.com/e/megawoof-america-denver-massive-2-parties-1-ticket-tickets-1381219547849"
}
</script>
<div>Event content here...</div>`,

            addressParsing: `<div class="Container_root__4i85v NestedActionContainer_root__1jtfr event-card event-card__vertical">
        <a href="https://www.eventbrite.com/e/duro-summer-night-foam-edition-tickets-1446957562019" 
           rel="noopener" target="_blank" class="event-card-link" 
           aria-label="View Duro Summer Night Foam Edition" 
           data-event-id="1446957562019">
            <section class="event-card-details">
                <div class="Stack_root__1ksk7">
                    <h3 class="Typography_root__487rx Typography_body-lg__487rx">
                        Duro Summer Night Foam Edition
                    </h3>
                    <p class="Typography_root__487rx Typography_body-md__487rx">
                        Sat, Aug 23 ‚Ä¢ 9:00 PM
                    </p>
                    <p class="Typography_root__487rx Typography_body-md__487rx">
                        TBA

DTLA Los Angeles, CA 90013
                    </p>
                    <p class="Typography_root__487rx Typography_body-md-bold__487rx">
                        From $25.00
                    </p>
                </div>
            </section>
        </a>
    </div>
    
    <div>Location
    TBA
    
    DTLA Los Angeles, CA 90013
    Get directions</div>`
        };

        function loadEventbritePreset(type) {
            const htmlInput = document.getElementById('eventbriteHtml');
            if (eventbritePresets[type]) {
                htmlInput.value = eventbritePresets[type].trim();
                parseEventbriteLive();
            }
        }

        function clearEventbriteInput() {
            document.getElementById('eventbriteHtml').value = '';
            document.getElementById('eventbriteLiveResults').style.display = 'none';
        }

        let eventbriteParseTimeout;
        function parseEventbriteLive() {
            clearTimeout(eventbriteParseTimeout);
            eventbriteParseTimeout = setTimeout(() => {
                const htmlInput = document.getElementById('eventbriteHtml');
                const liveResults = document.getElementById('eventbriteLiveResults');
                const liveContent = document.getElementById('eventbriteLiveContent');
                
                if (!htmlInput.value.trim()) {
                    liveResults.style.display = 'none';
                    return;
                }
                
                try {
                    if (typeof EventbriteEventParser === 'undefined') {
                        throw new Error('EventbriteEventParser not loaded');
                    }
                    
                    const parser = new EventbriteEventParser({
                        alwaysBear: true,
                        requireDetailPages: false
                    });
                    
                    const htmlData = {
                        html: htmlInput.value,
                        url: 'https://www.eventbrite.com/test'
                    };
                    
                    const result = parser.parseEvents(htmlData);
                    
                    let content = '';
                    if (result.events && result.events.length > 0) {
                        const event = result.events[0];
                        content = `
                            <div style="background: #e8f5e8; padding: 10px; border-radius: 4px;">
                                <strong>‚úÖ Parsed Successfully!</strong><br>
                                üìÖ <strong>${event.title}</strong><br>
                                üè¢ Venue: ${event.venue || 'N/A'}<br>
                                üìç Address: ${event.address || 'N/A'}<br>
                                üïê Time: ${event.dateString || event.startDate || 'N/A'}<br>
                                üó∫Ô∏è Maps: ${event.googleMapsLink ? '<a href="' + event.googleMapsLink + '" target="_blank">Open</a>' : 'N/A'}<br>
                                üìç GPS: ${event.coordinates ? event.coordinates.lat + ', ' + event.coordinates.lng : 'N/A'}
                            </div>
                        `;
                    } else {
                        content = '<div style="background: #ffebee; padding: 10px; border-radius: 4px; color: #c62828;"><strong>‚ùå No events found</strong></div>';
                    }
                    
                    liveContent.innerHTML = content;
                    liveResults.style.display = 'block';
                    
                } catch (error) {
                    liveContent.innerHTML = `<div style="background: #ffebee; padding: 10px; border-radius: 4px; color: #c62828;"><strong>‚ùå Error:</strong> ${error.message}</div>`;
                    liveResults.style.display = 'block';
                }
            }, 500);
        }

        function testEventbriteParser() {
            const htmlInput = document.getElementById('eventbriteHtml');
            
            if (!htmlInput.value.trim()) {
                alert('Please enter some HTML content first!');
                return;
            }
            
            try {
                if (typeof EventbriteEventParser === 'undefined') {
                    throw new Error('EventbriteEventParser not loaded');
                }
                
                const parser = new EventbriteEventParser({
                    alwaysBear: true,
                    requireDetailPages: false
                });
                
                const htmlData = {
                    html: htmlInput.value,
                    url: 'https://www.eventbrite.com/test'
                };
                
                const result = parser.parseEvents(htmlData);
                
                // Display results in the main results area
                const resultsContainer = document.getElementById('resultsContainer');
                const results = document.getElementById('results');
                
                let resultHtml = '<div class="status success"><h4>üé´ Eventbrite Parser Test Results</h4></div>';
                
                if (result.events && result.events.length > 0) {
                    result.events.forEach((event, index) => {
                        resultHtml += `
                            <div class="event-card">
                                <h5>üìÖ Event ${index + 1}: ${event.title}</h5>
                                <p><strong>Date String:</strong> ${event.dateString || 'N/A'}</p>
                                <p><strong>Start Date (ISO):</strong> ${event.startDate || event.date || 'N/A'}</p>
                                <p><strong>End Date (ISO):</strong> ${event.endDate || 'N/A'}</p>
                                <p><strong>Venue/Bar Name:</strong> ${event.venue || 'N/A'}</p>
                                <p><strong>Address:</strong> ${event.address || 'N/A'}</p>
                                <p><strong>GPS Coordinates:</strong> ${event.coordinates ? `${event.coordinates.lat}, ${event.coordinates.lng}` : 'N/A'}</p>
                                <p><strong>Google Maps Link:</strong> ${event.googleMapsLink ? `<a href="${event.googleMapsLink}" target="_blank">üó∫Ô∏è Open in Maps</a>` : 'N/A'}</p>
                                <p><strong>City:</strong> ${event.city || 'N/A'}</p>
                                <p><strong>Price:</strong> ${event.price || 'N/A'}</p>
                                <p><strong>Is Bear Event:</strong> ${event.isBearEvent ? 'üêª Yes' : '‚ùå No'}</p>
                            </div>
                        `;
                    });
                } else {
                    resultHtml += '<div class="status error">‚ùå No events parsed from the HTML</div>';
                }
                
                resultHtml += `<div class="stats-container">
                    <p><strong>Events Found:</strong> ${result.events ? result.events.length : 0}</p>
                    <p><strong>Additional Links:</strong> ${result.additionalLinks ? result.additionalLinks.length : 0}</p>
                    <p><strong>Source:</strong> ${result.source}</p>
                </div>`;
                
                results.innerHTML = resultHtml;
                resultsContainer.style.display = 'block';
                
                // Scroll to results
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                const resultsContainer = document.getElementById('resultsContainer');
                const results = document.getElementById('results');
                
                results.innerHTML = `<div class="status error">
                    <h4>‚ùå Eventbrite Parser Test Failed</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                </div>`;
                
                resultsContainer.style.display = 'block';
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }
    </script>
</body>
</html>