<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toolbox | chunky.dad</title>
  <meta name="description" content="Toolbox for chunky.dad test pages and utilities.">
  <link rel="icon" type="image/x-icon" href="/favicons/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicons/favicon-192x192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
  <link rel="manifest" href="/favicons/site.webmanifest">
  <meta name="theme-color" content="#667eea">
  <link rel="stylesheet" href="../styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Toolbox page */
    body.toolbox-page {
      background: #f7f7ff;
      color: #1f2633;
    }

    body.toolbox-page header {
      box-shadow: 0 10px 25px rgba(30, 42, 80, 0.2);
    }

    .toolbox-main {
      flex: 1;
      padding-bottom: 2.5rem;
    }

    .toolbox-hero {
      background: linear-gradient(135deg, #667eea 0%, #ff6b6b 100%);
      color: #ffffff;
      padding: 1.6rem 0 1.2rem;
    }

    .toolbox-hero-card {
      background: rgba(255, 255, 255, 0.16);
      border: 1px solid rgba(255, 255, 255, 0.35);
      border-radius: 18px;
      padding: 1.4rem 1.6rem;
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1fr);
      gap: 1.2rem;
      box-shadow: 0 18px 30px rgba(24, 36, 80, 0.25);
    }

    .toolbox-kicker {
      display: inline-block;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.2rem;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.85);
    }

    .toolbox-hero-text h1 {
      font-size: 2.3rem;
      margin: 0.3rem 0 0.6rem;
    }

    .toolbox-hero-text p {
      margin: 0;
      font-size: 1rem;
      max-width: 36rem;
    }

    .toolbox-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .toolbox-button {
      background: rgba(255, 255, 255, 0.2);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.45);
      padding: 0.5rem 1rem;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .toolbox-button.secondary {
      background: #ffffff;
      color: #5c6bc0;
      border-color: #ffffff;
    }

    .toolbox-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(18, 26, 60, 0.2);
    }

    .toolbox-hero-aside {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .toolbox-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .toolbox-badge {
      background: rgba(255, 255, 255, 0.22);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 999px;
      padding: 0.3rem 0.7rem;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .toolbox-hero-note {
      background: rgba(0, 0, 0, 0.18);
      border-radius: 12px;
      padding: 0.7rem 0.9rem;
    }

    .toolbox-note-title {
      display: block;
      text-transform: uppercase;
      letter-spacing: 0.08rem;
      font-size: 0.75rem;
      font-weight: 700;
      margin-bottom: 0.35rem;
    }

    .toolbox-hero-note p {
      margin: 0;
      font-size: 0.9rem;
    }

    .toolbox-content {
      padding: 1.5rem 0;
      color: #1f2633;
    }

    .toolbox-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .toolbox-toolbar-label {
      text-transform: uppercase;
      letter-spacing: 0.12rem;
      font-weight: 700;
      font-size: 0.85rem;
      color: #455073;
    }

    .toolbox-toolbar-text p {
      margin: 0.3rem 0 0;
      color: #5b6480;
    }

    .toolbox-stats {
      background: #ffffff;
      border: 1px solid #e1e6f4;
      border-radius: 999px;
      padding: 0.45rem 0.9rem;
      font-weight: 600;
      font-size: 0.9rem;
      color: #374160;
      box-shadow: 0 8px 15px rgba(28, 40, 80, 0.08);
      white-space: nowrap;
    }

    .toolbox-debug {
      margin: 0.8rem 0 1rem;
      background: #ffffff;
      border: 1px solid #e1e6f4;
      border-radius: 12px;
      padding: 0.6rem 0.8rem;
      color: #3f4b66;
      box-shadow: 0 8px 20px rgba(28, 40, 80, 0.08);
    }

    .toolbox-debug summary {
      cursor: pointer;
      font-weight: 600;
      color: #4b5675;
    }

    .toolbox-debug[open] summary {
      margin-bottom: 0.6rem;
    }

    .toolbox-debug-list {
      display: grid;
      gap: 0.5rem;
      margin-top: 0.6rem;
    }

    .toolbox-debug-item {
      background: #f5f6ff;
      border: 1px solid #e1e6f4;
      border-radius: 10px;
      padding: 0.35rem 0.6rem;
      font-size: 0.8rem;
      color: #4a5672;
    }

    .toolbox-debug-item.success {
      background: #eaf7ee;
      border-color: #64c987;
      color: #236c3a;
    }

    .toolbox-debug-item.warn {
      background: #fff3e0;
      border-color: #ffb74d;
      color: #8a5a00;
    }

    .toolbox-debug-item.error {
      background: #fdecea;
      border-color: #f28b82;
      color: #a0241c;
    }

    .toolbox-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.9rem;
    }

    .toolbox-card {
      background: #ffffff;
      border: 1px solid #e1e6f4;
      border-radius: 14px;
      padding: 0.8rem 1rem;
      display: flex;
      gap: 0.9rem;
      text-decoration: none;
      color: #1f2633;
      align-items: flex-start;
      min-height: 90px;
      box-shadow: 0 10px 20px rgba(26, 36, 70, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }

    .toolbox-card:hover {
      transform: translateY(-2px);
      border-color: #667eea;
      box-shadow: 0 14px 30px rgba(26, 36, 70, 0.15);
    }

    .toolbox-card-icon {
      font-size: 1.7rem;
      line-height: 1;
    }

    .toolbox-card-body {
      flex: 1;
    }

    .toolbox-card-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .toolbox-card-title h3 {
      margin: 0;
      font-size: 1.05rem;
      color: #232b41;
    }

    .toolbox-card-arrow {
      color: #667eea;
      font-weight: 700;
    }

    .toolbox-card-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      font-size: 0.75rem;
      color: #6a728a;
      margin: 0.2rem 0 0.4rem;
    }

    .toolbox-card-file {
      font-family: "Courier New", monospace;
    }

    .toolbox-card-desc {
      margin: 0;
      font-size: 0.85rem;
      color: #4e586f;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .toolbox-loading,
    .toolbox-error,
    .toolbox-empty {
      background: #ffffff;
      border: 1px dashed #cbd5f0;
      border-radius: 14px;
      padding: 1.2rem;
      text-align: center;
      color: #5a657c;
      font-weight: 600;
      grid-column: 1 / -1;
    }

    .toolbox-error {
      border-color: #f28b82;
      background: #fdecea;
      color: #a0241c;
    }

    .toolbox-empty {
      border-color: #ffcc80;
      background: #fff8e1;
      color: #8a6d3b;
    }

    .toolbox-error h3,
    .toolbox-empty h3 {
      margin: 0 0 0.4rem;
    }

    .toolbox-error p,
    .toolbox-empty p {
      margin: 0;
      font-weight: 500;
    }

    .toolbox-footer {
      background: #ffffff;
      border-top: 1px solid #e1e6f4;
      padding: 1.5rem 0;
      color: #4e586f;
    }

    .toolbox-footer-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      text-align: center;
      font-weight: 600;
    }

    .toolbox-footer-icons {
      font-size: 1.3rem;
    }

    @media (max-width: 960px) {
      .toolbox-hero-card {
        grid-template-columns: 1fr;
      }

      .toolbox-hero-aside {
        flex-direction: row;
        flex-wrap: wrap;
      }
    }

    @media (max-width: 720px) {
      .toolbox-hero {
        padding: 1.2rem 0 1rem;
      }

      .toolbox-hero-card {
        padding: 1.1rem;
      }

      .toolbox-hero-text h1 {
        font-size: 1.8rem;
      }

      .toolbox-toolbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .toolbox-grid {
        grid-template-columns: 1fr;
      }

      .toolbox-card {
        padding: 0.7rem 0.85rem;
      }
    }
  </style>
</head>
<body class="toolbox-page">
  <header>
    <nav>
      <div class="nav-container">
        <div class="logo">
          <h1>
            <a href="../index.html">
              <img src="../favicons/favicon-192x192.png" alt="chunky.dad logo" class="logo-img">
              chunky.dad/tools
            </a>
          </h1>
        </div>
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </nav>
  </header>

  <main class="toolbox-main">
    <section class="toolbox-hero">
      <div class="container">
        <div class="toolbox-hero-card">
          <div class="toolbox-hero-text">
            <span class="toolbox-kicker">Tool Shed</span>
            <h1>chunky.dad Toolbox</h1>
            <p>Cute toolbox, subversive gay vibes, big dad energy. Grab a tool and get weird.</p>
            <div class="toolbox-actions">
              <a class="toolbox-button" href="../index.html">Back to main site</a>
              <a class="toolbox-button secondary" href="../bear-directory.html">Bear directory</a>
            </div>
          </div>
          <div class="toolbox-hero-aside">
            <div class="toolbox-badges">
              <span class="toolbox-badge">Cute</span>
              <span class="toolbox-badge">Subversive</span>
              <span class="toolbox-badge">Dad Energy</span>
            </div>
            <div class="toolbox-hero-note">
              <span class="toolbox-note-title">Small page, big tools</span>
              <p>Two-column layout so you can scan the whole kit fast.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="toolbox-content">
      <div class="container">
        <div class="toolbox-toolbar">
          <div class="toolbox-toolbar-text">
            <span class="toolbox-toolbar-label">Choose a tool</span>
            <p>Open any test page to tinker, debug, or stress a layout.</p>
          </div>
          <div class="toolbox-stats" id="toolbox-stats">Loading tools...</div>
        </div>

        <details class="toolbox-debug" id="debug-info" hidden>
          <summary>Load details</summary>
          <div id="debug-content" class="toolbox-debug-list"></div>
        </details>

        <div id="file-grid" class="toolbox-grid">
          <div class="toolbox-loading">Loading tools...</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="toolbox-footer">
    <div class="container">
      <div class="toolbox-footer-inner">
        <span class="toolbox-footer-icons">üß∞ üîß ‚öíÔ∏è</span>
        <p>Built for cute chaos, subversive joy, and steady dad hands.</p>
      </div>
    </div>
  </footer>

  <script>
    function getFileInfo(file) {
      const baseName = file.name.replace('.html', '');

      return {
        icon: file.icon || 'üß∞',
        desc: file.description || 'Test file',
        displayName: baseName.replace(/-/g, ' ').replace(/\b\w/g, (letter) => letter.toUpperCase())
      };
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return `${bytes} B`;
      if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
      return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
    }

    function setupDebugPanel() {
      const debugInfo = document.getElementById('debug-info');
      const debugContent = document.getElementById('debug-content');
      const debugEnabled = new URLSearchParams(window.location.search).has('debug');

      if (!debugInfo || !debugContent) {
        return {
          addEntry: () => {},
          reveal: () => {}
        };
      }

      debugInfo.hidden = !debugEnabled;
      if (debugEnabled) {
        debugInfo.open = true;
      }

      const reveal = (open = false) => {
        if (debugInfo.hidden) {
          debugInfo.hidden = false;
        }
        if (open) {
          debugInfo.open = true;
        }
      };

      const addEntry = (type, message) => {
        const shouldReveal = debugEnabled || type === 'warn' || type === 'error';
        if (shouldReveal) {
          reveal(type === 'error' || type === 'warn');
        }

        const entry = document.createElement('div');
        entry.className = `toolbox-debug-item ${type}`;
        entry.textContent = message;
        debugContent.appendChild(entry);
      };

      return { addEntry, reveal };
    }

    async function parseDirectoryListing() {
      try {
        const response = await fetch('./');
        const text = await response.text();

        const parser = new DOMParser();
        const doc = parser.parseFromString(text, 'text/html');

        const files = [];
        const links = doc.querySelectorAll('a');
        for (const link of links) {
          const href = link.getAttribute('href');
          if (href && href.endsWith('.html') && !href.includes('/') && href !== 'index.html') {
            files.push({
              name: href,
              displayText: link.textContent.trim(),
              exists: true
            });
          }
        }

        if (files.length === 0) {
          const rows = doc.querySelectorAll('tr');
          for (const row of rows) {
            const link = row.querySelector('a');
            if (link) {
              const href = link.getAttribute('href');
              if (href && href.endsWith('.html') && !href.includes('/') && href !== 'index.html') {
                files.push({
                  name: href,
                  exists: true
                });
              }
            }
          }
        }

        return files;
      } catch (error) {
        return null;
      }
    }

    async function loadTestFiles() {
      const debugPanel = setupDebugPanel();
      const fileGrid = document.getElementById('file-grid');

      try {
        let testFiles = [];

        try {
          const manifestResponse = await fetch('./manifest.json', { cache: 'no-cache' });
          debugPanel.addEntry('info', `Manifest fetch: ${manifestResponse.status} ${manifestResponse.statusText}`);

          if (manifestResponse.ok) {
            const manifest = await manifestResponse.json();
            testFiles = manifest.files.filter((file) => file.name !== 'index.html');
            debugPanel.addEntry('success', `Loaded ${testFiles.length} files from manifest.json`);
          } else {
            debugPanel.addEntry('warn', 'Manifest fetch failed, trying directory listing.');
          }
        } catch (error) {
          debugPanel.addEntry('error', `Error loading manifest: ${error.message}`);
        }

        if (testFiles.length === 0) {
          const parsedFiles = await parseDirectoryListing();

          if (parsedFiles && parsedFiles.length > 0) {
            testFiles = parsedFiles;
            debugPanel.addEntry('success', `Loaded ${testFiles.length} files from directory listing`);
          } else {
            debugPanel.addEntry('warn', 'Directory listing empty, probing known files.');
            const allKnownFiles = [
              'ultimate-style-tester.html',
              'style-test.html',
              'event-test-index.html',
              'event-test-1-carousel.html',
              'event-test-2-timeline.html',
              'event-test-3-map.html',
              'event-test-4-masonry.html',
              'event-test-5-heatmap.html',
              'event-test-6-ticker.html',
              'event-test-7-circular.html',
              'event-test-8-kanban.html',
              'event-test-9-bubbles.html',
              'event-test-10-flipcards.html',
              'event-test-11-weekview.html',
              'event-test-12-swipe-tiles.html',
              'test-calendar-logging.html',
              'test-google-sheets-loader.html',
              'test-display-modes.html',
              'event-builder.html',
              'css-breakpoint-test.html',
              'multiline-breakpoint-test.html',
              'hyphenation-test.html',
              'simplified-hyphenation-test.html',
              'test-event-abbreviation.html'
            ];

            const fileChecks = allKnownFiles.map(async (filename) => {
              try {
                const response = await fetch(filename, { method: 'HEAD' });
                if (response.ok) {
                  const contentLength = response.headers.get('content-length');
                  return {
                    name: filename,
                    exists: true,
                    size: contentLength ? parseInt(contentLength, 10) : null
                  };
                }
              } catch (error) {
                return null;
              }
              return null;
            });

            const results = await Promise.all(fileChecks);
            testFiles = results.filter((file) => file !== null);
            debugPanel.addEntry('success', `Loaded ${testFiles.length} files from probe`);
          }
        }

        testFiles.sort((a, b) => a.name.localeCompare(b.name));
        displayFiles(testFiles);
      } catch (error) {
        if (fileGrid) {
          fileGrid.innerHTML = `
            <div class="toolbox-error">
              <h3>Toolbox misfire</h3>
              <p>Dad dropped the wrench: ${error.message}</p>
            </div>
          `;
        }
      }
    }

    function displayFiles(files) {
      const existingFiles = files.filter((file) => file.exists !== false);
      const statsEl = document.getElementById('toolbox-stats');
      const container = document.getElementById('file-grid');

      if (statsEl) {
        statsEl.textContent = `${existingFiles.length} tool${existingFiles.length !== 1 ? 's' : ''} ready`;
      }

      if (!container) {
        return;
      }

      container.innerHTML = '';

      if (existingFiles.length === 0) {
        container.innerHTML = `
          <div class="toolbox-empty">
            <h3>Empty tool shed</h3>
            <p>No test files found in the testing directory.</p>
          </div>
        `;
        return;
      }

      existingFiles.forEach((file) => {
        const fileInfo = getFileInfo(file);
        const card = document.createElement('a');
        card.href = file.name;
        card.className = 'toolbox-card';
        card.innerHTML = `
          <span class="toolbox-card-icon">${fileInfo.icon}</span>
          <div class="toolbox-card-body">
            <div class="toolbox-card-title">
              <h3>${fileInfo.displayName}</h3>
              <span class="toolbox-card-arrow">‚Üí</span>
            </div>
            <div class="toolbox-card-meta">
              <span class="toolbox-card-file">${file.name}</span>
              ${file.size ? `<span class="toolbox-card-size">${formatFileSize(file.size)}</span>` : ''}
            </div>
            <p class="toolbox-card-desc">${fileInfo.desc}</p>
          </div>
        `;
        container.appendChild(card);
      });
    }

    loadTestFiles();
  </script>
</body>
</html>
